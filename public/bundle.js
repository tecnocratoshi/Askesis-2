import{b as pa}from"./chunk-UDAXYSIS.js";var ne=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),pn=Array.from({length:100},(e,t)=>t<10?"0"+t:String(t));function je(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}let e=new Uint8Array(16);try{if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(e);else throw 0}catch{let a=Date.now(),n=typeof performance<"u"&&performance.now?performance.now()*1e3:0;for(let i=0;i<16;i++){let o=Math.random()*256,c=a>>i*2&255,l=n>>i*2&255;e[i]=(o^c^l)&255}}return e[6]=e[6]&15|64,e[8]=e[8]&63|128,ne[e[0]]+ne[e[1]]+ne[e[2]]+ne[e[3]]+"-"+ne[e[4]]+ne[e[5]]+"-"+ne[e[6]]+ne[e[7]]+"-"+ne[e[8]]+ne[e[9]]+"-"+ne[e[10]]+ne[e[11]]+ne[e[12]]+ne[e[13]]+ne[e[14]]+ne[e[15]]}function B(e){if(isNaN(e.getTime()))throw new Error("CRITICAL: toUTCIsoDateString received Invalid Date.");let t=e.getUTCFullYear(),a=e.getUTCMonth()+1,n=e.getUTCDate();return t+"-"+pn[a]+"-"+pn[n]}function Go(){let e=new Date;return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}var At=null,ga=0;function O(){let e=Date.now();return(!At||e-ga>6e4)&&(At=B(Go()),ga=e),At}function ha(){At=null,ga=0}var Ct;function ya(){Ct&&(clearTimeout(Ct),Ct=void 0);let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1,0,0,0,0),a=Math.max(1e3,t.getTime()-e.getTime());Ct=window.setTimeout(()=>{ha(),document.dispatchEvent(new CustomEvent("dayChanged")),ya()},a+1e3)}function I(e){if(!e||typeof e!="string")return new Date(NaN);let t=new Date(`${e}T00:00:00.000Z`);if(isNaN(t.getTime()))return t;if(e.length===10){let a=t.getUTCFullYear(),n=t.getUTCMonth()+1,i=t.getUTCDate();if(a!==parseInt(e.substring(0,4))||n!==parseInt(e.substring(5,7))||i!==parseInt(e.substring(8,10)))return new Date(NaN)}return t}function se(e,t){let a=new Date(e);return a.setUTCDate(a.getUTCDate()+t),a}var Vo=/^\d{4}-\d{2}-\d{2}$/;function Ie(e){return!e||!Vo.test(e)?O():e}var $o=/[&<>"']/g,Wo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Yo=e=>Wo[e];function ba(e){return e?e.replace($o,Yo):""}var jo=/(\*\*\*(.*?)\*\*\*)|(\*\*(.*?)\*\*)|(\*(.*?)\*)|(~~(.*?)~~)/g,mn=/^\d+\.\s/,Xo=(e,t,a,n,i,o,c,l,d)=>t?`<strong><em>${a}</em></strong>`:n?`<strong>${i}</strong>`:o?`<em>${c}</em>`:l?`<del>${d}</del>`:e;function We(e){return ba(e).replace(jo,Xo)}var Qo=/^### /,Zo=/^## /,Jo=/^# /,er=/^[*+-\s] /;function va(e){if(!e)return"";let t=[],a=!1,n=!1,i=()=>{a&&(t.push("</ul>"),a=!1),n&&(t.push("</ol>"),n=!1)},o=0,c=0,l=e.length;for(;o<l;){c=e.indexOf(`
`,o),c===-1&&(c=l);let d=e.substring(o,c),p=d.trim();Qo.test(p)?(i(),t.push(`<h3>${We(d.substring(4))}</h3>`)):Zo.test(p)?(i(),t.push(`<h2>${We(d.substring(3))}</h2>`)):Jo.test(p)?(i(),t.push(`<h1>${We(d.substring(2))}</h1>`)):er.test(p)?(n&&(t.push("</ol>"),n=!1),a||(t.push("<ul>"),a=!0),t.push(`<li>${We(d.trim().substring(2))}</li>`)):p.match(mn)?(a&&(t.push("</ul>"),a=!1),n||(t.push("<ol>"),n=!0),t.push(`<li>${We(d.replace(mn,""))}</li>`)):(i(),p.length>0&&t.push(`<p>${We(d)}</p>`)),o=c+1}return i(),t.join("")}function Se(e){typeof window>"u"||(typeof window.OneSignal>"u"?(window.OneSignalDeferred=window.OneSignalDeferred||[],window.OneSignalDeferred.push(e)):e(window.OneSignal))}var tr={selection:8,light:12,medium:20,heavy:40,success:[15,50,15],error:[40,60,15]};function M(e){if(typeof navigator<"u"&&navigator.vibrate)try{navigator.vibrate(tr[e])}catch{}}var Ye=null,Ht=null;function ar(){if(!(Ye&&Ht))try{let e=getComputedStyle(document.documentElement);Ye=e.getPropertyValue("--text-primary").trim()||"#e5e5e5",Ht=e.getPropertyValue("--bg-color").trim()||"#000000"}catch{Ye="#e5e5e5",Ht="#000000"}}function ma(e,t){let a=0;for(let n=0;n<2;n++){let i=e.charCodeAt(t+n);a<<=4,i>=48&&i<=57?a|=i-48:i>=65&&i<=70?a|=i-55:i>=97&&i<=102&&(a|=i-87)}return a}var fa=new Map;function lt(e){let t=fa.get(e);if(t)return t;if(ar(),!e||e.length<4)return Ye;try{let a=e;if(e.length===4&&e.charCodeAt(0)===35){let p=e[1],f=e[2],b=e[3];a=`#${p}${p}${f}${f}${b}${b}`}let n=a.charCodeAt(0)===35?1:0,i=ma(a,n),o=ma(a,n+2),c=ma(a,n+4),d=i*299+o*587+c*114>=128e3?Ht:Ye;return fa.size<100&&fa.set(e,d),d}catch{return Ye}}var It=9,dt=21,Ke=66,A={NULL:0,DONE:1,DEFERRED:2,DONE_PLUS:3},Ea={Morning:0,Afternoon:3,Evening:6},fn=[{labelKey:"freqDaily",value:{type:"daily"}},{labelKey:"freqSpecificDaysOfWeek",value:{type:"specific_days_of_week",days:[]}},{labelKey:"freqEvery",value:{type:"interval",unit:"days",amount:2}}],gn=730,Xe=["Morning","Afternoon","Evening"],pe=[{code:"pt",nameKey:"langPortuguese"},{code:"en",nameKey:"langEnglish"},{code:"es",nameKey:"langSpanish"}],s={version:It,habits:[],lastModified:0,dailyData:{},archives:{},dailyDiagnoses:{},unarchivedCache:new Map,streaksCache:new Map,habitAppearanceCache:new Map,scheduleCache:new Map,activeHabitsCache:new Map,daySummaryCache:new Map,selectedDate:O(),activeLanguageCode:"pt",pending21DayHabitIds:[],pendingConsolidationHabitIds:[],notificationsShown:[],hasOnboarded:!1,syncLogs:[],aiState:"idle",aiReqId:0,hasSeenAIResult:!0,lastAIResult:null,syncState:"syncInitial",initialSyncDone:!1,fullCalendar:{year:new Date().getUTCFullYear(),month:new Date().getUTCMonth()},uiDirtyState:{calendarVisuals:!0,habitListStructure:!0,chartData:!0},monthlyLogs:new Map,confirmAction:null,confirmEditAction:null,editingNoteFor:null,calendarDates:[]};function ce(){return{version:It,lastModified:s.lastModified,habits:s.habits,dailyData:s.dailyData,archives:s.archives,dailyDiagnoses:s.dailyDiagnoses,notificationsShown:s.notificationsShown,pending21DayHabitIds:s.pending21DayHabitIds,pendingConsolidationHabitIds:s.pendingConsolidationHabitIds,quoteState:s.quoteState,hasOnboarded:s.hasOnboarded,syncLogs:s.syncLogs,monthlyLogs:s.monthlyLogs}}function ut(){s.activeHabitsCache.clear()}function le(e){return s.dailyData[e]||(s.dailyData[e]={}),s.dailyData[e]}function Qe(e,t){let a=le(e);return a[t]||(a[t]={instances:{},dailySchedule:void 0}),a[t]}function xa(e,t,a){let n=Qe(e,t);return n.instances[a]||(n.instances[a]={}),n.instances[a]}function hn(){s.scheduleCache.clear()}function Ta(e,t){s.daySummaryCache.delete(e),s.streaksCache.forEach(a=>a.delete(e)),s.habitAppearanceCache.forEach(a=>a.delete(e)),s.scheduleCache.forEach(a=>a.delete(e))}function yn(){return s.uiDirtyState.chartData}function bn(){s.uiDirtyState.chartData=!0}function vn(){try{let e=I(O()),t=new Date(e);t.setUTCDate(t.getUTCDate()-90);let a=B(t);s.habitAppearanceCache.forEach((n,i)=>{n.forEach((o,c)=>{c<a&&n.delete(c)}),n.size===0&&s.habitAppearanceCache.delete(i)})}catch(e){console.warn("[Cache] Error pruning habitAppearanceCache:",e)}}function En(){try{let e=new Date(I(O())),t=new Date(e);t.setUTCFullYear(t.getUTCFullYear()-1);let a=B(t);s.streaksCache.forEach((n,i)=>{n.forEach((o,c)=>{c<a&&n.delete(c)}),n.size===0&&s.streaksCache.delete(i)})}catch(e){console.warn("[Cache] Error pruning streaksCache:",e)}}function nr(e){let t=new Map;for(let[a,n]of e.entries()){let i=0n;for(let o=1;o<=31;o++){let c=BigInt((o-1)*6),l=BigInt((o-1)*9);for(let d=0;d<3;d++){let p=c+BigInt(d*2),f=n>>p&3n,b=l+BigInt(d*3);i|=f<<b}}t.set(a,i)}return t}function xn(e,t){if(!e)return{version:t,habits:[],dailyData:{},archives:{},dailyDiagnoses:{},lastModified:Date.now(),notificationsShown:[],pending21DayHabitIds:[],pendingConsolidationHabitIds:[],hasOnboarded:!0,syncLogs:[],monthlyLogs:new Map};let a=e,n=a.version||0;if(a.monthlyLogs&&!(a.monthlyLogs instanceof Map))try{let i=Array.isArray(a.monthlyLogs)?a.monthlyLogs:Object.entries(a.monthlyLogs);a.monthlyLogs=new Map(i.map(([o,c])=>{let l=c;return c&&typeof c=="object"&&c.__type==="bigint"?l=BigInt(c.val):typeof c!="bigint"&&(l=BigInt(c)),[o,l]}))}catch(i){console.warn("[Migration] Failed to hydrate monthlyLogs",i),a.monthlyLogs=new Map}else a.monthlyLogs||(a.monthlyLogs=new Map);if(n<9&&a.monthlyLogs.size>0){console.info(`[Migration] Upgrading bitmasks from v${n} to v9...`);try{a.monthlyLogs=nr(a.monthlyLogs),console.info("[Migration] Bitmask expansion successful.")}catch(i){console.error("[Migration] Bitmask expansion failed!",i)}}return a.hasOnboarded===void 0&&(a.hasOnboarded=!0),a.syncLogs||(a.syncLogs=[]),a.version=t,a}var k=class{static resetCache(){this.shardCache.clear(),this.dirtyMonths.clear()}static markDirty(t){this.dirtyMonths.add(t)}static getLogKey(t,a){return`${t}_${a.substring(0,7)}`}static isValidLog(t){return typeof t=="bigint"}static getStatus(t,a,n){let i=this.getLogKey(t,a),o=s.monthlyLogs?.get(i);if(o!==void 0){let c=parseInt(a.substring(8,10),10),l=BigInt((c-1)*9+Ea[n]),d=o>>l&7n;return d>>2n&1n?0:Number(d&3n)}return 0}static setStatus(t,a,n,i){s.monthlyLogs||(s.monthlyLogs=new Map);let o=this.getLogKey(t,a),c=parseInt(a.substring(8,10),10),l=BigInt((c-1)*9+Ea[n]),d=~(7n<<l),p=s.monthlyLogs.get(o)||0n,f=0n;i===0?f=4n:f=BigInt(i);let b=p&d|f<<l;s.monthlyLogs.set(o,b),this.markDirty(a.substring(0,7)),s.uiDirtyState.chartData=!0}static pruneLogsForHabit(t){if(!s.monthlyLogs)return;let a=t+"_";for(let n of s.monthlyLogs.keys())if(n.startsWith(a)){let i=n.slice(-7);this.markDirty(i),s.monthlyLogs.delete(n)}s.uiDirtyState.chartData=!0}static getLogsGroupedByMonth(){if(!s.monthlyLogs||s.monthlyLogs.size===0)return this.resetCache(),{};if(this.dirtyMonths.size===0&&this.shardCache.size>0)return Object.fromEntries(this.shardCache);let t=new Map;for(let[a,n]of s.monthlyLogs.entries()){let i=a.slice(-7);(this.dirtyMonths.has(i)||!this.shardCache.has(i))&&(t.has(i)||t.set(i,[]),t.get(i).push([a,"0x"+n.toString(16)]))}for(let[a,n]of t)this.shardCache.set(a,n);for(let a of this.dirtyMonths)t.has(a)||this.shardCache.delete(a);return this.dirtyMonths.clear(),Object.fromEntries(this.shardCache)}static serializeLogsForCloud(){let t=this.getLogsGroupedByMonth();return Object.values(t).flat()}static deserializeLogsFromCloud(t){Array.isArray(t)&&(t.forEach(([a,n])=>{try{let i=n.startsWith("0x")?n:"0x"+n;s.monthlyLogs.set(a,BigInt(i))}catch{console.warn(`[HabitService] Skipping invalid hex log: ${a}`)}}),this.resetCache())}static mergeLogs(t,a){let n=new Map(t||[]);if(!a)return n;for(let[i,o]of a.entries()){let c=n.get(i)||0n,l=0n;for(let d=0n;d<93n;d++){let p=d*3n,f=c>>p&7n,b=o>>p&7n,E=0n,S=(f&4n)===4n,L=(b&4n)===4n;S||L?E=4n:E=f|b,l|=E<<p}n.set(i,l)}return n}static clearAllLogs(){s.monthlyLogs=new Map,this.resetCache(),s.uiDirtyState.chartData=!0}};k.shardCache=new Map,k.dirtyMonths=new Set;var h={},Z={};function ir(e,t=!1){let n=e.charCodeAt(0)===35&&!/[\s.\[]/.test(e)?document.getElementById(e.slice(1)):document.querySelector(e);if(!n&&!t)throw new Error(`UI element "${e}" not found.`);return n}function m(e,t,a,n,i=!1){Object.defineProperty(e,t,{get:function(){if(n[t]===void 0){let o=ir(a,i);return o&&(n[t]=o),o}return n[t]},enumerable:!0,configurable:!1})}var r={};m(r,"appContainer",".app-container",h);m(r,"calendarStrip","#calendar-strip",h);m(r,"headerTitle","#header-title",h);m(r,"headerTitleDesktop","#header-title .header-title-desktop",h);m(r,"headerTitleMobile","#header-title .header-title-mobile",h);m(r,"navArrowPast","#nav-arrow-past",h);m(r,"navArrowFuture","#nav-arrow-future",h);m(r,"stoicQuoteDisplay","#stoic-quote-display",h);m(r,"habitContainer","#habit-container",h);m(r,"chartContainer","#chart-container",h);m(r,"manageHabitsBtn","#manage-habits-btn",h);m(r,"fabAddHabit","#fab-add-habit",h);m(r,"manageModal","#manage-modal",h);m(r,"manageModalTitle","#manage-modal-title",h);m(r,"habitListTitle","#habit-list-title",h);m(r,"exploreModal","#explore-modal",h);m(r,"exploreHabitList","#explore-habit-list",h);m(r,"createCustomHabitBtn","#create-custom-habit-btn",h);m(r,"aiEvalBtn","#ai-eval-btn",h);m(r,"aiModal","#ai-modal",h);m(r,"aiOptionsModal","#ai-options-modal",h);m(r,"confirmModal","#confirm-modal",h);m(r,"habitList","#habit-list",h);m(r,"noHabitsMessage","#no-habits-message",h);m(r,"aiResponse","#ai-response",h);m(r,"confirmModalText","#confirm-modal-text",h);m(r,"confirmModalConfirmBtn","#confirm-modal-confirm-btn",h);m(r,"confirmModalEditBtn","#confirm-modal-edit-btn",h);m(r,"notesModal","#notes-modal",h);m(r,"notesModalTitle","#notes-modal-title",h);m(r,"notesModalSubtitle","#notes-modal-subtitle",h);m(r,"notesTextarea","#notes-textarea",h);m(r,"saveNoteBtn","#save-note-btn",h);m(r,"resetAppBtn","#reset-app-btn",h);m(r,"languagePrevBtn","#language-prev",h);m(r,"languageViewport","#language-viewport",h);m(r,"languageReel","#language-reel",h);m(r,"languageNextBtn","#language-next",h);m(r,"editHabitModal","#edit-habit-modal",h);m(r,"editHabitModalTitle","#edit-habit-modal-title",h);m(r,"editHabitForm","#edit-habit-form",h);m(r,"habitSubtitleDisplay","#habit-subtitle-display",h);m(r,"editHabitSaveBtn","#edit-habit-save-btn",h);m(r,"habitTimeContainer","#habit-time-container",h);m(r,"frequencyOptionsContainer","#frequency-options-container",h);m(r,"syncStatus","#sync-status",h);m(r,"syncSection","#sync-section",h);m(r,"syncInactiveView","#sync-inactive-view",h);m(r,"enableSyncBtn","#enable-sync-btn",h);m(r,"enterKeyViewBtn","#enter-key-view-btn",h);m(r,"syncEnterKeyView","#sync-enter-key-view",h);m(r,"syncKeyInput","#sync-key-input",h);m(r,"cancelEnterKeyBtn","#cancel-enter-key-btn",h);m(r,"submitKeyBtn","#submit-key-btn",h);m(r,"syncDisplayKeyView","#sync-display-key-view",h);m(r,"syncKeyText","#sync-key-text",h);m(r,"copyKeyBtn","#copy-key-btn",h);m(r,"keySavedBtn","#key-saved-btn",h);m(r,"syncActiveView","#sync-active-view",h);m(r,"viewKeyBtn","#view-key-btn",h);m(r,"disableSyncBtn","#disable-sync-btn",h);m(r,"notificationToggle","#notification-toggle",h);m(r,"notificationToggleLabel","#notification-toggle-label",h);m(r,"notificationStatusDesc","#notification-status-desc",h);m(r,"iconPickerModal","#icon-picker-modal",h);m(r,"iconPickerGrid","#icon-picker-grid",h);m(r,"habitIconPickerBtn","#habit-icon-picker-btn",h);m(r,"colorPickerModal","#color-picker-modal",h);m(r,"colorPickerGrid","#color-picker-grid",h);m(r,"changeColorFromPickerBtn","#change-color-from-picker-btn",h);m(r,"fullCalendarModal","#full-calendar-modal",h);m(r,"fullCalendarHeader","#full-calendar-header",h);m(r,"fullCalendarMonthYear","#full-calendar-month-year",h);m(r,"fullCalendarPrevBtn","#full-calendar-prev",h);m(r,"fullCalendarNextBtn","#full-calendar-next",h);m(r,"fullCalendarWeekdays","#full-calendar-weekdays",h);m(r,"fullCalendarGrid","#full-calendar-grid",h);m(r,"calendarQuickActions","#calendar-quick-actions",h);m(r,"quickActionDone","#quick-action-done",h);m(r,"quickActionSnooze","#quick-action-snooze",h);m(r,"quickActionAlmanac","#quick-action-almanac",h);m(r,"labelLanguage","#label-language",h);m(r,"labelSync","#label-sync",h);m(r,"labelNotifications","#label-notifications",h);m(r,"labelReset","#label-reset",h);m(r,"labelPrivacy","#label-privacy",h);m(r,"exportDataBtn","#export-data-btn",h);m(r,"importDataBtn","#import-data-btn",h);m(r,"syncInactiveDesc","#sync-inactive-desc",h);m(r,"labelEnterKey","#label-enter-key",h);m(r,"syncWarningText","#sync-warning-text",h);m(r,"syncActiveDesc","#sync-active-desc",h);m(r,"iconPickerTitle","#icon-picker-modal-title",h);m(r,"colorPickerTitle","#color-picker-modal-title",h);m(r,"habitConscienceDisplay","#habit-conscience-display",h,!0);m(r,"syncErrorMsg","#sync-error-msg",h);r.chart={};m(r.chart,"title","#chart-container .chart-title",Z);m(r.chart,"subtitle","#chart-container .app-subtitle",Z);m(r.chart,"emptyState","#chart-container .chart-empty-state",Z);m(r.chart,"dataView","#chart-container .chart-data-view",Z);m(r.chart,"wrapper","#chart-container .chart-wrapper",Z);m(r.chart,"svg",".chart-svg",Z);m(r.chart,"areaPath",".chart-area",Z);m(r.chart,"linePath",".chart-line",Z);m(r.chart,"tooltip","#chart-container .chart-tooltip",Z);m(r.chart,"tooltipDate","#chart-container .tooltip-date",Z);m(r.chart,"tooltipScoreLabel","#chart-container .tooltip-score-label",Z);m(r.chart,"tooltipScoreValue","#chart-container .tooltip-score-value",Z);m(r.chart,"tooltipHabits","#chart-container .tooltip-habits li",Z);m(r.chart,"indicator","#chart-container .chart-indicator",Z);m(r.chart,"evolutionIndicator","#chart-container .chart-evolution-indicator",Z);m(r.chart,"axisStart","#chart-container .chart-axis-labels span:first-child",Z);m(r.chart,"axisEnd","#chart-container .chart-axis-labels span:last-child",Z);var Ze={},kt={},Tn=new Map,Ot=new Map,or=100,_t={},pt={},mt={},Le={},Rt=new Map,rr={weekday:"short",timeZone:"UTC"},sr=Array.from({length:7},(e,t)=>new Date(Date.UTC(1970,0,4+t)));var cr={Morning:"filterMorning",Afternoon:"filterAfternoon",Evening:"filterEvening"},Pt=null,ft=null,Ln=null,Sa=null,La=null,wn=null,Dn=[],me=null,Sn=0,lr=/{([^{}]+)}/g,dr=5e3;function wa(e){if(Le[e])return Promise.resolve(!0);if(Rt.has(e))return Rt.get(e);let t=(async()=>{let a=new AbortController,n=setTimeout(()=>a.abort(),dr);try{let i=await fetch(`./locales/${e}.json`,{signal:a.signal});if(clearTimeout(n),!i.ok)throw new Error(`Status: ${i.status}`);let o=await i.json();return Le[e]=o,!0}catch(i){if(clearTimeout(n),console.error(`Could not load translations for ${e}:`,i),e!=="pt"&&!Le.pt)try{console.warn("Attempting to load fallback 'pt'"),await wa("pt")}catch(o){console.error("CRITICAL: Could not load fallback language 'pt'.",o)}return!1}finally{Rt.delete(e)}})();return Rt.set(e,t),t}function ur(e){wa(e).then(t=>{t&&s.activeLanguageCode===e&&(we(e),document.dispatchEvent(new CustomEvent("language-changed")))})}function we(e){if(me=e,Le[e]?(Pt=Le[e],e!=="pt"&&Le.pt?ft=Le.pt:ft=null):(Pt=Le.pt||null,ft=null,ur(e)),!Ze[e])try{Ze[e]=new Intl.PluralRules(e)}catch{try{Ze[e]=new Intl.PluralRules("pt")}catch{Ze[e]={select:()=>"other"}}}if(Ln=Ze[e],!kt[e])try{kt[e]=new Intl.Collator(e,{sensitivity:"base",numeric:!0})}catch{kt[e]=new Intl.Collator("pt")}if(Sa=kt[e],!_t[e])try{_t[e]=new Intl.ListFormat(e,{style:"long",type:"conjunction"})}catch{_t[e]={format:a=>Array.from(a).join(", ")}}if(La=_t[e],!pt[e])try{pt[e]={int:new Intl.NumberFormat(e,{maximumFractionDigits:0}),dec:new Intl.NumberFormat(e,{minimumFractionDigits:2,maximumFractionDigits:2}),evo:new Intl.NumberFormat(e,{minimumFractionDigits:1,maximumFractionDigits:1})}}catch{let a={maximumFractionDigits:0},n={minimumFractionDigits:2,maximumFractionDigits:2},i={minimumFractionDigits:1,maximumFractionDigits:1};try{pt[e]={int:new Intl.NumberFormat("pt",a),dec:new Intl.NumberFormat("pt",n),evo:new Intl.NumberFormat("pt",i)}}catch{pt[e]={int:new Intl.NumberFormat(void 0,a),dec:new Intl.NumberFormat(void 0,n),evo:new Intl.NumberFormat(void 0,i)}}}if(wn=pt[e],!mt[e])try{let t=new Intl.DateTimeFormat(e,rr);mt[e]=sr.map(a=>t.format(a).toUpperCase())}catch{mt[e]=mt.pt||[]}Dn=mt[e]}function u(e,t){if(s.activeLanguageCode!==me&&we(s.activeLanguageCode),!Pt)return e;let a=Pt[e];if(a===void 0&&ft&&(a=ft[e]),a===void 0)return e;let n;if(typeof a=="string")n=a;else if(t?.count!==void 0){let o=(Ln||Ze.pt||new Intl.PluralRules("en")).select(t.count),c=a[o]||a.other;if(!c)return e;n=c}else return e;return t&&n.includes("{")?n.replace(lr,(i,o)=>{let c=t[o];return c!==void 0?String(c):i}):n}function Mn(e,t){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),Sa?Sa.compare(e,t):e.localeCompare(t)}function ue(e,t){if(e==null)return"---";let a;if(typeof e=="number"?a=new Date(e):e instanceof Date?a=e:a=new Date(e),isNaN(a.getTime()))return"---";s.activeLanguageCode!==me&&we(s.activeLanguageCode);let n=Tn.get(me);n||(n=new WeakMap,Tn.set(me,n));let i=n.get(t);if(i)return i.format(a);let o=Object.keys(t).sort(),c="";for(let d of o)c+=`${d}:${t[d]};`;let l=`${me}|${c}`;return i=Ot.get(l),i||(Ot.size>or&&Ot.clear(),i=new Intl.DateTimeFormat(me,t),Ot.set(l,i)),n.set(t,i),i.format(a)}function Da(e,t){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),wn[t].format(e)}var ke=e=>Da(e,"int"),Cn=e=>Da(e,"dec"),An=e=>Da(e,"evo");function Hn(e){return e.length===0?"":(s.activeLanguageCode!==me&&we(s.activeLanguageCode),La?La.format(e):e.join(", "))}function Ue(e){return u(cr[e]||`filter${e}`)}function In(e){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),Dn[e.getUTCDay()]||""}function Nt(){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),u(pe.find(e=>e.code===s.activeLanguageCode)?.nameKey||"langEnglish")}async function Bt(e){if(s.activeLanguageCode===e&&Le[e])return;let t=++Sn,a=await wa(e);t===Sn&&(a?(s.activeLanguageCode=e,we(e),document.documentElement.lang=e,localStorage.setItem("habitTrackerLanguage",e),Se(n=>{n.User.setLanguage(e)}),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,s.uiDirtyState.chartData=!0,document.dispatchEvent(new CustomEvent("language-changed"))):console.warn(`setLanguage aborted: Failed to load ${e}`))}var T='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">',w='<path d="',D='"/></svg>',kn="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7m.5-8.5a2.1 2.1 0 013 3L12 15l-4 1 1-4 9.5-9.5z",Ma="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8zv6h6",On="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2",pr="M12 2a10 10 0 100 20 10 10 0 000-20",Rn="M12 7a5 5 0 100 10 5 5 0 000-10m0-6v2m0 18v2M4.2 4.2l1.4 1.4m12.8 12.8 1.4 1.4M1 12h2m18 0h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4",Pn="M21 12.8A9 9 0 1111.2 3 7 7 0 0021 12.8z",_n="M12 22a7 7 0 007-7c0-2.3-1.3-4.9-3.4-7.4C13.8 5.1 12 2.8 12 2.8s-1.8 2.3-3.6 4.8C6.3 10.1 5 12.7 5 15a7 7 0 007 7z",C={read:T+w+"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2zM22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"+D,meditate:T+w+"M8.2 16.2c-1.3-1.3-2.2-3-2.2-4.9C6 9.4 7.1 7.8 8.8 6.8M15.8 16.2c1.3-1.3 2.2-3 2.2-4.9 0-1.9-1.1-3.5-2.8-4.5M12 13a3 3 0 100-6 3 3 0 000 6zM12 21a9 9 0 009-9M3 12a9 9 0 019-9"+D,water:T+w+_n+D,exercise:T+w+"M22 12h-4l-3 9L9 3l-3 9H2"+D,stretch:T+w+"M12 4a1 1 0 100 2 1 1 0 000-2M9 20l3-6 3 6M6 12l6-2 6 2"+D,journal:T+w+Ma+"M16 13H8M16 17H8"+D,language:T+w+"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"+D,organize:T+w+"M21 16V8a2 2 0 00-1-1.7l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.7l7 4a2 2 0 002 0l7-4A2 2 0 0021 16zM3.3 7 12 12 20.7 7M12 22.1V12"+D,walk:T+w+"M14.9 14.3c.3-.5.3-1.1 0-1.6l-4-6c-.6-1-1.8-1.2-2.8-.6-.9.6-1.2 1.8-.6 2.8l4 6c.6 1 1.8 1.2 2.8.6.2-.1.3-.3.4-.4zM12 12l-2-2M10.1 18.7c.3-.5.3-1.1 0-1.6l-4-6c-.6-1-1.8-1.2-2.8-.6-.9.6-1.2 1.8-.6 2.8l4 6c.6 1 1.8 1.2 2.8.6.2-.1.3-.3.4-.4zz"+D,planDay:T+w+"M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20m-3.54 3.54L12 12l3.54-3.54M12 12l-3.54 3.54L12 12z"+D,creativeHobby:T+w+"M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"+D,gratitude:T+w+"M20.8 4.6a5.5 5.5 0 00-7.8 0L12 5.7l-1.1-1.1a5.5 5.5 0 00-7.8 7.8l1.1 1.1L12 21.2l7.8-7.8 1.1-1.1a5.5 5.5 0 000-7.8z"+D,talkFriend:T+w+"M21 11.5a8.4 8.4 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.4 8.4 0 01-3.8-.9L3 21l1.9-5.7a8.4 8.4 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.4 8.4 0 013.8-.9h.5a8.5 8.5 0 018 8v.5z"+D,instrument:T+w+"M9 18V5l12-2v13M6 21a3 3 0 100-6 3 3 0 000 6M18 19a3 3 0 100-6 3 3 0 000 6"+D,plants:T+w+"M7 20h10M12 4v16M10 4c-2.5 1.5-4 4-4 7M14 4c2.5 1.5 4 4 4 7"+D,finances:T+w+"M18 20V10M12 20V4M6 20V14"+D,tea:T+w+"M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zm4-6v2m4-2v2m4-2v2m4-2v2m4-2v2"+D,podcast:T+w+"M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zM19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"+D,emails:T+w+"M22 12h-6l-2 3h-4l-2-3H2M5.5 5.1L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.5-6.9A2 2 0 0016.8 4H7.2a2 2 0 00-1.8 1.1z"+D,skincare:T+w+"M17.66 7.34C16.5 5.88 14.37 5 12 5s-4.5.88-5.66 2.34A8 8 0 004 12c0 4.42 3.58 8 8 8s8-3.58 8-8a8 8 0 00-2.34-4.66z"+D,sunlight:T+w+Rn+D,draw:T+w+"M12 19l7-7 3 3-7 7-3-3zM18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5zM2 2l7.6 7.6M11 13a2 2 0 100-4 2 2 0 000 4"+D,familyTime:T+w+"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8M23 21v-2a4 4 0 00-3-3.9M16 3.1a4 4 0 010 7.8"+D,news:T+w+"M4 22h16a2 2 0 002-2V4a2 2 0 00-2-2H8a2 2 0 00-2 2v16a2 2 0 01-2 2Zm0 0a2 2 0 01-2-2v-9c0-1.1.9-2 2-2h2M18 14h-8M15 18h-5M10 6h8v4h-8V6Z"+D,cookHealthy:T+w+"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2M7 2v20M21 15V2v0a5 5 0 00-5 5v6c0 1.1.9 2 2 2h3"+D,learnSkill:T+w+"M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.8-3.8a6 6 0 01-7.9 7.9l-6.9 6.9a2.1 2.1 0 01-3-3l6.9-6.9a6 6 0 017.9-7.9l-3.8 3.8z"+D,photography:T+w+"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2zM12 17a4 4 0 100-8 4 4 0 000 8"+D,yoga:T+w+"M12 6a2 2 0 100-4 2 2 0 000 4M15 22v-4a2 2 0 00-2-2h-2a2 2 0 00-2 2v4M9 13l-2-2M15 13l2-2"+D,reflectDay:T+w+Pn+D,custom:T+w+"M12 2 15.1 8.3 22 9.3 17 14.1 18.2 21 12 17.8 5.8 21 7 14.1 2 9.3 8.9 8.3 12 2z"+D,stoicism:T+w+"M4 22h16M7 21V10M17 21V10M12 21V10M4 10h16M4 7h16M4 4h16"+D,wind:T+w+"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"+D,sustenance:T+w+_n+D,snowflake:T+w+"M2 12h20M12 2v20M20 20L4 4m16 0L4 20M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41M12 2.2V4.5M12 19.5v2.3M2.2 12h2.3M19.5 12h2.3"+D,dignity:T+w+"M12 2L2 7l10 15 10-15L12 2z"+D,sunMoon:T+w+"M20 15.31L23.31 12 20 8.69V4h-4.69L12 0.69 8.69 4H4v4.69L0.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z M12 6v12c3.31 0 6-2.69 6-6s-2.69-6-6-6z"+D,presence:T+w+"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"+D,abstention:T+w+"M7 11v-1a5 5 0 1110 0v1h2v11H5V11h2zm2 0h6v-1a3 3 0 10-6 0v1z"+D,movement:T+w+"M13 6v12l8.5-6L13 6z M4 6v12l8.5-6L4 6z"+D,discernment:T+w+"M12 21v-6M12 15l-6-6M12 15l6-6M6 9l-3-3M6 9l3-3M18 9l-3-3M18 9l3-3"+D,zeal:T+w+"M12 2a10 10 0 100 20 10 10 0 000-20zM2 12h20M12 2c2 3.33 2 14.67 0 18-2-3.33-2-14.67 0-18z"+D,anticipation:T+w+"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"+D},K={settings:T+w+"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"+D,ai:T+w+"M12 8V4H8M6 8h12a2 2 0 012 2v8a2 2 0 01-2 2H6a2 2 0 01-2-2v-8a2 2 0 012-2M2 14h2M20 14h2M15 13v2M9 13v2"+D,check:T+w+"M20 6L9 17l-5-5"+D,snoozed:T+w+"M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20zM12 6v6l4 2"+D,swipeDelete:T+w+On+D,swipeNote:T+w+Ma+D,swipeNoteHasNote:T+'<path fill="currentColor" d="'+Ma+'"/></svg>',editAction:T+w+kn+D,graduateAction:T+w+"M22 10v6M2 10l10-5 10 5-10 5zM6 12v5c3 3 9 3 12 0v-5"+D,endAction:T+w+pr+"M15 9l-6 6M9 9l6 6"+D,deletePermanentAction:T+w+On+D,edit:T+w+kn+D,colorPicker:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path fill="#e74c3c" d="M12 12 L12 2 A10 10 0 0 1 22 12 Z"/><path fill="#f1c40f" d="M12 12 L2 12 A10 10 0 0 1 12 2 Z"/><path fill="#2ecc71" d="M12 12 L12 22 A10 10 0 0 1 2 12 Z"/><path fill="#3498db" d="M12 12 L22 12 A10 10 0 0 1 12 22 Z"/></svg>',morning:T+w+"M12 9V7M4.2 10.2l1.4 1.4M19.8 10.2l-1.4 1.4M1 18h2m18 0h2M17 18a5 5 0 00-10 0M2 22h20"+D,afternoon:T+w+Rn+D,evening:T+w+Pn+D,calendar:T+w+"M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zM16 2v4M8 2v4M3 10h18"+D,backArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>'};var mr={Morning:K.morning,Afternoon:K.afternoon,Evening:K.evening};function qe(e){return mr[e]??K.morning}var gt=new Map,fr=365,ht=750;function gr(e){let t=gt.get(e);return t||(gt.size>fr&&gt.clear(),t=I(e),gt.set(e,t)),t}var Nn=()=>gt.clear();function Oe(e,t){let a=s.scheduleCache.get(e.id);if(!a)a=new Map,s.scheduleCache.set(e.id,a);else{let o=a.get(t);if(o!==void 0)return o}let n=e.scheduleHistory;if(!n||!Array.isArray(n)||n.length===0)return a.set(t,null),null;let i=null;for(let o=n.length-1;o>=0;o--){let c=n[o];if(t>=c.startDate){(!c.endDate||t<c.endDate)&&(i=c);break}}return a.size>ht&&a.clear(),a.set(t,i),i}function fe(e,t){let a=le(t)[e.id];return a?.dailySchedule?a.dailySchedule:Oe(e,t)?.times||[]}function _e(e,t){return!e?.scheduleHistory||e.scheduleHistory.length===0?null:Oe(e,t)||e.scheduleHistory[e.scheduleHistory.length-1]}function de(e,t,a){let n=e,i=t||O();"scheduleHistory"in e&&e.scheduleHistory.length>0&&(n=_e(e,i)||e.scheduleHistory[e.scheduleHistory.length-1]);let o={name:n.nameKey?u(n.nameKey):n.name||"",subtitle:n.subtitleKey?u(n.subtitleKey):n.subtitle||""};if(a&&"id"in e){let c=e,l=k.getStatus(c.id,i,a),p=le(i)[c.id]?.instances[a];return{...o,status:l,isCompleted:l===A.DONE||l===A.DONE_PLUS,note:p?.note,value:p?.goalOverride||0}}return o}function et(e,t,a){if(e.deletedOn&&t>=e.deletedOn)return!1;let n=s.habitAppearanceCache.get(e.id);n||(n=new Map,s.habitAppearanceCache.set(e.id,n));let i=n.get(t);if(i!==void 0)return i;let o=Oe(e,t);if(!o||e.graduatedOn)return n.set(t,!1),!1;let{frequency:c}=o,l=a||I(t),d=!1;switch(c.type){case"daily":d=!0;break;case"specific_days_of_week":d=c.days.includes(l.getUTCDay());break;case"interval":let p=gr(o.scheduleAnchor||o.startDate),f=Math.round((l.getTime()-p.getTime())/864e5);c.unit==="days"?d=f>=0&&f%c.amount===0:d=f>=0&&l.getUTCDay()===p.getUTCDay()&&Math.floor(f/7)%c.amount===0;break}return n.size>ht&&n.clear(),n.set(t,d),d}function hr(e,t){let a=fe(e,t);if(a.length===0)return!0;for(let n=0;n<a.length;n++){let i=a[n],o=k.getStatus(e.id,t,i);if(o!==A.DONE&&o!==A.DONE_PLUS)return!1}return!0}function De(e,t){let a=typeof e=="string"?s.habits.find(p=>p.id===e):e;if(!a)return 0;let n=s.streaksCache.get(a.id);n||(n=new Map,s.streaksCache.set(a.id,n));let i=n.get(t);if(i!==void 0)return i;let o=I(t);if(isNaN(o.getTime()))return 0;let c=0,l=o.getTime(),d=new Date;for(let p=0;p<gn;p++){d.setTime(l);let f=B(d);if(f<a.createdOn)break;if(et(a,f,d))if(hr(a,f))c++;else break;l-=864e5}return n.size>ht&&n.clear(),n.set(t,c),c}function Ca(e,t,a){let n=_e(e,t);if(!n||n.goal.type==="check"||!n.goal.total)return 1;let i=le(t)[e.id];if(i?.instances[a]?.goalOverride!==void 0)return i.instances[a].goalOverride;let o=n.goal.total,c=I(t).getTime(),l=I(O()).getTime(),d=c>l?l:c-864e5,p=new Date(d),f=null,b=0;for(let S=0;S<14;S++){let L=B(p);if(L<e.createdOn)break;if(et(e,L,p)){let _=k.getStatus(e.id,L,a);if(_===A.DONE||_===A.DONE_PLUS){let R=le(L)[e.id]?.instances?.[a];if(R&&R.goalOverride!==void 0)if(f===null)f=R.goalOverride,b++;else if(f===R.goalOverride)b++;else break;else break}}if(b>=2)return f;p.setTime(p.getTime()-864e5)}let E=De(e,B(new Date(c-864e5)));return Math.max(5,o+Math.floor(E/7)*5)}function Je(e,t,a){return le(t)[e.id]?.instances[a]?.goalOverride??Ca(e,t,a)}function Bn(e,t){let a=s.activeHabitsCache.get(e);if(a)return a;let n=t||I(e),i=[];for(let o=0;o<s.habits.length;o++){let c=s.habits[o];if(et(c,e,n)){let l=fe(c,e);l.length>0&&i.push({habit:c,schedule:l})}}return s.activeHabitsCache.size>ht&&s.activeHabitsCache.clear(),s.activeHabitsCache.set(e,i),i}function J(e,t){let a=s.daySummaryCache.get(e);if(a)return a;let n=0,i=0,o=0,c=0,l=t||I(e),d=[];for(let b=0;b<s.habits.length;b++){let E=s.habits[b];if(!et(E,e,l))continue;let S=fe(E,e),L=_e(E,e);for(let _=0;_<S.length;_++){let F=S[_],R=k.getStatus(E.id,e,F);n++,R===A.DONE||R===A.DONE_PLUS?(i++,L&&L.goal.type!=="check"&&L.goal.total&&d.push({habit:E,time:F,status:R})):R===A.DEFERRED?o++:c++}}let p=!1;if(n>0&&i===n){let b=B(new Date(l.getTime()-864e5)),E=B(new Date(l.getTime()-864e5*2)),S=J(b),L=J(E);if(S.total>0&&S.completed===S.total&&L.total>0&&L.completed===L.total){for(let _ of d)if(_.status===A.DONE_PLUS){let{habit:F,time:R}=_,j=Je(F,e,R),re=Je(F,b,R),X=Je(F,E,R);if(j>re&&j>X){p=!0;break}}}}let f={total:n,completed:i,snoozed:o,pending:c,completedPercent:n?i/n*100:0,snoozedPercent:n?o/n*100:0,showPlusIndicator:p};return s.daySummaryCache.size>ht&&s.daySummaryCache.clear(),s.daySummaryCache.set(e,f),f}var ge={AI_MATCH:50,SPHERE_MATCH:40,RECOVERY:35,PERFORMANCE:30,MOMENTUM:25,TIME_OF_DAY:15,VIRTUE_ALIGN:10,RECENTLY_SHOWN:-100},yr=20*60*1e3,br=.8,vr=.7,Er=.25,xr=.15,Tr=10,Sr=.5;function Fn(){let e=new Date().getHours();return e<12?"morning":e<18?"afternoon":"evening"}function Lr(e){let t=5381,a=e.length;for(;a;)t=t*33^e.charCodeAt(--a);return t>>>0}function wr(e){let t=I(e),a=0,n=0;for(let i=1;i<=Tr;i++){let o=new Date(t);o.setUTCDate(t.getUTCDate()-i);let c=B(o),l=J(c);l.total>0&&(a++,l.completed/l.total>=Sr&&n++)}return a===0?1:n/a}function Dr(e,t){let a={};e.forEach(o=>{let c=Oe(o,t);if(c?.times.length>0&&c.philosophy){let l=c.philosophy.virtue;a[l]=(a[l]||0)+1}});let n=0;Object.values(a).forEach(o=>{o>n&&(n=o)});let i=new Set;return n>0&&Object.entries(a).forEach(([o,c])=>{c===n&&i.add(o)}),i}function Mr(e,t){let a={};e.forEach(o=>{let c=Oe(o,t);if(c?.philosophy){let l=c.philosophy.sphere;a[l]||(a[l]={total:0,done:0}),fe(o,t).forEach(p=>{a[l].total++;let f=k.getStatus(o.id,t,p);(f===A.DONE||f===A.DONE_PLUS)&&a[l].done++})}});let n=1,i=null;return Object.entries(a).forEach(([o,c])=>{if(c.total>0){let l=c.done/c.total;l<1&&l<=n&&(n=l,i=o)}}),n<.5?i:null}function Cr(e){let t=J(e);if(t.total>0&&t.completed/t.total<.2)return!1;let a=I(e),n=new Date(a.getTime()-864e5),i=B(n),o=J(i);return o.total>0&&o.completed/o.total<.4&&t.completed>0}function Ar(e,t){let a=0;for(let n of e){let i=De(n,t);i>a&&(a=i)}return a>10?"unbroken":a>3?"building":"none"}function Hr(e,t){let a=J(e),n=Fn();if(a.total===0)return"neutral";let i=a.completed/a.total,o=a.snoozed/a.total;if(i>=br)return"triumph";if(o>Er)return"struggle";if(e===O()&&n==="evening"&&i<.1&&o<.1)return"urgency";if(i<.2&&o<.2)return wr(e)<.4?"defeat":"neutral";let l="neutral";if(t&&t.includes("-")){let d=t.split("-");d[4]&&(l=d[4])}return l==="triumph"&&i>=vr?"triumph":l==="struggle"&&o>xr?"struggle":"neutral"}function Ir(e){let t=s.quoteState,a=s.dailyDiagnoses[e],n=new Set((a?a.themes:[]).map(b=>b.toLowerCase())),i=Dr(s.habits,e),o=Mr(s.habits,e),c=Cr(e),l=Ar(s.habits,e),d=Fn(),p=Hr(e,t?.lockedContext),f=!1;if(t&&t.lockedContext){let b=t.lockedContext.split("-");b[4]!==p&&(p==="triumph"||p==="defeat"||p==="urgency")&&(f=!0),b[3]!==d&&(f=!0)}else f=!0;return{timeOfDay:d,dominantVirtues:i,neglectedSphere:o,isRecovery:c,performanceState:p,momentumState:l,aiThemes:n,lastShownId:t?.currentId,isMajorShift:f}}function kr(e,t){let a=1,n=(o,c,l)=>{if(o){for(let d of c)if(e.metadata.tags.includes(d)){a+=l;return}}};if(t.lastShownId===e.id&&(a+=ge.RECENTLY_SHOWN),t.aiThemes.size>0){let o=e.metadata.tags.filter(c=>t.aiThemes.has(c));a+=o.length*ge.AI_MATCH}t.neglectedSphere&&e.metadata.sphere===t.neglectedSphere&&(a+=ge.SPHERE_MATCH),n(t.isRecovery,["resilience","growth","hope"],ge.RECOVERY),t.timeOfDay==="morning"&&n(!0,["morning"],ge.TIME_OF_DAY),t.timeOfDay==="evening"&&n(!0,["evening","reflection","rest"],ge.TIME_OF_DAY),t.dominantVirtues.has(e.metadata.virtue)&&(a+=ge.VIRTUE_ALIGN);let i=t.performanceState;return i==="defeat"?n(!0,["resilience","acceptance","fate"],ge.PERFORMANCE):i==="triumph"?n(!0,["humility","temperance","death"],ge.PERFORMANCE):i==="struggle"?n(!0,["discipline","action","focus"],ge.PERFORMANCE):i==="urgency"&&(e.metadata.tags.includes("urgency")||e.metadata.tags.includes("time")||e.metadata.tags.includes("action")||e.metadata.tags.includes("death"))&&(a+=ge.PERFORMANCE*1.2),n(t.momentumState==="unbroken",["consistency","habit"],ge.MOMENTUM),a}function zn(e,t){if(!e||e.length===0)throw new Error("No quotes provided to engine.");(!t||isNaN(Date.parse(t)))&&(t=O());let a=Ir(t),n=t===O();if(n&&s.quoteState&&!a.isMajorShift&&Date.now()-s.quoteState.displayedAt<yr){let ae=e.find(he=>he.id===s.quoteState.currentId);if(ae)return ae}let i=e.map(X=>({quote:X,score:kr(X,a)}));i.sort((X,ae)=>ae.score-X.score);let o=i[0].score,c=o>10?o*.7:0,l=i.filter(X=>X.score>=c);l.length>5&&(l=l.slice(0,5));let d=Array.from(a.dominantVirtues).sort().join(""),p=a.neglectedSphere||"none",f=`${t}-${a.timeOfDay}-${a.performanceState}-${d}-${p}`,b=parseInt(t.substring(0,4),10),E=parseInt(t.substring(8,10),10),S=n?new Date().getHours():12,L=isNaN(b)?2024:b,_=isNaN(E)?1:E,R=Math.abs(Lr(f)+L*_+S)%1e3/1e3,j=Math.floor(R*l.length),re=l[j].quote;return n&&(s.quoteState={currentId:re.id,displayedAt:Date.now(),lockedContext:f}),re}function v(e,t){e&&(e.firstChild&&e.firstChild.nodeType===3&&!e.firstChild.nextSibling?e.firstChild.nodeValue!==t&&(e.firstChild.nodeValue=t):e.textContent!==t&&(e.textContent=t))}function Ft(e,t,a,n){e&&(e.setAttribute("role","slider"),e.setAttribute("aria-label",u(n)),e.setAttribute("aria-valuemin","1"),e.setAttribute("aria-valuemax",String(a.length)),e.setAttribute("aria-valuenow",String(t+1)),e.setAttribute("aria-valuetext",a[t]||""),e.setAttribute("tabindex","0"))}var y={HABIT_CARD:"habit-card",HABIT_CONTENT_WRAPPER:"habit-content-wrapper",HABIT_DETAILS:"habit-details",HABIT_GOAL_CONTROLS:"habit-goal-controls",GOAL_VALUE_WRAPPER:"goal-value-wrapper",GOAL_CONTROL_BTN:"goal-control-btn",SWIPE_DELETE_BTN:"swipe-delete-btn",SWIPE_NOTE_BTN:"swipe-note-btn",DAY_ITEM:"day-item",DAY_NAME:"day-name",DAY_NUMBER:"day-number",DAY_PROGRESS_RING:"day-progress-ring",HABIT_GROUP:"habit-group",DROP_ZONE:"drop-zone",EMPTY_GROUP_PLACEHOLDER:"empty-group-placeholder",DRAG_IMAGE_GHOST:"drag-image-ghost",SELECTED:"selected",TODAY:"today",COMPLETED:"completed",SNOOZED:"snoozed",PENDING:"pending",DRAGGING:"dragging",IS_SWIPING:"is-swiping",IS_OPEN_LEFT:"is-open-left",IS_OPEN_RIGHT:"is-open-right",INVALID_DROP:"invalid-drop",DRAG_OVER:"drag-over"},z={HABIT_CARD:`.${y.HABIT_CARD}`,HABIT_CONTENT_WRAPPER:`.${y.HABIT_CONTENT_WRAPPER}`,GOAL_VALUE_WRAPPER:`.${y.GOAL_VALUE_WRAPPER}`,GOAL_CONTROL_BTN:`.${y.GOAL_CONTROL_BTN}`,SWIPE_DELETE_BTN:`.${y.SWIPE_DELETE_BTN}`,SWIPE_NOTE_BTN:`.${y.SWIPE_NOTE_BTN}`,HABIT_GOAL_CONTROLS:`.${y.HABIT_GOAL_CONTROLS}`,DAY_ITEM:`.${y.DAY_ITEM}`,DROP_ZONE:`.${y.DROP_ZONE}`,EMPTY_GROUP_PLACEHOLDER:`.${y.EMPTY_GROUP_PLACEHOLDER}`};var Kn=15,$n=200,Un=null,qn=null,Or={weekday:"long",day:"numeric",month:"long",timeZone:"UTC"},Gn=Array.from({length:100},(e,t)=>(t<10?"0":"")+t),_r=()=>Un||(Un=(()=>{let e=document.createElement("div");return e.className=y.DAY_ITEM,e.setAttribute("role","button"),e.innerHTML=`<span class="${y.DAY_NAME}"></span><div class="${y.DAY_PROGRESS_RING}"><span class="${y.DAY_NUMBER}"></span></div>`,e})()),Vn=()=>qn||(qn=(()=>{let e=document.createElement("div");return e.className="full-calendar-day",e.setAttribute("role","button"),e.innerHTML=`<div class="${y.DAY_PROGRESS_RING}"><span class="${y.DAY_NUMBER}"></span></div>`,e})());function Wn(e,t,a){let n=e.querySelector(`.${y.DAY_PROGRESS_RING}`),i=n.firstElementChild,{completedPercent:o,snoozedPercent:c,showPlusIndicator:l}=J(t,a);n.style.setProperty("--completed-percent",`${o}%`),n.style.setProperty("--snoozed-percent",`${c}%`),l?i.classList.add("has-plus"):i.classList.remove("has-plus")}function Aa(e,t,a){let n=_r().cloneNode(!0),i=I(e);n.dataset.date=e;let o=n.firstElementChild,l=o.nextElementSibling.firstElementChild;return v(o,In(i)),v(l,ke(i.getUTCDate())),t&&n.classList.add(y.SELECTED),a&&n.classList.add(y.TODAY),Wn(n,e,i),n.setAttribute("aria-label",i.toLocaleDateString(s.activeLanguageCode,Or)),t?(n.setAttribute("aria-current","date"),n.setAttribute("tabindex","0")):n.setAttribute("tabindex","-1"),n}function Ha(e){if(!r.calendarStrip)return;let t=r.calendarStrip.querySelector(`.${y.DAY_ITEM}[data-date="${e}"]`);t&&Wn(t,e)}function Yn(){if(!r.calendarStrip||!s.uiDirtyState.calendarVisuals&&r.calendarStrip.children.length>0)return;let e=s.selectedDate||O(),t=I(e),a=O(),n=document.createDocumentFragment();for(let i=-Kn;i<=Kn;i++){let o=se(t,i),c=B(o),l=Aa(c,c===e,c===a);n.appendChild(l)}r.calendarStrip.innerHTML="",r.calendarStrip.appendChild(n),s.uiDirtyState.calendarVisuals=!1,requestAnimationFrame(()=>zt(!1))}function jn(e,t=r.calendarStrip){let a=se(I(e),1),n=B(a),i=O(),o=Aa(n,n===s.selectedDate,n===i);return t.appendChild(o),t===r.calendarStrip&&r.calendarStrip.children.length>$n&&r.calendarStrip.firstElementChild?.remove(),n}function Xn(e,t=r.calendarStrip){let a=se(I(e),-1),n=B(a),i=O(),o=Aa(n,n===s.selectedDate,n===i);return t instanceof DocumentFragment?t.prepend(o):t.insertBefore(o,t.firstElementChild),t===r.calendarStrip&&r.calendarStrip.children.length>$n&&r.calendarStrip.lastElementChild?.remove(),n}function Re(){if(!r.fullCalendarGrid||!s.fullCalendar)return;let{year:e,month:t}=s.fullCalendar;r.fullCalendarMonthYear.textContent=new Date(Date.UTC(e,t,1)).toLocaleDateString(s.activeLanguageCode,{month:"long",year:"numeric",timeZone:"UTC"});let a=document.createDocumentFragment(),n=new Date(Date.UTC(e,t,1)),i=new Date(Date.UTC(e,t+1,0)).getUTCDate(),o=n.getUTCDay(),c=new Date(Date.UTC(e,t,0)).getUTCDate();for(let p=0;p<o;p++){let f=c-o+1+p,b=Vn().cloneNode(!0);b.classList.add("other-month"),b.firstElementChild.firstElementChild.textContent=ke(f),a.appendChild(b)}let l=O(),d=`${e}-${Gn[t+1]}-`;for(let p=1;p<=i;p++){let f=d+Gn[p],b=Vn().cloneNode(!0),E=b.firstElementChild,S=E.firstElementChild;S.textContent=ke(p),b.dataset.date=f;let{completedPercent:L,snoozedPercent:_,showPlusIndicator:F}=J(f,I(f));L>0&&E.style.setProperty("--completed-percent",`${L}%`),_>0&&E.style.setProperty("--snoozed-percent",`${_}%`),F&&S.classList.add("has-plus"),f===s.selectedDate&&b.classList.add(y.SELECTED),f===l&&b.classList.add(y.TODAY),a.appendChild(b)}r.fullCalendarGrid.innerHTML="",r.fullCalendarGrid.appendChild(a)}function zt(e=!0){r.calendarStrip&&requestAnimationFrame(()=>{let t=r.calendarStrip.querySelector(`.${y.SELECTED}`);if(t){let a=r.calendarStrip.clientWidth,n=t.offsetLeft,i=t.offsetWidth,o=t.classList.contains(y.TODAY),c;o?c=n+i-a+10:c=n-a/2+i/2,r.calendarStrip.scrollTo({left:c,behavior:e?"smooth":"auto"})}})}var tt=new Map,Kt={Morning:[],Afternoon:[],Evening:[]},Qn=new Map,ni=new WeakMap;function Rr(e){let t=Qn.get(e);if(!t&&r.habitContainer){let a=r.habitContainer.querySelector(`.habit-group-wrapper[data-time-wrapper="${e}"]`),n=a?.querySelector(`.${y.HABIT_GROUP}[data-time="${e}"]`),i=a?.querySelector(".time-marker");a&&n&&i&&(t={wrapper:a,group:n,marker:i},Qn.set(e,t))}return t}var Zn=null,Jn={},ei=null,ti=null,Pr=()=>Zn||(Zn=(()=>{let e=document.createElement("div");return e.className=y.HABIT_GOAL_CONTROLS,e.innerHTML=`<button type="button" class="${y.GOAL_CONTROL_BTN}" data-action="decrement">-</button><div class="${y.GOAL_VALUE_WRAPPER}"><div class="progress"></div><div class="unit"></div></div><button type="button" class="${y.GOAL_CONTROL_BTN}" data-action="increment">+</button>`,e})()),ai=(e,t)=>Jn[e]||(Jn[e]=(()=>{let a=document.createElement("div");return a.className=e,a.innerHTML=t,a})()),Nr=()=>ti||(ti=(()=>{let e=document.createElement("div");return e.className=y.EMPTY_GROUP_PLACEHOLDER,e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e})()),Br=()=>ei||(ei=(()=>{let e=document.createElement("li");return e.className=y.HABIT_CARD,e.innerHTML=`<div class="habit-actions-left"><button type="button" class="${y.SWIPE_DELETE_BTN}">${K.swipeDelete}</button></div><div class="habit-actions-right"><button type="button" class="${y.SWIPE_NOTE_BTN}">${K.swipeNote}</button></div><div class="${y.HABIT_CONTENT_WRAPPER}" role="button" tabindex="0" draggable="true"><div class="habit-icon"></div><div class="${y.HABIT_DETAILS}"><div class="name"></div><div class="subtitle"></div><div class="consolidation-message" hidden></div></div><div class="habit-goal"></div><div class="ripple-container"></div></div>`,e})()),Ia=(e,t)=>`${e}|${t}`,at=()=>tt.clear(),ii=(e,t)=>tt.get(Ia(e,t));function Fr(e,t,a,n){let i=_e(e,s.selectedDate);if(!i){n.goal.hasChildNodes()&&n.goal.replaceChildren();return}if(i.goal.type==="check"){n.goal.hasChildNodes()&&n.goal.replaceChildren();return}let o=n.goal.querySelector(`.${y.HABIT_GOAL_CONTROLS}`);o||(n.goal.replaceChildren(Pr().cloneNode(!0)),o=n.goal.firstElementChild,n.goalDecBtn=n.goalIncBtn=n.goalProgress=n.goalUnit=void 0);let c=o.querySelector(`.${y.GOAL_VALUE_WRAPPER}`),l=c.querySelector(".progress");l?(!n.goalProgress||!n.goalProgress.isConnected)&&(n.goalProgress=l,n.goalUnit=c.querySelector(".unit")):(c.innerHTML='<div class="progress"></div><div class="unit"></div>',n.goalProgress=c.querySelector(".progress"),n.goalUnit=c.querySelector(".unit")),(!n.goalDecBtn||!n.goalDecBtn.isConnected)&&(n.goalDecBtn=o.querySelector('[data-action="decrement"]')),(!n.goalIncBtn||!n.goalIncBtn.isConnected)&&(n.goalIncBtn=o.querySelector('[data-action="increment"]'));let d=a?.goalOverride??Ca(e,s.selectedDate,t);n.goalDecBtn&&(n.goalDecBtn.disabled=d<=1),n.goalProgress&&v(n.goalProgress,ke(d)),n.goalUnit&&v(n.goalUnit,u(i.goal.unitKey||"unitCheck",{count:d}))}function Ut(e,t,a,n,i){let o=ni.get(e),c=k.getStatus(t.id,s.selectedDate,a),l=y.PENDING;c===A.DONE||c===A.DONE_PLUS?l=y.COMPLETED:c===A.DEFERRED&&(l=y.SNOOZED),c===A.DONE_PLUS?e.dataset.arete!=="true"&&(e.dataset.arete="true"):e.dataset.arete&&e.removeAttribute("data-arete");let d=(n||le(s.selectedDate))[t.id]?.instances?.[a],p=De(t,s.selectedDate),{name:f,subtitle:b}=de(t,s.selectedDate);e.classList.contains(l)||(e.classList.remove(y.PENDING,y.COMPLETED,y.SNOOZED),e.classList.add(l),l===y.COMPLETED&&i?.animate&&(o.icon.classList.remove("animate-pop"),o.icon.offsetWidth,o.icon.classList.add("animate-pop")));let E=_e(t,s.selectedDate);if(!E)return;o.cachedIconHtml!==E.icon&&(o.icon.innerHTML=o.cachedIconHtml=E.icon),o.icon.style.color=E.color,o.icon.style.backgroundColor=`${E.color}30`;let S=p>=Ke,L=p>=dt&&!S;e.classList.toggle("consolidated",S),e.classList.toggle("semi-consolidated",L),v(o.name,f),v(o.subtitle,b);let _=S?u("habitConsolidatedMessage"):L?u("habitSemiConsolidatedMessage"):"";v(o.consolidationMsg,_),o.consolidationMsg.hidden=!_;let F=!!d?.note;o.noteBtn.dataset.hasNote!==String(F)&&(o.noteBtn.innerHTML=F?K.swipeNoteHasNote:K.swipeNote,o.noteBtn.dataset.hasNote=String(F)),l===y.COMPLETED?o.goal.replaceChildren(ai("completed-wrapper",K.check).cloneNode(!0)):l===y.SNOOZED?o.goal.replaceChildren(ai("snoozed-wrapper",K.snoozed).cloneNode(!0)):Fr(t,a,d,o)}function zr(e,t,a){let n=Br().cloneNode(!0);n.dataset.habitId=e.id,n.dataset.time=t;let i=Ia(e.id,t);tt.set(i,n);let o=n.firstElementChild,c=o.nextElementSibling,l=c.nextElementSibling,d=l.children[1],p=l.children[2];return ni.set(n,{icon:l.children[0],contentWrapper:l,name:d.children[0],subtitle:d.children[1],details:d,consolidationMsg:d.children[2],noteBtn:c.firstElementChild,deleteBtn:o.firstElementChild,goal:p}),Ut(n,e,t,a),n}function oi(){if(document.body.classList.contains("is-interaction-active")||!s.uiDirtyState.habitListStructure)return;let e=I(s.selectedDate),t=le(s.selectedDate),a=Bn(s.selectedDate,e);Xe.forEach(o=>Kt[o].length=0);for(let o=0;o<a.length;o++){let{habit:c,schedule:l}=a[o];for(let d=0;d<l.length;d++)Kt[l[d]].push(c)}let n=Xe.filter(o=>Kt[o].length===0),i=new Set;Xe.forEach(o=>{let c=Rr(o);if(!c)return;let l=Kt[o],d=l.length>0;c.marker.style.display=d?"":"none",d&&(c.marker.innerHTML=qe(o));let p=[];if(d)for(let b=0;b<l.length;b++){let E=l[b],S=Ia(E.id,o);i.add(S);let L=tt.get(S);L?(L.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT,y.IS_SWIPING,y.DRAGGING),Ut(L,E,o,t)):L=zr(E,o,t),p.push(L)}let f=o===n[0];if(c.wrapper.classList.toggle("has-habits",d),c.wrapper.classList.toggle("is-collapsible",!d&&!f),!d){let b=c.group.querySelector(z.EMPTY_GROUP_PLACEHOLDER);b||(b=Nr().cloneNode(!0)),b.classList.toggle("show-smart-placeholder",f);let E=f?`<span class="placeholder-icon-generic">${n.map(qe).join('<span class="icon-separator">/</span>')}</span><span class="placeholder-icon-specific">${qe(o)}</span>`:`<span class="placeholder-icon-specific">${qe(o)}</span>`;b.innerHTML=`<div class="time-of-day-icon">${E}</div><span class="placeholder-arrow">\u2192</span><span>${u("dragToAddHabit")}</span>`,p.push(b)}c.group.replaceChildren(...p)});for(let o of tt.keys())i.has(o)||tt.delete(o);s.uiDirtyState.habitListStructure=!1}var Oa=30,Kr=100,Ur=.025,qr=1.5,yt=75,xe={top:5,right:0,bottom:5,left:3},ri={month:"short",day:"numeric",timeZone:"UTC",year:void 0},si={month:"short",day:"numeric",timeZone:"UTC",year:"2-digit"},ci=Array.from({length:Oa},()=>({date:"",timestamp:0,value:0,completedCount:0,scheduledCount:0})),U={lastChartData:[],cachedChartRect:null,chartMinVal:0,chartValueRange:100,lastRenderedPointIndex:-1,hasTypedOM:typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px)},_a=null,li=0,qt=!0,Gt=!1,di=null,ui=null,pi=!1,ka=0;function Gr(){try{let e=I(s.selectedDate);if(isNaN(e.getTime()))throw new Error("Invalid selectedDate for chart calculation");let t=e.getTime()-(Oa-1)*864e5,a=new Date(t),n=O(),i=Kr;for(let o=0;o<Oa;o=o+1|0){a.setTime(t);let c=B(a),l=J(c,a),{total:d,completed:p,pending:f,showPlusIndicator:b}=l,E=c===n,S=c>n,L;if(S||E&&f>0)L=i;else if(d>0){let R=(p/d-.5)*2;b&&(R=1*qr);let j=R*Ur;L=i*(1+j)}else L=i;let _=ci[o];_.date=c,_.timestamp=t,_.value=L,_.completedCount=p,_.scheduledCount=d,i=L,t+=864e5}return ci}catch(e){return console.error("Critical error in calculateChartData:",e),[]}}function Vr(e,t){let a=e.length;if(a===0)return{areaPathData:"",linePathData:""};let n=1/0,i=-1/0;for(let N=0;N<a;N=N+1|0){let ve=e[N].value;ve<n&&(n=ve),ve>i&&(i=ve)}let o=2,c=i-n;if(c<o){let N=(n+i)/2;n=N-o/2,i=N+o/2,c=o}let l=c*.25,d=n-l,f=i+l-d;U.chartMinVal=d,U.chartValueRange=f>0?f:1;let b=`0 0 ${t} ${yt}`;r.chart.svg.getAttribute("viewBox")!==b&&r.chart.svg.setAttribute("viewBox",b);let E=xe.left,S=xe.top,L=t-E-xe.right,_=yt-S-xe.bottom,F=L/(a-1),R=_/U.chartValueRange,j=S+_,re=e[0].value,X=E,ae=j-(re-d)*R,he="M "+X+" "+ae,P=.25;for(let N=0;N<a-1;N=N+1|0){let ve=e[N>0?N-1:N].value,Oo=E+(N>0?N-1:N)*F,_o=j-(ve-d)*R,Ro=e[N].value,dn=E+N*F,un=j-(Ro-d)*R,Po=e[N+1].value,da=E+(N+1)*F,ua=j-(Po-d)*R,No=e[N+2<a?N+2:N+1].value,Bo=E+(N+2<a?N+2:N+1)*F,Fo=j-(No-d)*R,zo=dn+(da-Oo)*P,Ko=un+(ua-_o)*P,Uo=da-(Bo-dn)*P,qo=ua-(Fo-un)*P;he+=" C "+zo+" "+Ko+", "+Uo+" "+qo+", "+da+" "+ua}let V=j-(d-d)*R,Te=E+(a-1)*F;return{areaPathData:he+" V "+V+" L "+X+" "+V+" Z",linePathData:he}}function $r(e){let{axisStart:t,axisEnd:a}=r.chart,n=e[0].timestamp,i=e[e.length-1].timestamp,o=new Date().getUTCFullYear(),c=new Date(n).getUTCFullYear(),l=new Date(i).getUTCFullYear(),d=ue(n,c!==o?si:ri),p=ue(i,l!==o?si:ri);v(t,d),v(a,p)}function Wr(e){let{evolutionIndicator:t}=r.chart,a=e[e.length-1],n=e[0],i=e.length;for(let l=0;l<i;l=l+1|0)if(e[l].scheduledCount>0){n=e[l];break}let o=(a.value-n.value)/n.value*100,c=`chart-evolution-indicator ${o>=0?"positive":"negative"}`;t.className!==c&&(t.className=c),v(t,`${o>0?"+":""}${An(o)}%`)}function Ra(e){let{areaPath:t,linePath:a}=r.chart;if(!t||!a||!e||e.length===0)return;let n=r.chart.wrapper.getBoundingClientRect().width;if(!n&&r.chartContainer.clientWidth>0&&(n=r.chartContainer.clientWidth-32),n||(n=300),e===_a&&n===li)return;let{areaPathData:i,linePathData:o}=Vr(e,n);t.setAttribute("d",i),a.setAttribute("d",o),$r(e),Wr(e),_a=e,li=n,U.cachedChartRect=null}function Yr(){pi||!r.chartContainer||(pi=!0,di=new IntersectionObserver(e=>{qt=e[0].isIntersecting,qt&&Gt&&(Gt=!1,Ra(U.lastChartData))},{threshold:.1}),di.observe(r.chartContainer),ui=new ResizeObserver(()=>{ka&&cancelAnimationFrame(ka),ka=requestAnimationFrame(()=>{qt&&(U.cachedChartRect=null,Ra(U.lastChartData))})}),ui.observe(r.chartContainer))}function Pa(){try{Yr(),(yn()||U.lastChartData.some(t=>t.date===""))&&(U.lastChartData=Gr(),U.lastRenderedPointIndex=-1,_a=null);let e=U.lastChartData.length<2||U.lastChartData.every(t=>t.scheduledCount===0);if(r.chartContainer.classList.toggle("is-empty",e),r.chart.title){let t=u("appName");r.chart.title.innerHTML!==t&&(r.chart.title.innerHTML=t)}if(r.chart.subtitle){let n=J(s.selectedDate).completed>0?"chartSubtitleProgress":"appSubtitle",i=u(n);r.chart.subtitle.textContent!==i&&(r.chart.subtitle.textContent=i)}if(e){if(r.chart.emptyState){let t=u("chartEmptyState");r.chart.emptyState.textContent!==t&&(r.chart.emptyState.textContent=t)}return}qt?(Ra(U.lastChartData),Gt=!1):Gt=!0}catch(e){console.error("Failed to render chart:",e),r.chartContainer.classList.add("is-empty")}}var q=Object.freeze({type:"check",unitKey:"unitCheck"}),H=Object.freeze({type:"daily"}),nt=Object.freeze([{nameKey:"predefinedHabitSustenanceName",subtitleKey:"predefinedHabitSustenanceSubtitle",icon:C.sustenance,color:"#3498DB",times:["Morning"],goal:q,frequency:H,isDefault:!0,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.sustento.conscience",stoicConcept:"Sophrosyne / Diaita",masterQuoteId:"cit_musonio_rufo_nutricao_01"}},{nameKey:"predefinedHabitInhibitionName",subtitleKey:"predefinedHabitInhibitionSubtitle",icon:C.snowflake,color:"#95A5A6",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Courage",discipline:"Desire",nature:"Addition",conscienceKey:"habit.inhibition.conscience",stoicConcept:"Askesis / Ponos",masterQuoteId:"cit_seneca_inibicao_01"}},{nameKey:"predefinedHabitDignityName",subtitleKey:"predefinedHabitDignitySubtitle",icon:C.dignity,color:"#8E44AD",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.dignity.conscience",stoicConcept:"Eustatheia / Dignitas",masterQuoteId:"cit_marco_compostura_01"}},{nameKey:"predefinedHabitPresenceName",subtitleKey:"predefinedHabitPresenceSubtitle",icon:C.presence,color:"#5DADE2",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.presence.conscience",stoicConcept:"Prosoche / Pneuma",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitAbstentionName",subtitleKey:"predefinedHabitAbstentionSubtitle",icon:C.abstention,color:"#BDC3C7",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Temperance",discipline:"Desire",nature:"Subtraction",conscienceKey:"habit.abstention.conscience",stoicConcept:"Abstine / Sophrosyne",masterQuoteId:"cit_epicteto_abstine_01"}},{nameKey:"predefinedHabitDiscernmentName",subtitleKey:"predefinedHabitDiscernmentSubtitle",icon:C.discernment,color:"#f1c40f",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.discernment.conscience",stoicConcept:"Dichotomy of Control / Prohairesis",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitAnticipationName",subtitleKey:"predefinedHabitAnticipationSubtitle",icon:C.anticipation,color:"#922B21",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Courage",discipline:"Desire",nature:"Addition",conscienceKey:"habit.anticipation.conscience",stoicConcept:"Premeditatio Malorum",masterQuoteId:"cit_seneca_antecipacao_01"}},{nameKey:"predefinedHabitMovementName",subtitleKey:"predefinedHabitMovementSubtitle",icon:C.movement,color:"#E67E22",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Courage",discipline:"Action",nature:"Addition",conscienceKey:"habit.movement.conscience",stoicConcept:"Gymnazein / Officium",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitExerciseName",subtitleKey:"predefinedHabitExerciseSubtitle",icon:C.exercise,color:"#2ECC71",times:["Afternoon"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Courage",discipline:"Action",nature:"Addition",conscienceKey:"habit.exercise.conscience",stoicConcept:"Ponos / Gymnazein",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitStretchName",subtitleKey:"predefinedHabitStretchSubtitle",icon:C.stretch,color:"#FADBD8",times:["Morning"],goal:{type:"minutes",total:5,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.exercise.conscience",stoicConcept:"Tasis",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitYogaName",subtitleKey:"predefinedHabitYogaSubtitle",icon:C.yoga,color:"#5DADE2",times:["Morning"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.yoga.conscience",stoicConcept:"Askesis",masterQuoteId:"cit_seneca_inibicao_01"}},{nameKey:"predefinedHabitReadName",subtitleKey:"predefinedHabitReadSubtitle",icon:C.read,color:"#e74c3c",times:["Evening"],goal:{type:"pages",total:10,unitKey:"unitPage"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.read.conscience",stoicConcept:"Lectio",masterQuoteId:"cit_seneca_leitura_01"}},{nameKey:"predefinedHabitMeditateName",subtitleKey:"predefinedHabitMeditateSubtitle",icon:C.meditate,color:"#BB8FCE",times:["Morning"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.meditate.conscience",stoicConcept:"Prosoche",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitZealName",subtitleKey:"predefinedHabitZealSubtitle",icon:C.zeal,color:"#58D68D",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.zeal.conscience",stoicConcept:"Oikeiosis / Cosmopolitanism",masterQuoteId:"cit_marco_zelo_01"}},{nameKey:"predefinedHabitJournalName",subtitleKey:"predefinedHabitJournalSubtitle",icon:C.journal,color:"#A1887F",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.journal.conscience",stoicConcept:"Hypomnemata",masterQuoteId:"cit_marco_escrita_01"}},{nameKey:"predefinedHabitPlanDayName",subtitleKey:"predefinedHabitPlanDaySubtitle",icon:C.planDay,color:"#007AFF",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.plan.conscience",stoicConcept:"Taxis",masterQuoteId:"cit_seneca_tempo_01"}},{nameKey:"predefinedHabitGratitudeName",subtitleKey:"predefinedHabitGratitudeSubtitle",icon:C.gratitude,color:"#E84393",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Justice",discipline:"Desire",nature:"Addition",conscienceKey:"habit.gratitude.conscience",stoicConcept:"Eucharistia",masterQuoteId:"cit_epicteto_gratidao_01"}},{nameKey:"predefinedHabitCadenciaName",subtitleKey:"predefinedHabitCadenciaSubtitle",icon:C.sunMoon,color:"#F1C40F",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Wisdom",discipline:"Desire",nature:"Addition",conscienceKey:"habit.cadencia.conscience",stoicConcept:"Logos / Kata Physin",masterQuoteId:"cit_seneca_cadencia_01"}},{nameKey:"predefinedHabitReflectDayName",subtitleKey:"predefinedHabitReflectDaySubtitle",icon:C.reflectDay,color:"#FADBD8",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.reflect.conscience",stoicConcept:"Exetasis",masterQuoteId:"quote_ma_001"}},{nameKey:"predefinedHabitStoicismName",subtitleKey:"predefinedHabitStoicismSubtitle",icon:C.stoicism,color:"#7F8C8D",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.stoicism.conscience",stoicConcept:"Prokopton",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitLanguageName",subtitleKey:"predefinedHabitLanguageSubtitle",icon:C.language,color:"#1ABC9C",times:["Afternoon"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.language.conscience",stoicConcept:"Logos",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitOrganizeName",subtitleKey:"predefinedHabitOrganizeSubtitle",icon:C.organize,color:"#BDC3C7",times:["Evening"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.organize.conscience",stoicConcept:"Kosmos",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitCreativeHobbyName",subtitleKey:"predefinedHabitCreativeHobbySubtitle",icon:C.creativeHobby,color:"#e84393",times:["Afternoon"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.hobby.conscience",stoicConcept:"Techne",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitTalkFriendName",subtitleKey:"predefinedHabitTalkFriendSubtitle",icon:C.talkFriend,color:"#3498db",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.friend.conscience",stoicConcept:"Philia",masterQuoteId:"cit_hierocles_circulos_01"}},{nameKey:"predefinedHabitInstrumentName",subtitleKey:"predefinedHabitInstrumentSubtitle",icon:C.instrument,color:"#e67e22",times:["Evening"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.instrument.conscience",stoicConcept:"Harmonia",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitPlantsName",subtitleKey:"predefinedHabitPlantsSubtitle",icon:C.plants,color:"#27ae60",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.plants.conscience",stoicConcept:"Physis",masterQuoteId:"cit_zeno_natureza_01"}},{nameKey:"predefinedHabitFinancesName",subtitleKey:"predefinedHabitFinancesSubtitle",icon:C.finances,color:"#34495e",times:["Evening"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:2,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.finances.conscience",stoicConcept:"Oikonomia",masterQuoteId:"cit_epicteto_abstine_01"}},{nameKey:"predefinedHabitTeaName",subtitleKey:"predefinedHabitTeaSubtitle",icon:C.tea,color:"#16a085",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.tea.conscience",stoicConcept:"Ataraxia",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitPodcastName",subtitleKey:"predefinedHabitPodcastSubtitle",icon:C.podcast,color:"#007aff",times:["Afternoon"],goal:{type:"minutes",total:25,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.podcast.conscience",stoicConcept:"Akroasis",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitEmailsName",subtitleKey:"predefinedHabitEmailsSubtitle",icon:C.emails,color:"#f39c12",times:["Morning"],goal:{type:"minutes",total:5,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Justice",discipline:"Action",nature:"Subtraction",conscienceKey:"habit.emails.conscience",stoicConcept:"Katharsis / Taxis",masterQuoteId:"cit_seneca_tempo_01"}},{nameKey:"predefinedHabitSkincareName",subtitleKey:"predefinedHabitSkincareSubtitle",icon:C.skincare,color:"#d35400",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.skincare.conscience",stoicConcept:"Therapeia",masterQuoteId:"cit_marco_compostura_01"}},{nameKey:"predefinedHabitDrawName",subtitleKey:"predefinedHabitDrawSubtitle",icon:C.draw,color:"#8e44ad",times:["Afternoon"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.draw.conscience",stoicConcept:"Mimesis",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitFamilyTimeName",subtitleKey:"predefinedHabitFamilyTimeSubtitle",icon:C.familyTime,color:"#f1c40f",times:["Evening"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Social",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.family.conscience",stoicConcept:"Oikeiosis / Storge",masterQuoteId:"cit_hierocles_circulos_01"}},{nameKey:"predefinedHabitNewsName",subtitleKey:"predefinedHabitNewsSubtitle",icon:C.news,color:"#7f8c8d",times:["Morning"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.news.conscience",stoicConcept:"Kosmopolites",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitCookHealthyName",subtitleKey:"predefinedHabitCookHealthySubtitle",icon:C.cookHealthy,color:"#27ae60",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.cook.conscience",stoicConcept:"Dieta",masterQuoteId:"cit_musonio_rufo_nutricao_01"}},{nameKey:"predefinedHabitLearnSkillName",subtitleKey:"predefinedHabitLearnSkillSubtitle",icon:C.learnSkill,color:"#e74c3c",times:["Afternoon"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.learn.conscience",stoicConcept:"Episteme",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitPhotographyName",subtitleKey:"predefinedHabitPhotographySubtitle",icon:C.photography,color:"#95a5a6",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.photo.conscience",stoicConcept:"Phantasia",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitVolunteerName",subtitleKey:"predefinedHabitVolunteerSubtitle",icon:C.gratitude,color:"#e74c3c",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.volunteer.conscience",stoicConcept:"Koinonia",masterQuoteId:"cit_marco_zelo_01"}}]);var Pe=[],jr={day:"numeric",month:"long",timeZone:"UTC"},Na=["#e74c3c","#f1c40f","#3498db","#2ecc71","#9b59b6","#1abc9c","#34495e","#e67e22","#e84393","#7f8c8d","#26A69A","#FFA726","#5C6BC0","#EC407A","#9CCC65"];function Xr(){let e=new Map(Na.map(n=>[n,0]));s.habits.forEach(n=>{let i=n.scheduleHistory[n.scheduleHistory.length-1];!n.graduatedOn&&i&&e.has(i.color)&&e.set(i.color,e.get(i.color)+1)});let t=Math.min(...e.values()),a=Na.filter(n=>e.get(n)===t);return a[s.habits.length%a.length]}function mi(){document.addEventListener("keydown",e=>{let t=Pe[Pe.length-1];if(t){if(e.key==="Escape")M("light"),Q(t.element);else if(e.key==="Tab"){let{firstFocusable:a,lastFocusable:n}=t;a&&n&&(e.shiftKey&&document.activeElement===a?(n.focus(),e.preventDefault()):!e.shiftKey&&document.activeElement===n&&(a.focus(),e.preventDefault()))}}}),document.addEventListener("click",e=>{let t=Pe[Pe.length-1];t&&e.target===t.element&&(M("light"),Q(t.element))})}function ie(e,t,a){let n={element:e,previousFocus:document.activeElement,onClose:a},i=e.querySelector(".modal-header");if(i){let c=i.querySelector(".modal-header-spacer");if(c&&!c.previousElementSibling?.classList.contains("modal-back-btn")){let l=document.createElement("button");l.className="modal-back-btn",l.innerHTML=K.backArrow,l.setAttribute("aria-label",u("aria_go_back")),l.addEventListener("click",()=>{M("light"),Q(e)}),c.replaceWith(l)}}e.classList.add("visible");let o=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');o.length&&(n.firstFocusable=o[0],n.lastFocusable=o[o.length-1],setTimeout(()=>(t||o[0]).focus(),100)),Pe.push(n),r.appContainer.setAttribute("inert","")}function Q(e,t=!1){let a=Pe.findIndex(c=>c.element===e);if(a===-1)return;let[n]=Pe.splice(a,1);e.classList.remove("visible"),Pe.length===0&&r.appContainer.removeAttribute("inert");let i=e.querySelector(".modal-header"),o=i?.querySelector(".modal-back-btn");if(i&&o){let c=document.createElement("div");c.className="modal-header-spacer",o.replaceWith(c)}t||n.onClose?.(),n.previousFocus?.focus()}function Vt(){let e=s.habits.filter(n=>!n.deletedOn);if(e.length===0){r.habitList.classList.add("hidden"),r.noHabitsMessage.classList.remove("hidden");return}r.habitList.classList.remove("hidden"),r.noHabitsMessage.classList.add("hidden");let t=e.map(n=>{let{name:i,subtitle:o}=de(n),c=n.graduatedOn?"graduated":n.scheduleHistory[n.scheduleHistory.length-1].endDate?"ended":"active";return{h:n,st:c,name:i,subtitle:o}}).sort((n,i)=>{let o={active:0,graduated:1,ended:2};return o[n.st]-o[i.st]||Mn(n.name,i.name)}),a=O();r.habitList.innerHTML=t.map(({h:n,st:i,name:o,subtitle:c})=>{let l=n.scheduleHistory[n.scheduleHistory.length-1];return`<li class="habit-list-item ${i}" data-habit-id="${n.id}"><span class="habit-main-info"><span class="habit-icon-slot" style="color:${l.color}">${l.icon}</span><div style="display:flex;flex-direction:column;flex-grow:1;"><span class="habit-name">${o}</span>${c?`<span class="habit-subtitle" style="font-size:11px;color:var(--text-tertiary)">${c}</span>`:""}</div>${i!=="active"?`<span class="habit-name-status">${u(i==="graduated"?"modalStatusGraduated":"modalStatusEnded")}</span>`:""}</span><div class="habit-list-actions">${i==="active"?`${De(n,a)>=Ke?`<button class="graduate-habit-btn" aria-label="${u("aria_graduate",{name:o})}">${K.graduateAction}</button>`:`<button class="end-habit-btn" aria-label="${u("aria_end",{name:o})}">${K.endAction}</button>`}`:`<button class="permanent-delete-habit-btn" aria-label="${u("aria_delete_permanent",{name:o})}">${K.deletePermanentAction}</button>`}</div></li>`}).join("")}function oe(e,t,a){r.confirmModalText.innerHTML=e,s.confirmAction=t,s.confirmEditAction=a?.onEdit||null,v(r.confirmModal.querySelector("h2"),a?.title||u("modalConfirmTitle")),r.confirmModalConfirmBtn.className=`btn ${a?.confirmButtonStyle==="danger"?"btn--danger":"btn--primary"}`,v(r.confirmModalConfirmBtn,a?.confirmText||u("confirmButton")),r.confirmModalEditBtn.classList.toggle("hidden",!a?.onEdit),a?.editText&&v(r.confirmModalEditBtn,a.editText);let n=()=>{s.confirmAction=null,s.confirmEditAction=null,a?.onCancel?.()};ie(r.confirmModal,void 0,n)}function fi(e,t,a){let n=s.habits.find(i=>i.id===e);n&&(s.editingNoteFor={habitId:e,date:t,time:a},v(r.notesModalTitle,de(n,t).name),v(r.notesModalSubtitle,`${ue(I(t),jr)} - ${Ue(a)}`),r.notesTextarea.value=le(t)[e]?.instances[a]?.note||"",ie(r.notesModal,r.notesTextarea,()=>s.editingNoteFor=null))}function Ba(){if(!s.editingHabit)return;let{color:e}=s.editingHabit.formData,t=lt(e);r.iconPickerGrid.style.setProperty("--current-habit-bg-color",e),r.iconPickerGrid.style.setProperty("--current-habit-fg-color",t),r.iconPickerGrid.innerHTML=Object.values(C).map(a=>`<button type="button" class="icon-picker-item" data-icon-svg="${ba(a)}">${a}</button>`).join(""),r.iconPickerModal.querySelector("#change-color-from-picker-btn").innerHTML=K.colorPicker}function gi(){let e=s.editingHabit?.formData.color;r.colorPickerGrid.innerHTML=Na.map(t=>`<button type="button" class="color-swatch ${e===t?"selected":""}" style="background-color:${t}" data-color="${t}"></button>`).join("")}function $t(){if(!s.editingHabit)return;let e=s.editingHabit.formData.frequency,t=e.type==="daily",a=e.type==="specific_days_of_week",n=e.type==="interval",i=[0,1,2,3,4,5,6];s.activeLanguageCode!=="pt"&&i.push(i.shift());let o=a?new Set(e.days):new Set,c=n?e.amount:2,l=n?e.unit:"days";r.frequencyOptionsContainer.innerHTML=`<div class="form-section frequency-options"><div class="form-row"><label><input type="radio" name="frequency-type" value="daily" ${t?"checked":""}>${u("freqDaily")}</label></div><div class="form-row form-row--vertical"><label><input type="radio" name="frequency-type" value="specific_days_of_week" ${a?"checked":""}>${u("freqSpecificDaysOfWeek")}</label><div class="frequency-details ${a?"visible":""}"><div class="weekday-picker">${i.map(d=>`<label><input type="checkbox" class="visually-hidden" data-day="${d}" ${o.has(d)?"checked":""}><span class="weekday-button">${u(`weekday${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d]}`).charAt(0)}</span></label>`).join("")}</div></div></div><div class="form-row form-row--vertical"><label><input type="radio" name="frequency-type" value="interval" ${n?"checked":""}>${u("freqEvery")}</label><div class="frequency-details ${n?"visible":""}"><div class="interval-control-group"><button type="button" class="stepper-btn" data-action="interval-decrement">-</button><span class="interval-amount-display">${ke(c)}</span><button type="button" class="stepper-btn" data-action="interval-increment">+</button><button type="button" class="unit-toggle-btn" data-action="interval-unit-toggle">${u(l==="days"?"unitDays":"unitWeeks",{count:c})}</button></div></div></div></div>`}function Fa(){if(!s.editingHabit)return;$t();let e=s.editingHabit.formData;r.habitTimeContainer.innerHTML=`<div class="segmented-control">${Xe.map(n=>`<button type="button" class="segmented-control-option ${e.times.includes(n)?"selected":""}" data-time="${n}">${qe(n)}${Ue(n)}</button>`).join("")}</div>`;let t=r.editHabitForm.elements.namedItem("habit-name");t&&(t.placeholder=u("modalEditFormNameLabel"),e.nameKey&&(t.value=u(e.nameKey)));let a=r.habitConscienceDisplay;if(!a&&r.editHabitForm&&(a=document.createElement("div"),a.id="habit-conscience-display",a.className="habit-conscience-text",r.editHabitForm.querySelector(".habit-identity-section")?.insertAdjacentElement("afterend",a)),a){let n=e.philosophy;n?.conscienceKey?(v(a,u(n.conscienceKey)),a.style.display="block"):a.style.display="none"}}function za(e,t){let a=!e||!e.id,n=Ie(t||s.selectedDate),i;if(a)i={icon:C.custom,color:Xr(),times:["Morning"],goal:{type:"check"},frequency:{type:"daily"},name:"",subtitleKey:"customHabitSubtitle",...e};else{let p=Oe(e,n)||e.scheduleHistory[0],f=p.frequency,b=f.type==="specific_days_of_week"?{...f,days:[...f.days]}:{...f};i={...p,times:[...p.times],frequency:b,goal:{...p.goal}}}s.editingHabit={isNew:a,habitId:a?void 0:e.id,originalData:a?void 0:e,formData:i,targetDate:n};let o=r.editHabitForm.elements.namedItem("habit-name");o&&(o.value=a?i.nameKey?u(i.nameKey):"":de(e,n).name);let c=r.habitIconPickerBtn;c.innerHTML=i.icon,c.style.backgroundColor=i.color,c.style.color=lt(i.color);let l=a?i.subtitleKey?u(i.subtitleKey):"":de(e,n).subtitle;r.habitSubtitleDisplay&&v(r.habitSubtitleDisplay,l);let d=c.nextElementSibling;d&&d.classList.contains("edit-icon-overlay")&&(d.innerHTML=C.learnSkill),Fa(),ie(r.editHabitModal)}function Wt(){r.exploreHabitList.innerHTML=nt.map((t,a)=>`<div 
            class="explore-habit-item" 
            data-index="${a}" 
            role="button" 
            tabindex="0"
            style="--delay: ${a*50}ms;"
        >
            <div class="explore-habit-icon" style="background-color:${t.color}30;color:${t.color}">${t.icon}</div>
            <div class="explore-habit-details">
                <div class="name">${u(t.nameKey)}</div>
                <div class="subtitle">${u(t.subtitleKey)}</div>
            </div>
        </div>`).join("")}function Yt(){let e=pe.findIndex(n=>n.code===s.activeLanguageCode),t=pe.map(n=>u(n.nameKey));if(r.languageViewport.classList.contains("is-interacting"))return;let a=r.languageReel.querySelector(".reel-option")?.offsetWidth||95;r.languageReel.style.transform=`translateX(${-e*a}px)`,Ft(r.languageViewport,e,t,"language_ariaLabel")}function vi(){let e=s.syncLogs||[];if(e.length===0)return oe("Nenhum log de sincroniza\xE7\xE3o dispon\xEDvel ainda.",()=>{},{title:"Monitor de Sync",hideCancel:!0});let a=`
        <div style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
            ${e.slice().reverse().map(n=>{let i=new Date(n.time).toLocaleTimeString();return`<div style="font-family:monospace; font-size:11px; padding:6px 0; border-bottom:1px solid var(--border-color); color:${n.type==="error"?"#ff6b6b":n.type==="success"?"#27ae60":"var(--text-secondary)"}">
            <span style="opacity:0.5">[${i}]</span> ${n.icon||""} ${n.msg}
        </div>`}).join("")}
        </div>
    `;oe(a,()=>{},{title:"Monitor de Sincroniza\xE7\xE3o",confirmText:"Fechar",hideCancel:!0})}var hi=null,yi=null,bt=null,bi=null,Ei=null,xi=null,Qr={month:"long",day:"numeric",timeZone:"UTC"},Zr={weekday:"long",month:"long",day:"numeric",timeZone:"UTC"},Jr={day:"2-digit",month:"2-digit",timeZone:"UTC"};function es(e){if(bi!==e){bi=e;let t=I(e);Ei=B(se(t,-1)),xi=B(se(t,1))}}function ts(){if(hi===s.selectedDate&&yi===s.activeLanguageCode)return;let e=O();es(e);let t=s.selectedDate,a=null;t===e?a="headerTitleToday":t===Ei?a="headerTitleYesterday":t===xi&&(a="headerTitleTomorrow");let n,i,o=I(t),c=ue(o,Jr);if(a){let l=u(a);n=l,i=t===e?l:c}else i=c,n=ue(o,Qr);v(r.headerTitleDesktop,n),v(r.headerTitleMobile,i),r.headerTitle.setAttribute("aria-label",ue(o,Zr)),r.navArrowPast.classList.toggle("hidden",!(t<e)),r.navArrowFuture.classList.toggle("hidden",!(t>e)),hi=t,yi=s.activeLanguageCode}function as(){r.manageHabitsBtn.hasChildNodes()||(r.manageHabitsBtn.innerHTML=K.settings);let e=r.aiEvalBtn.querySelector(".default-icon");e&&!e.hasChildNodes()&&(e.innerHTML=K.ai)}function Ka(){let e=u("appName"),t=document.createElement("div");t.innerHTML=e,document.title=t.textContent||"Askesis",r.fabAddHabit.setAttribute("aria-label",u("fabAddHabit_ariaLabel")),r.manageHabitsBtn.setAttribute("aria-label",u("manageHabits_ariaLabel")),r.aiEvalBtn.setAttribute("aria-label",u("aiEval_ariaLabel")),v(r.exploreModal.querySelector("h2"),u("modalExploreTitle")),v(r.createCustomHabitBtn,u("modalExploreCreateCustom")),v(r.exploreModal.querySelector(".modal-close-btn"),u("closeButton")),v(r.manageModalTitle,u("modalManageTitle")),v(r.habitListTitle,u("modalManageHabitsSubtitle")),v(r.labelLanguage,u("modalManageLanguage")),r.languagePrevBtn.setAttribute("aria-label",u("languagePrev_ariaLabel")),r.languageNextBtn.setAttribute("aria-label",u("languageNext_ariaLabel")),v(r.labelSync,u("syncLabel")),v(r.labelNotifications,u("modalManageNotifications")),v(r.labelReset,u("modalManageReset")),v(r.resetAppBtn,u("modalManageResetButton")),v(r.manageModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.labelPrivacy,u("privacyLabel")),v(r.exportDataBtn,u("exportButton")),v(r.importDataBtn,u("importButton")),v(r.syncInactiveDesc,u("syncInactiveDesc")),v(r.enableSyncBtn,u("syncEnable")),v(r.enterKeyViewBtn,u("syncEnterKey")),v(r.labelEnterKey,u("syncLabelEnterKey")),v(r.cancelEnterKeyBtn,u("cancelButton")),v(r.submitKeyBtn,u("syncSubmitKey")),r.syncWarningText.innerHTML!==u("syncWarning")&&(r.syncWarningText.innerHTML=u("syncWarning")),v(r.keySavedBtn,r.syncDisplayKeyView.dataset.context==="view"?u("closeButton"):u("syncKeySaved")),v(r.syncActiveDesc,u("syncActiveDesc")),v(r.viewKeyBtn,u("syncViewKey")),v(r.disableSyncBtn,u("syncDisable")),v(r.aiModal.querySelector("h2"),u("modalAITitle")),v(r.aiModal.querySelector(".modal-close-btn"),u("closeButton")),v(r.aiOptionsModal.querySelector("h2"),u("modalAIOptionsTitle"));let a=(i,o,c)=>{let l=r.aiOptionsModal.querySelector(`[data-analysis-type="${i}"]`);l&&(v(l.querySelector(".ai-option-title"),u(o)),v(l.querySelector(".ai-option-desc"),u(c)))};a("monthly","aiOptionMonthlyTitle","aiOptionMonthlyDesc"),a("quarterly","aiOptionQuarterlyTitle","aiOptionQuarterlyDesc"),a("historical","aiOptionHistoricalTitle","aiOptionHistoricalDesc"),v(r.confirmModal.querySelector("h2"),u("modalConfirmTitle")),v(r.confirmModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.confirmModalConfirmBtn,u("confirmButton")),v(r.notesModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.saveNoteBtn,u("modalNotesSaveButton")),r.notesTextarea.placeholder=u("modalNotesTextareaPlaceholder"),v(r.iconPickerTitle,u("modalIconPickerTitle")),v(r.iconPickerModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.colorPickerTitle,u("modalColorPickerTitle")),v(r.colorPickerModal.querySelector(".modal-close-btn"),u("cancelButton"));let n=(i,o,c)=>{let l=`${o} ${c}`;i.innerHTML!==l&&(i.innerHTML=l)};n(r.quickActionDone,K.check,u("quickActionMarkAllDone")),n(r.quickActionSnooze,K.snoozed,u("quickActionMarkAllSnoozed")),n(r.quickActionAlmanac,K.calendar,u("quickActionOpenAlmanac")),v(r.noHabitsMessage,u("modalManageNoHabits")),s.editingHabit&&Fa()}function $(){as(),ts(),Yn(),oi(),"scheduler"in window&&window.scheduler?window.scheduler.postTask(()=>{ye(),Pa(),window.scheduler.postTask(()=>it(),{priority:"background"})},{priority:"user-visible"}):requestAnimationFrame(()=>{ye(),Pa(),"requestIdleCallback"in window?requestIdleCallback(()=>it()):setTimeout(it,50)}),r.manageModal.classList.contains("visible")&&Vt()}function ot(){if(r.notificationToggle.disabled&&!r.notificationToggleLabel.classList.contains("disabled")){v(r.notificationStatusDesc,u("notificationChangePending"));return}Se(t=>{let a=t.User.PushSubscription.optedIn,n=t.Notifications.permission;r.notificationToggle.checked!==a&&(r.notificationToggle.checked=a);let i=n==="denied";r.notificationToggle.disabled!==i&&(r.notificationToggle.disabled=i,r.notificationToggleLabel.classList.toggle("disabled",i));let o="notificationStatusOptedOut";i?o="notificationStatusDisabled":a&&(o="notificationStatusEnabled"),v(r.notificationStatusDesc,u(o))})}function ns(){let e=pe.map(t=>u(t.nameKey));r.languageReel.innerHTML=e.map(t=>`<span class="reel-option">${t}</span>`).join(""),Ft(r.languageViewport,pe.findIndex(t=>t.code===s.activeLanguageCode),e,"language_ariaLabel")}function ye(){let e=s.pending21DayHabitIds.length>0||s.pendingConsolidationHabitIds.length>0,t=(s.aiState==="completed"||s.aiState==="error")&&!s.hasSeenAIResult;r.aiEvalBtn.classList.toggle("loading",s.aiState==="loading"),r.aiEvalBtn.disabled=s.aiState==="loading",r.aiEvalBtn.classList.toggle("offline",!navigator.onLine),r.aiEvalBtn.classList.toggle("has-notification",e||t)}var jt=null;function is(){jt||(jt=e=>{e.target.closest(".stoic-quote")||r.stoicQuoteDisplay.querySelector(".quote-expanded")&&(bt=null,it())},document.addEventListener("click",jt,{capture:!0}),r.habitContainer.addEventListener("scroll",jt,{passive:!0}))}function it(){s.dailyDiagnoses[s.selectedDate]||document.dispatchEvent(new CustomEvent("request-analysis",{detail:{date:s.selectedDate}}));let e=new Date().getHours(),t=e<12?"Morning":e<18?"Afternoon":"Evening",a=J(s.selectedDate),n=`${a.completed}/${a.total}`,i=`${s.selectedDate}|${s.activeLanguageCode}|${t}|${n}`;if(bt&&bt.contextKey===i)return;let o;try{o=zn(pa,s.selectedDate)}catch{o=pa[0]}bt={id:o.id,contextKey:i};let c=s.dailyDiagnoses[s.selectedDate],l=c?c.level:1,d=s.activeLanguageCode,p=o.adaptations[`level_${l}`][d],f=r.stoicQuoteDisplay;f.classList.remove("visible"),f.innerHTML="";let b=document.createElement("span");b.className="quote-adaptation",b.textContent=p+" ";let E=document.createElement("button");E.className="quote-expander",E.textContent="...",E.setAttribute("aria-label",u("expandQuote")),E.onclick=S=>{S.stopPropagation(),f.innerHTML="";let L=document.createElement("span");L.className="quote-expanded",L.style.fontStyle="italic",L.textContent=`"${o.original_text[d]}" \u2014 ${u(o.author)}`,f.appendChild(L),is()},f.appendChild(b),f.appendChild(E),requestAnimationFrame(()=>{if(!b.isConnected)return;let S=b.getClientRects(),L=S.length===1;S.length>1&&Math.abs(S[S.length-1].top-S[0].top)<5&&(L=!0),f.style.justifyContent=L?"flex-end":"flex-start",f.style.textAlign=L?"right":"left",f.classList.add("visible")})}document.addEventListener("language-changed",()=>{ns(),Yt(),Ka(),r.syncStatus&&v(r.syncStatus,u(s.syncState)),$()});document.addEventListener("habitsChanged",()=>{bt=null,"requestIdleCallback"in window?requestIdleCallback(()=>it()):setTimeout(it,1e3)});async function Ti(){let e=localStorage.getItem("habitTrackerLanguage"),t=navigator.language.split("-")[0],a=e&&["pt","en","es"].includes(e)?e:["pt","en","es"].includes(t)?t:"pt";await Bt(a)}var os="AskesisDB",rs=1,Be="app_state",Li="askesis_core_json",wi="askesis_logs_binary",ss=15e3,cs=800,rt=null,Ne,Ge=null,Me=null;function Ua(){return rt||(rt=new Promise((e,t)=>{let a=setTimeout(()=>{rt=null,t(new Error("Timeout IDB"))},ss),n=indexedDB.open(os,rs);n.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(Be)||o.createObjectStore(Be)},n.onsuccess=i=>{clearTimeout(a);let o=i.target.result;o.onclose=o.onversionchange=()=>rt=null,e(o)},n.onerror=()=>{clearTimeout(a),rt=null,t(n.error)}})),rt}async function Di(e){let t=await Ua();return new Promise((a,n)=>{let i=t.transaction(Be,"readwrite"),o=i.objectStore(Be),c=e.monthlyLogs,l={...e};if(delete l.monthlyLogs,o.put(l,Li),c&&c.size>0){let d={};c.forEach((p,f)=>{d[f]=p.toString(16)}),o.put(d,wi)}i.oncomplete=()=>a(),i.onerror=()=>n(i.error)})}var Mi=null,Ci=e=>Mi=e;function ls(e,t){if(e.length===0)return;let a=new Set(e.map(n=>n.id));for(let n in t){for(let i in t[n])a.has(i)||delete t[n][i];Object.keys(t[n]).length===0&&delete t[n]}}async function Si(e=!1,t=!1){Ge&&await Ge,Ge=(async()=>{s.lastModified=Math.max(Date.now(),s.lastModified+1);let a=ce();try{await Di(a)}catch(n){console.error("IDB Save Failed:",n)}t||Mi?.(a,e)})();try{await Ge}finally{Ge=null}}function ds(){Ne!==void 0&&(clearTimeout(Ne),Ne=void 0),Me&&(Me(),Me=null)}async function ee(e=!1,t=!1){if(Ne!==void 0&&(clearTimeout(Ne),Ne=void 0),e){let a=Me;Me=null,await Si(!0,t),a?.()}else return new Promise(a=>{let n=Me;Me=()=>{n?.(),a()},Ne=self.setTimeout(async()=>{Ne=void 0;let i=Me;Me=null,await Si(!1,t),i?.()},cs)})}var qa=async e=>{Ge&&await Ge;try{await Di(e)}catch(t){console.error("[Persistence] Immediate Cloud Persistence Failed:",t)}};async function Ce(e){let t=e,a;if(!t)try{let n=await Ua();await new Promise(i=>{let o=n.transaction(Be,"readonly"),c=o.objectStore(Be),l=c.get(Li),d=c.get(wi);o.oncomplete=()=>{t=l.result,a=d.result,i()},o.onerror=()=>i()})}catch(n){console.warn("[Persistence] Failed to read state from IDB",n)}if(t){a&&!t.monthlyLogs&&(t.monthlyLogs=a);let n=xn(t,It);s.monthlyLogs=n.monthlyLogs,k.resetCache(),(!s.monthlyLogs||s.monthlyLogs.size===0)&&a&&typeof a=="object"&&!Array.isArray(a)&&(s.monthlyLogs=new Map,Object.entries(a).forEach(([o,c])=>{s.monthlyLogs.set(o,BigInt("0x"+c))})),s.habits=[...n.habits||[]],s.lastModified=n.lastModified||Date.now(),s.dailyData=n.dailyData||{},s.archives=n.archives||{},s.dailyDiagnoses=n.dailyDiagnoses||{},s.notificationsShown=[...n.notificationsShown||[]],s.pending21DayHabitIds=[...n.pending21DayHabitIds||[]],s.pendingConsolidationHabitIds=[...n.pendingConsolidationHabitIds||[]],s.hasOnboarded=n.hasOnboarded??!0,s.syncLogs=n.syncLogs||[],["streaksCache","scheduleCache","activeHabitsCache","unarchivedCache","habitAppearanceCache","daySummaryCache"].forEach(o=>s[o].clear()),at(),Object.assign(s.uiDirtyState,{calendarVisuals:!0,habitListStructure:!0,chartData:!0});let i=()=>ls(s.habits,s.dailyData);return"scheduler"in window&&window.scheduler&&window.scheduler.postTask(i,{priority:"background"}),document.dispatchEvent(new CustomEvent("render-app")),n}return null}var Ai=async()=>{ds();try{let t=(await Ua()).transaction(Be,"readwrite");t.objectStore(Be).clear(),await new Promise(a=>t.oncomplete=a)}catch(e){console.warn("IDB clear failed",e)}k.clearAllLogs()};var Xt="habitTrackerSyncKey",Fe=()=>!!localStorage.getItem(Xt),Ae=()=>localStorage.getItem(Xt),Qt=e=>{e&&localStorage.setItem(Xt,e)},vt=()=>{localStorage.removeItem(Xt)},Ii=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e),Ga=null,Hi=null;async function us(){let e=Ae();if(!e)return null;if(Ga&&Hi===e)return Ga;if(window.crypto&&window.crypto.subtle)try{let a=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",a),o=Array.from(new Uint8Array(n)).map(c=>c.toString(16).padStart(2,"0")).join("");return Ga=o,Hi=e,o}catch(t){console.warn("[API] Crypto Digest failed, falling back to raw auth",t)}return null}async function ze(e,t={},a=!1){let n=new Headers(t.headers||{});if(n.has("Content-Type")||n.set("Content-Type","application/json"),a){let c=await us();if(c)n.set("X-Sync-Key-Hash",c),n.set("Authorization",`Bearer ${Ae()}`);else throw new Error("Sync Key missing or environment insecure (No Crypto API).")}let i={...t,headers:n,keepalive:t.method==="POST"},o=await fetch(e,i);return o.status===401&&Fe()&&console.error("[API] Unauthorized. Local key might be revoked."),o}var ki=async()=>{};function Oi(e){if(e.monthlyLogs&&!(e.monthlyLogs instanceof Map)){let t=Array.isArray(e.monthlyLogs)?e.monthlyLogs:Object.entries(e.monthlyLogs),a=new Map;t.forEach(n=>{let i=(Array.isArray(n),n[0]),o=(Array.isArray(n),n[1]);try{if(o&&typeof o=="object"&&o.__type==="bigint")a.set(i,BigInt(o.val));else if(typeof o=="string"){let c=o.startsWith("0x")?o:"0x"+o;a.set(i,BigInt(c))}else typeof o=="bigint"?a.set(i,o):a.set(i,BigInt(o))}catch(c){console.warn(`[Merge] Failed to hydrate bitmask for ${i}`,c)}}),e.monthlyLogs=a}}function ps(e,t){let a=new Map;return t.forEach(n=>a.set(n.startDate,{...n})),e.forEach(n=>a.set(n.startDate,{...n})),Array.from(a.values()).sort((n,i)=>n.startDate.localeCompare(i.startDate))}function ms(e,t){for(let a in e){if(!t[a]){t[a]=e[a];continue}let n=e[a].instances||{},i=t[a].instances||{};for(let o in n){let c=n[o],l=i[o];c&&(l?((c.note?.length||0)>(l.note?.length||0)&&(l.note=c.note),c.goalOverride!==void 0&&(l.goalOverride=c.goalOverride)):i[o]=c)}e[a].dailySchedule&&(t[a].dailySchedule=e[a].dailySchedule)}}async function Et(e,t){Oi(e),Oi(t);let a=e.lastModified||0,n=t.lastModified||0,i,o;e.habits.length===0&&t.habits.length>0?(i=t,o=e):t.habits.length===0&&e.habits.length>0?(i=e,o=t):(i=a>=n?e:t,o=a>=n?t:e);let c=structuredClone(i),l=new Map;c.habits.forEach(d=>l.set(d.id,d)),o.habits.forEach(d=>{let p=l.get(d.id);p?(p.scheduleHistory=ps(p.scheduleHistory,d.scheduleHistory),d.deletedOn&&(!p.deletedOn||d.deletedOn>p.deletedOn)&&(p.deletedOn=d.deletedOn),d.graduatedOn&&(!p.graduatedOn||d.graduatedOn<p.graduatedOn)&&(p.graduatedOn=d.graduatedOn)):l.set(d.id,d)}),c.habits=Array.from(l.values());for(let d in o.dailyData)c.dailyData[d]?ms(o.dailyData[d],c.dailyData[d]):c.dailyData[d]=o.dailyData[d];return c.monthlyLogs=k.mergeLogs(i.monthlyLogs,o.monthlyLogs),c.lastModified=Math.max(a,n,Date.now())+1,c}var Va=null,fs=2e3,Ya="askesis_sync_hashes",st=!1,Tt=null,xt=null,$a=new Map;function gs(){return xt||(xt=new Worker("./sync-worker.js",{type:"module"}),xt.onmessage=e=>{let{id:t,status:a,result:n,error:i}=e.data,o=$a.get(t);o&&(a==="success"?o.resolve(n):o.reject(new Error(i)),$a.delete(t))},xt.onerror=e=>{console.error("Critical Worker Error:",e)}),xt}function He(e,t,a){return new Promise((n,i)=>{let o=je();$a.set(o,{resolve:n,reject:i}),gs().postMessage({id:o,type:e,payload:t,key:a})})}function hs(e){let t={};t.core={version:e.version,habits:e.habits,dailyData:e.dailyData,dailyDiagnoses:e.dailyDiagnoses,notificationsShown:e.notificationsShown,hasOnboarded:e.hasOnboarded,quoteState:e.quoteState};let a=k.getLogsGroupedByMonth();for(let n in a)t[`logs:${n}`]=a[n];for(let n in e.archives)t[`archive:${n}`]=e.archives[n];return t}var St=(()=>{try{let e=localStorage.getItem(Ya);if(e)return new Map(JSON.parse(e))}catch(e){console.warn("[Sync] Falha ao carregar cache de hashes",e)}return new Map})();function _i(){try{localStorage.setItem(Ya,JSON.stringify(Array.from(St.entries())))}catch(e){console.error("[Sync] Falha ao salvar cache de hashes",e)}}function Lt(){St.clear(),localStorage.removeItem(Ya),console.debug("[Sync] Hash cache cleared.")}function Ri(e,t=0){let a=e.length&3,n=e.length-a,i=t,o=3432918353,c=461845907,l=0;for(;l<n;){let p=e.charCodeAt(l)&255|(e.charCodeAt(++l)&255)<<8|(e.charCodeAt(++l)&255)<<16|(e.charCodeAt(++l)&255)<<24;++l,p=(p&65535)*o+(((p>>>16)*o&65535)<<16)&4294967295,p=p<<15|p>>>17,p=(p&65535)*c+(((p>>>16)*c&65535)<<16)&4294967295,i^=p,i=i<<13|i>>>19,i=i*5+3864292196&4294967295}let d=0;switch(a){case 3:d^=(e.charCodeAt(l+2)&255)<<16;case 2:d^=(e.charCodeAt(l+1)&255)<<8;case 1:d^=e.charCodeAt(l)&255,d=(d&65535)*o+(((d>>>16)*o&65535)<<16)&4294967295,d=d<<15|d>>>17,d=(d&65535)*c+(((d>>>16)*c&65535)<<16)&4294967295,i^=d}return i^=e.length,i^=i>>>16,i=(i&65535)*2246822507+(((i>>>16)*2246822507&65535)<<16)&4294967295,i^=i>>>13,i=(i&65535)*3266489909+(((i>>>16)*3266489909&65535)<<16)&4294967295,i^=i>>>16,(i>>>0).toString(16)}function W(e,t="info",a){s.syncLogs||(s.syncLogs=[]),s.syncLogs.push({time:Date.now(),msg:e,type:t,icon:a}),s.syncLogs.length>50&&s.syncLogs.shift(),console.debug(`[Sync Log] ${e}`)}function Y(e){s.syncState=e,r.syncStatus&&(r.syncStatus.textContent=u(e))}async function ys(e){let t=Ae();if(!t)return Y("syncError");try{W("Conflito detectado. Mesclando dados...","info","\u{1F504}");let a={};for(let c in e)if(c!=="lastModified")try{let l=await He("decrypt",e[c],t);a[c]=l}catch(l){console.warn(`[Sync] Failed to decrypt shard ${c}, skipping.`,l)}let n={version:a.core?.version||0,lastModified:parseInt(e.lastModified||"0",10),habits:a.core?.habits||[],dailyData:a.core?.dailyData||{},archives:{},monthlyLogs:new Map,notificationsShown:a.core?.notificationsShown||[],hasOnboarded:a.core?.hasOnboarded??!0};for(let c in a)c.startsWith("archive:")&&(n.archives[c.replace("archive:","")]=a[c]),c.startsWith("logs:")&&a[c].forEach(([l,d])=>n.monthlyLogs.set(l,BigInt(d)));let i=ce(),o=await Et(i,n);await qa(o),await Ce(o),$(),Y("syncSynced"),W("Mesclagem conclu\xEDda.","success","\u2728"),Lt(),be(o,!0)}catch(a){W(`Erro na resolu\xE7\xE3o: ${a.message}`,"error","\u274C"),Y("syncError")}}async function Wa(){if(st||!Tt)return;st=!0;let e=Tt;Tt=null;let t=Ae();if(!t){Y("syncError"),st=!1;return}try{let a=hs(e),n={},i=new Map,o=0;for(let p in a){let f=Ri(JSON.stringify(a[p])),b=St.get(p);if(f!==b){let E=await He("encrypt",a[p],t);n[p]=E,i.set(p,f),o++}}if(o===0){Y("syncSynced"),st=!1;return}W(`Sincronizando ${o} pacotes...`,"info","\u{1F4E4}");let l={lastModified:e.lastModified||Date.now(),shards:n},d=await ze("/api/sync",{method:"POST",body:JSON.stringify(l)},!0);if(d.status===409)Lt(),await ys(await d.json());else if(d.ok)W("Nuvem atualizada.","success","\u2705"),Y("syncSynced"),i.forEach((p,f)=>St.set(f,p)),_i(),document.dispatchEvent(new CustomEvent("habitsChanged"));else{let p=await d.json().catch(()=>({}));throw new Error(p.error||`Erro ${d.status}`)}}catch(a){W(`Falha no envio: ${a.message}`,"error","\u26A0\uFE0F"),Y("syncError")}finally{st=!1,Tt&&setTimeout(Wa,500)}}function be(e,t=!1){Fe()&&(Tt=e,Y("syncSaving"),Va&&clearTimeout(Va),!st&&(t?Wa():Va=window.setTimeout(Wa,fs)))}async function Pi(e){let t=Ae();if(t)try{let a={};for(let i in e)if(i!=="lastModified")try{a[i]=await He("decrypt",e[i],t),St.set(i,Ri(JSON.stringify(a[i])))}catch(o){console.warn(`[Sync] Skip decrypt ${i}`,o)}_i();let n={version:a.core?.version||0,lastModified:parseInt(e.lastModified||"0",10),habits:a.core?.habits||[],dailyData:a.core?.dailyData||{},archives:{},monthlyLogs:new Map,notificationsShown:a.core?.notificationsShown||[],hasOnboarded:a.core?.hasOnboarded??!0,quoteState:a.core?.quoteState};for(let i in a)i.startsWith("archive:")&&(n.archives[i.replace("archive:","")]=a[i]),i.startsWith("logs:")&&a[i].forEach(([o,c])=>n.monthlyLogs.set(o,BigInt(c)));return n}catch(a){console.error("State reconstruction failed:",a);return}}async function Ni(){W("Baixando dados remotos...","info","\u{1F50D}");let e=await ze("/api/sync",{},!0);if(e.status===304){W("Sem novidades na nuvem.","info","\u{1F4A4}");return}if(!e.ok)throw new Error("Falha na conex\xE3o com a nuvem");let t=await e.json();if(!t||Object.keys(t).length===0){W("Cofre vazio na nuvem.","info","\u{1F32B}\uFE0F");return}return W("Dados baixados com sucesso.","success","\u{1F4E5}"),await Pi(t)}async function Bi(){if(!Fe()){s.initialSyncDone=!0;return}Y("syncSaving");try{let e=await ze("/api/sync",{},!0);if(e.status===304){s.initialSyncDone=!0,Y("syncSynced");return}if(!e.ok)throw new Error("Cloud fetch failed with status "+e.status);let t=await e.json();if(!t||Object.keys(t).length===0){s.initialSyncDone=!0;return}let a=await Pi(t);if(!a){s.initialSyncDone=!0;return}let n=ce(),i=a.lastModified||0,o=n.lastModified||0;if(i>o){W("Atualiza\xE7\xE3o remota detectada.","info","\u2601\uFE0F");let c=await Et(n,a);await qa(c),await Ce(c),$()}else o>i?(W("Sincronizando mudan\xE7as locais...","info","\u{1F680}"),be(n,!0)):Y("syncSynced");return a}catch(e){console.warn("[Cloud] Boot sync failed (Offline or Error). Proceeding locally.",e),Y("syncError");return}finally{s.initialSyncDone=!0}}var bs=90,ja=[],Xa=[],Qa=!1,G={isLocked:!1,drop:null,removal:null,ending:null,deletion:null,reset(){this.isLocked=!1,this.drop=this.removal=this.ending=this.deletion=null}};function Ve(e=!1,t=!1){e&&(hn(),at(),Nn()),ut(),s.uiDirtyState.habitListStructure=s.uiDirtyState.calendarVisuals=!0,s.initialSyncDone?s.lastModified=Math.max(Date.now(),(s.lastModified||0)+1):s.lastModified=s.lastModified+1,document.body.classList.remove("is-interaction-active","is-dragging-active"),ee(t),requestAnimationFrame(()=>{["render-app","habitsChanged"].forEach(a=>document.dispatchEvent(new CustomEvent(a)))})}function zi(e,t){Ta(e,t),s.initialSyncDone?s.lastModified=Math.max(Date.now(),(s.lastModified||0)+1):s.lastModified=s.lastModified+1,ee(),requestAnimationFrame(()=>{Ha(e),["render-app","habitsChanged"].forEach(a=>document.dispatchEvent(new CustomEvent(a)))})}function Zt(e){if(G.isLocked)return null;G.isLocked=!0;let t=s.habits.find(a=>a.id===e);return t||G.reset(),t}function wt(e,t,a,n=!1){let i=s.habits.find(l=>l.id===e);if(!i||!/^\d{4}-\d{2}-\d{2}$/.test(t))return;let o=i.scheduleHistory,c=o.findIndex(l=>t>=l.startDate&&(!l.endDate||t<l.endDate));if(c!==-1){let l=o[c];l.startDate===t?o[c]=a({...l}):(l.endDate=t,o.push(a({...l,startDate:t,endDate:void 0})))}else{let l=o[o.length-1];l&&(l.endDate&&l.endDate>t&&(l.endDate=t),o.push(a({...l,startDate:t,endDate:void 0})))}o.sort((l,d)=>l.startDate.localeCompare(d.startDate)),i.graduatedOn=void 0,Ve(!0,n)}function Ki(e,t){let a=De(e,t),n=a===dt?s.pending21DayHabitIds:a===Ke?s.pendingConsolidationHabitIds:null;n&&!s.notificationsShown.includes(`${e.id}-${a}`)&&!n.includes(e.id)&&(n.push(e.id),ye())}var vs=()=>{let e=G.drop,t=Ie(s.selectedDate);if(!e)return G.reset();let a=s.habits.find(n=>n.id===e.habitId);if(a){let n=Qe(t,e.habitId),i=[...fe(a,t)],o=i.indexOf(e.fromTime);o>-1&&i.splice(o,1),i.includes(e.toTime)||i.push(e.toTime);let c=k.getStatus(e.habitId,t,e.fromTime);c!==A.NULL&&(k.setStatus(e.habitId,t,e.toTime,c),k.setStatus(e.habitId,t,e.fromTime,A.NULL)),n.instances[e.fromTime]&&(n.instances[e.toTime]=n.instances[e.fromTime],delete n.instances[e.fromTime]),n.dailySchedule=i,e.reorderInfo&&Jt(e.habitId,e.reorderInfo.id,e.reorderInfo.pos,!0),Ve(!1)}G.reset()},Es=()=>{let e=G.drop,t=Ie(s.selectedDate);if(!e)return G.reset();let a=Qe(t,e.habitId);a.dailySchedule=void 0;let n=k.getStatus(e.habitId,t,e.fromTime);n!==A.NULL&&(k.setStatus(e.habitId,t,e.toTime,n),k.setStatus(e.habitId,t,e.fromTime,A.NULL)),a.instances[e.fromTime]&&(a.instances[e.toTime]=a.instances[e.fromTime],delete a.instances[e.fromTime]),e.reorderInfo&&Jt(e.habitId,e.reorderInfo.id,e.reorderInfo.pos,!0),wt(e.habitId,t,i=>{let o=[...i.times],c=o.indexOf(e.fromTime);return c>-1&&o.splice(c,1),o.includes(e.toTime)||o.push(e.toTime),{...i,times:o}}),G.reset()},xs=async()=>{let e=G.deletion;if(!e)return;let t=s.habits.find(a=>a.id===e.habitId);if(!t)return G.reset();t.deletedOn=t.createdOn,k.pruneLogsForHabit(t.id),Object.keys(s.dailyData).forEach(a=>{s.dailyData[a][t.id]&&(delete s.dailyData[a][t.id],Object.keys(s.dailyData[a]).length===0&&delete s.dailyData[a])}),s.streaksCache.has(t.id)&&s.streaksCache.delete(t.id),s.habitAppearanceCache.has(t.id)&&s.habitAppearanceCache.delete(t.id),He("prune-habit",{habitId:t.id,archives:s.archives}).then(a=>{Object.keys(a).forEach(n=>{a[n]===""?delete s.archives[n]:s.archives[n]=a[n]}),s.unarchivedCache.clear(),ee()}).catch(a=>console.error("Archive pruning failed",a)),Ve(!0,!0),G.reset()};function Ui(){let e=async()=>{let t=B(se(I(O()),-bs)),a={},n=[];if(Object.keys(s.dailyData).forEach(i=>{if(i<t){let o=i.substring(0,4);a[o]??(a[o]={additions:{},base:s.unarchivedCache.get(o)||s.archives[o]}),a[o].additions[i]=s.dailyData[i],n.push(i)}}),n.length!==0)try{let i=await He("archive",a);Object.keys(i).forEach(o=>{s.archives[o]=i[o],s.unarchivedCache.delete(o),Object.keys(a[o].additions).forEach(c=>delete s.dailyData[c])}),await ee()}catch(i){console.error(i)}};"requestIdleCallback"in window?requestIdleCallback(()=>e()):setTimeout(e,5e3)}function Jt(e,t,a,n=!1){let i=s.habits,o=i.findIndex(d=>d.id===e),c=i.findIndex(d=>d.id===t);if(o===-1||c===-1)return;let[l]=i.splice(o,1);i.splice(a==="before"?o<c?c-1:c:o<c?c:c+1,0,l),n||Ve(!1)}function qi(){if(!s.editingHabit)return;let{isNew:e,habitId:t,formData:a,targetDate:n}=s.editingHabit;a.name&&(a.name=a.name.replace(/[<>{}]/g,"").trim());let i=a.nameKey?u(a.nameKey):a.name;if(!i)return;let o={...a,times:[...a.times],goal:{...a.goal},frequency:a.frequency.type==="specific_days_of_week"?{...a.frequency,days:[...a.frequency.days]}:{...a.frequency}};if(Q(r.editHabitModal),e){let c=s.habits.find(l=>{let d=l.scheduleHistory[l.scheduleHistory.length-1];return l.graduatedOn||l.deletedOn||d.endDate&&n>=d.endDate?!1:de(l,n).name.trim().toLowerCase()===i.trim().toLowerCase()});c?wt(c.id,n,l=>({...l,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy??l.philosophy,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,times:o.times,frequency:o.frequency})):(s.habits.push({id:je(),createdOn:n,scheduleHistory:[{startDate:n,times:o.times,frequency:o.frequency,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,scheduleAnchor:n,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy}]}),Ve(!0))}else{let c=s.habits.find(l=>l.id===t);if(!c)return;Qe(n,c.id).dailySchedule=void 0,n<c.createdOn&&(c.createdOn=n),wt(c.id,n,l=>({...l,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy??l.philosophy,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,times:o.times,frequency:o.frequency}))}}async function Gi(e){if(s.aiState==="loading")return;let t=++s.aiReqId;s.aiState="loading",s.hasSeenAIResult=!1,ye(),Q(r.aiOptionsModal),W(`Iniciando an\xE1lise IA (${e})...`,"info","\u{1F916}");try{let a={promptTemplate:u(e==="monthly"?"aiPromptMonthly":e==="quarterly"?"aiPromptQuarterly":"aiPromptGeneral"),aiDaysUnit:u("unitDays",{count:2})};["aiPromptGraduatedSection","aiPromptNoData","aiPromptNone","aiSystemInstruction","aiPromptHabitDetails","aiVirtue","aiDiscipline","aiSphere","stoicVirtueWisdom","stoicVirtueCourage","stoicVirtueJustice","stoicVirtueTemperance","stoicDisciplineDesire","stoicDisciplineAction","stoicDisciplineAssent","governanceSphereBiological","governanceSphereStructural","governanceSphereSocial","governanceSphereMental","aiPromptNotesSectionHeader","aiStreakLabel","aiSuccessRateLabelMonthly","aiSuccessRateLabelQuarterly","aiSuccessRateLabelHistorical","aiHistoryChange","aiHistoryChangeFrequency","aiHistoryChangeGoal","aiHistoryChangeTimes"].forEach(l=>a[l]=u(l)),nt.forEach(l=>a[l.nameKey]=u(l.nameKey));let n=k.serializeLogsForCloud(),{prompt:i,systemInstruction:o}=await He("build-ai-prompt",{analysisType:e,habits:s.habits,dailyData:s.dailyData,archives:s.archives,monthlyLogsSerialized:n,languageName:Nt(),translations:a,todayISO:O()});if(t!==s.aiReqId)return;let c=await ze("/api/analyze",{method:"POST",body:JSON.stringify({prompt:i,systemInstruction:o})});t===s.aiReqId&&(s.lastAIResult=await c.text(),s.aiState="completed",W("An\xE1lise IA conclu\xEDda.","success","\u2728"))}catch(a){t===s.aiReqId&&(s.lastAIError=String(a),s.aiState="error",s.lastAIResult=u("aiErrorGeneric"),W("Erro na an\xE1lise IA.","error","\u274C"))}finally{t===s.aiReqId&&(ee(),ye())}}function Vi(){let e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async t=>{let a=t.target.files?.[0];if(a)try{let n=JSON.parse(await a.text());if(n.habits&&n.version)await Ce(n),await ee(),["render-app","habitsChanged"].forEach(i=>document.dispatchEvent(new CustomEvent(i))),Q(r.manageModal),oe(u("importSuccess"),()=>{},{title:u("privacyLabel"),confirmText:"OK",hideCancel:!0});else throw 0}catch{oe(u("importError"),()=>{},{title:u("importError"),confirmText:"OK",hideCancel:!0,confirmButtonStyle:"danger"})}},e.click()}function $i(e,t,a){if(!s.initialSyncDone)return;let n=k.getStatus(e,a,t),i=A.DONE;n===A.DONE||n===A.DONE_PLUS?i=A.DEFERRED:n===A.DEFERRED&&(i=A.NULL),k.setStatus(e,a,t,i),ee();let o=s.habits.find(c=>c.id===e);i===A.DONE?(o&&Ki(o,a),M("light")):i===A.DEFERRED?M("medium"):M("selection"),document.dispatchEvent(new CustomEvent("card-status-changed",{detail:{habitId:e,time:t,date:a}})),zi(a,[e])}function Wi(e,t){if(Qa||!s.initialSyncDone)return!1;Qa=!0;let a=I(e),n=!1;ja.length=Xa.length=0;try{s.habits.forEach(i=>{if(!et(i,e,a))return;let o=fe(i,e);if(!o.length)return;let c=t==="completed"?A.DONE:A.DEFERRED;o.forEach(l=>{k.getStatus(i.id,e,l)!==c&&(k.setStatus(i.id,e,l,c),n=!0)}),n&&(ja.push(i.id),Xa.push(i))}),n&&(Ta(e,ja),t==="completed"&&Xa.forEach(i=>Ki(i,e)),requestAnimationFrame(()=>Ha(e)),Ve(!1))}finally{Qa=!1}return n}function Yi(e,t,a,n){if(!s.initialSyncDone)return;let i=Zt(e);i&&(G.drop={habitId:e,fromTime:t,toTime:a,reorderInfo:n},oe(u("confirmHabitMove",{habitName:de(i,s.selectedDate).name,oldTime:Ue(t),newTime:Ue(a)}),Es,{title:u("modalMoveHabitTitle"),confirmText:u("buttonFromNowOn"),editText:u("buttonJustToday"),onEdit:vs,onCancel:()=>G.reset()}))}function ea(e){if(!s.initialSyncDone)return;let t=Zt(e),a=Ie(s.selectedDate);t&&(G.ending={habitId:e,targetDate:a},oe(u("confirmEndHabit",{habitName:de(t,a).name,date:ue(I(a),{day:"numeric",month:"long",timeZone:"UTC"})}),()=>{wt(e,a,n=>({...n,endDate:a}),!0),G.reset()},{confirmButtonStyle:"danger",confirmText:u("endButton"),onCancel:()=>G.reset()}))}function ji(e){s.initialSyncDone&&Zt(e)&&(G.deletion={habitId:e},oe(u("confirmPermanentDelete",{habitName:de(s.habits.find(t=>t.id===e)).name}),xs,{confirmButtonStyle:"danger",confirmText:u("deleteButton"),onCancel:()=>G.reset()}))}function Xi(e){if(!s.initialSyncDone)return;let t=s.habits.find(a=>a.id===e);t&&(t.graduatedOn=Ie(s.selectedDate),Ve(!0,!0),M("success"))}async function Qi(){s.habits=[],s.dailyData={},s.archives={},s.notificationsShown=[],s.pending21DayHabitIds=[],s.pendingConsolidationHabitIds=[],s.monthlyLogs=new Map,document.dispatchEvent(new CustomEvent("render-app"));try{await Ai()}catch(e){console.error(e)}finally{vt(),window.location.reload()}}function Zi(){if(!s.editingNoteFor)return;let{habitId:e,date:t,time:a}=s.editingNoteFor,n=r.notesTextarea.value.trim(),i=xa(t,e,a);(i.note||"")!==n&&(i.note=n||void 0,s.uiDirtyState.habitListStructure=!0,ee(),document.dispatchEvent(new CustomEvent("render-app"))),Q(r.notesModal)}function Za(e,t,a,n){if(s.initialSyncDone)try{let i=s.habits.find(c=>c.id===e);if(!i)return;xa(t,e,a).goalOverride=n;let o=k.getStatus(e,t,a);if(o===A.DONE||o===A.DONE_PLUS){let c=_e(i,t);c?.goal?.total&&n>c.goal.total?o!==A.DONE_PLUS&&k.setStatus(e,t,a,A.DONE_PLUS):o!==A.DONE&&k.setStatus(e,t,a,A.DONE)}ee(),document.dispatchEvent(new CustomEvent("card-goal-changed",{detail:{habitId:e,time:a,date:t}})),zi(t,[e])}catch(i){console.error(i)}}function Ji(e,t){if(!s.initialSyncDone)return;let a=Zt(e),n=Ie(s.selectedDate);a&&(G.removal={habitId:e,time:t,targetDate:n},oe(u("confirmRemoveTimePermanent",{habitName:de(a,n).name,time:Ue(t)}),()=>{Qe(n,e).dailySchedule=void 0,wt(e,n,i=>({...i,times:i.times.filter(o=>o!==t)}),!0),G.reset()},{title:u("modalRemoveTimeTitle"),confirmText:u("deleteButton"),confirmButtonStyle:"danger",onCancel:()=>G.reset()}))}function eo(){let e=ce(),t=k.serializeLogsForCloud();t.length>0&&(e.monthlyLogsSerialized=t);let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=`askesis-backup-${O()}.json`,i.click(),URL.revokeObjectURL(n)}function to(){let e=O();ut(),vn(),En(),s.uiDirtyState.calendarVisuals=s.uiDirtyState.habitListStructure=s.uiDirtyState.chartData=!0,s.calendarDates=[],s.selectedDate!==e&&(s.selectedDate=e),document.dispatchEvent(new CustomEvent("render-app"))}function Fi(e,t,a){if(e.length===0)return"";let n=e.map(o=>s.habits.find(c=>c.id===o)).filter(Boolean).map(o=>de(o).name),i=Hn(n);return e.forEach(o=>{let c=`${o}-${a}`;s.notificationsShown.includes(c)||s.notificationsShown.push(c)}),u(t,{count:e.length,habitNames:i})}function ao(){let e=Fi(s.pending21DayHabitIds,"aiCelebration21Day",dt),a=[Fi(s.pendingConsolidationHabitIds,"aiCelebration66Day",Ke),e].filter(Boolean).join(`

`);return a&&(s.pending21DayHabitIds=[],s.pendingConsolidationHabitIds=[],ee()),a}function no({viewportEl:e,reelEl:t,prevBtn:a,nextBtn:n,optionsCount:i,getInitialIndex:o,onIndexChange:c,render:l}){let d=o(),p=0,f=95,b=typeof window<"u"&&!!(t.attributeStyleMap&&window.CSSTranslate&&window.CSS&&CSS.px),E=(P,V)=>{let Te=-(P*f)|0;p=Te,V?t.style.transition="":t.style.transition="none",b&&t.attributeStyleMap?t.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(Te),CSS.px(0))):t.style.transform=`translateX(${Te}px)`},S=async P=>{let V;P==="next"?V=(d+1)%i:V=(d-1+i)%i,await c(V),d=o(),l(),E(d,!0)};a.addEventListener("click",()=>S("prev")),n.addEventListener("click",()=>S("next")),e.addEventListener("keydown",P=>{P.key==="ArrowRight"?S("next"):P.key==="ArrowLeft"&&S("prev")});let L=0,_=!1,F=0,R=0;new ResizeObserver(P=>{R&&cancelAnimationFrame(R),R=requestAnimationFrame(()=>{for(let V of P){let Te=V.target.firstElementChild;Te&&(f=Te.clientWidth,E(d,!1))}})}).observe(t);let re=40,X=P=>{if(!_)return;P.preventDefault();let V=P.clientX-L|0,Te=F+V|0,ln=-((i-1)*f),ve=Math.max(ln,Math.min(0,Te));p=ve,b&&t.attributeStyleMap?t.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(ve),CSS.px(0))):t.style.transform=`translateX(${ve}px)`},ae=P=>{if(window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",he),window.removeEventListener("pointercancel",ae),!!_){_=!1,e.classList.remove("is-interacting"),document.body.classList.remove("is-interaction-active");try{e.hasPointerCapture(P.pointerId)&&e.releasePointerCapture(P.pointerId)}catch{}requestAnimationFrame(()=>{t.style.transition=""}),d=o(),l(),E(d,!0)}},he=async P=>{if(!_)return;window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",he);let V=P.clientX-L;document.body.classList.remove("is-interaction-active"),Math.abs(V)>re&&(V<0?await c((d+1)%i):await c((d-1+i)%i)),ae(P)};e.addEventListener("pointerdown",P=>{P.button===0&&(L=P.clientX,_=!0,d=o(),e.setPointerCapture(P.pointerId),e.classList.add("is-interacting"),document.body.classList.add("is-interaction-active"),F=p,t.style.transition="none",window.addEventListener("pointermove",X,{passive:!1}),window.addEventListener("pointerup",he),window.addEventListener("pointercancel",ae))}),E(d,!1)}var Ja=50;function io(e){s.selectedDate=e,Q(r.fullCalendarModal),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,bn(),$(),requestAnimationFrame(()=>{r.calendarStrip.querySelector(".day-item.selected")?.scrollIntoView({behavior:"auto",block:"nearest",inline:"center"})})}function Ts(e){let t=r.editHabitForm.querySelector(".form-notice"),a=r.editHabitForm.elements.namedItem("habit-name"),n=e.trim(),i=null,o=n.length===0;o?i="noticeNameCannotBeEmpty":n.length>16&&(i="noticeNameTooLong");let c=!o;if(!i)t.classList.contains("visible")&&(t.classList.remove("visible"),a.classList.remove("shake"));else{let l=u(i);t.textContent!==l&&(t.textContent=l),t.classList.contains("visible")||(t.classList.add("visible"),o&&requestAnimationFrame(()=>{a.classList.add("shake"),a.addEventListener("animationend",()=>a.classList.remove("shake"),{once:!0})}))}return r.editHabitSaveBtn.disabled=o,c}var Ss=()=>{r.manageModal.classList.contains("visible")||(M("light"),Vt(),ot(),ie(r.manageModal))},Ls=()=>{r.exploreModal.classList.contains("visible")||(M("light"),Wt(),ie(r.exploreModal))},ws=e=>{let a=e.target.closest("button");if(!a)return;let n=a.closest("li.habit-list-item")?.dataset.habitId;n&&(r.confirmModal.classList.contains("visible")||(M("light"),a.classList.contains("end-habit-btn")?ea(n):a.classList.contains("permanent-delete-habit-btn")?ji(n):a.classList.contains("graduate-habit-btn")&&Xi(n)))},Ds=e=>{let t=e.target;t.id==="export-data-btn"?eo():t.id==="import-data-btn"&&Vi()},Ms=()=>{r.confirmModal.classList.contains("visible")||(M("light"),oe(u("confirmResetApp"),Qi,{confirmText:u("modalManageResetButton"),title:u("modalManageReset"),confirmButtonStyle:"danger"}))},Cs=()=>{Se(async e=>{r.notificationToggle.checked?await e.Notifications.requestPermission():await e.User.PushSubscription.optOut(),r.notificationToggle.disabled=!0,v(r.notificationStatusDesc,u("notificationChangePending"))})},As=e=>{let t=e.target.closest(".explore-habit-item");if(!t)return;M("light");let a=parseInt(t.dataset.index,10),n=nt[a];n&&(Q(r.exploreModal),za(n))},Hs=e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();let t=e.target.closest(".explore-habit-item");t&&t.click()}},Is=()=>{M("light"),Q(r.exploreModal),za(null)},ks=async()=>{if(s.aiState==="loading"||r.aiModal.classList.contains("visible")||r.aiOptionsModal.classList.contains("visible"))return;if(M("light"),!navigator.onLine){try{let{STOIC_QUOTES:a}=await import("./quotes-PA7LB5UR.js"),n=a.filter(f=>f.metadata.tags.includes("control")||f.metadata.tags.includes("acceptance")||f.metadata.tags.includes("perception")),i=n.length>0?n:a,o=i[Math.floor(Math.random()*i.length)],c=s.activeLanguageCode,l=o.original_text[c],d=u(o.author),p=`
                <div class="offline-header">
                    <h3 class="offline-title">${u("aiOfflineTitle")}</h3>
                    <p class="offline-desc">${u("aiOfflineMessage")}</p>
                </div>
                <div class="offline-quote-box">
                    <blockquote class="offline-quote-text">
                        "${l}"
                    </blockquote>
                    <div class="offline-quote-author">
                        \u2014 ${d}
                    </div>
                </div>
            `;r.aiResponse.innerHTML=p,ie(r.aiModal)}catch(a){console.error("Failed to load offline quote",a)}return}let e="",t=ao();t?(e=va(t),ye()):(s.aiState==="completed"||s.aiState==="error")&&!s.hasSeenAIResult&&s.lastAIResult&&(e=va(s.lastAIResult)),e?(r.aiResponse.innerHTML=e,ie(r.aiModal,void 0,()=>{s.hasSeenAIResult=!0,ye()})):ie(r.aiOptionsModal)},Os=e=>{let t=e.target.closest(".ai-option-btn");if(!t)return;M("light");let a=t.dataset.analysisType;Gi(a)},_s=()=>{M("light");let e=s.confirmAction;try{e?.()}catch(t){console.error("Action execution failed",t)}s.confirmAction=null,s.confirmEditAction=null,Q(r.confirmModal,!0)},Rs=()=>{M("light");let e=s.confirmEditAction;try{e?.()}catch(t){console.error("Edit Action execution failed",t)}s.confirmAction=null,s.confirmEditAction=null,Q(r.confirmModal,!0)},Ps=()=>{s.fullCalendar.month--,s.fullCalendar.month<0&&(s.fullCalendar.month=11,s.fullCalendar.year--),Re()},Ns=()=>{s.fullCalendar.month++,s.fullCalendar.month>11&&(s.fullCalendar.month=0,s.fullCalendar.year++),Re()},Bs=e=>{let t=e.target.closest(".full-calendar-day");t&&t.dataset.date&&io(t.dataset.date)},Fs=e=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(e.key))return;if(e.preventDefault(),e.key==="Enter"||e.key===" "){io(s.selectedDate);return}let t=I(s.selectedDate),a;switch(e.key){case"ArrowRight":a=se(t,1);break;case"ArrowLeft":a=se(t,-1);break;case"ArrowUp":a=se(t,-7);break;case"ArrowDown":a=se(t,7);break;default:return}s.selectedDate=B(a),(a.getUTCMonth()!==s.fullCalendar.month||a.getUTCFullYear()!==s.fullCalendar.year)&&(s.fullCalendar.month=a.getUTCMonth(),s.fullCalendar.year=a.getUTCFullYear()),Re(),requestAnimationFrame(()=>{r.fullCalendarGrid.querySelector(`.full-calendar-day[data-date="${s.selectedDate}"]`)?.focus()})},zs=()=>{if(!s.editingHabit)return;let e=r.editHabitForm.elements.namedItem("habit-name"),t=e.value;t.length>Ja&&(t=t.substring(0,Ja),e.value=t),s.editingHabit.formData.nameKey&&(delete s.editingHabit.formData.nameKey,s.editingHabit.formData.subtitleKey="customHabitSubtitle",r.habitSubtitleDisplay&&v(r.habitSubtitleDisplay,u("customHabitSubtitle"))),s.editingHabit.formData.name=t,Ts(t)},Ks=()=>{Ba(),ie(r.iconPickerModal)},Us=e=>{let a=e.target.closest(".icon-picker-item");if(a&&s.editingHabit){M("light");let n=a.dataset.iconSvg;s.editingHabit.formData.icon=n,r.habitIconPickerBtn.innerHTML=n,Q(r.iconPickerModal)}},qs=e=>{let a=e.target.closest(".color-swatch");if(a&&s.editingHabit){M("light");let n=a.dataset.color;s.editingHabit.formData.color=n;let i=lt(n);r.habitIconPickerBtn.style.backgroundColor=n,r.habitIconPickerBtn.style.color=i,r.colorPickerGrid.querySelector(".selected")?.classList.remove("selected"),a.classList.add("selected"),r.iconPickerGrid.style.setProperty("--current-habit-bg-color",n),r.iconPickerGrid.style.setProperty("--current-habit-fg-color",i),r.iconPickerModal.classList.remove("is-picking-color"),Q(r.colorPickerModal,!0)}},Gs=()=>{gi(),r.iconPickerModal.classList.add("is-picking-color"),ie(r.colorPickerModal,void 0,()=>{r.iconPickerModal.classList.remove("is-picking-color"),Ba()})},Vs=e=>{if(!s.editingHabit)return;let t=e.target.closest(".segmented-control-option");if(!t)return;M("light");let a=t.dataset.time;s.editingHabit.formData.times.includes(a)?(s.editingHabit.formData.times=s.editingHabit.formData.times.filter(i=>i!==a),t.classList.remove("selected")):(s.editingHabit.formData.times.push(a),t.classList.add("selected"))},$s=e=>{let t=e.target;if(s.editingHabit){if(t.matches('input[name="frequency-type"]')){switch(t.value){case"daily":s.editingHabit.formData.frequency={type:"daily"};break;case"specific_days_of_week":let i=s.editingHabit.formData.frequency,o=i.type==="specific_days_of_week"?i.days:[];s.editingHabit.formData.frequency={type:"specific_days_of_week",days:o};break;case"interval":let c=fn.find(f=>f.value.type==="interval").value,l=s.editingHabit.formData.frequency,d=l.type==="interval"?l.amount:c.amount,p=l.type==="interval"?l.unit:c.unit;s.editingHabit.formData.frequency={type:"interval",amount:d,unit:p};break}$t()}else if(t.closest(".weekday-picker input")){let a=Array.from(r.frequencyOptionsContainer.querySelectorAll(".weekday-picker input:checked")).map(n=>parseInt(n.dataset.day,10));s.editingHabit.formData.frequency={type:"specific_days_of_week",days:a}}}},Ws=e=>{let a=e.target.closest(".stepper-btn, .unit-toggle-btn");if(!a||!s.editingHabit||s.editingHabit.formData.frequency.type!=="interval")return;let n=a.dataset.action,i=s.editingHabit.formData.frequency,{amount:o,unit:c}=i;n==="interval-decrement"&&(o=Math.max(1,o-1)),n==="interval-increment"&&(o=Math.min(99,o+1)),n==="interval-unit-toggle"&&(c=c==="days"?"weeks":"days"),s.editingHabit.formData.frequency={type:"interval",amount:o,unit:c},$t()};function oo(){r.manageHabitsBtn.addEventListener("click",Ss),r.fabAddHabit.addEventListener("click",Ls),r.habitList.addEventListener("click",ws),r.manageModal.addEventListener("click",Ds),r.resetAppBtn.addEventListener("click",Ms),r.notificationToggle.addEventListener("change",Cs),no({viewportEl:r.languageViewport,reelEl:r.languageReel,prevBtn:r.languagePrevBtn,nextBtn:r.languageNextBtn,optionsCount:pe.length,getInitialIndex:()=>pe.findIndex(t=>t.code===s.activeLanguageCode),onIndexChange:async t=>{let a=pe[t].code;a!==s.activeLanguageCode&&await Bt(a)},render:Yt}),r.exploreHabitList.addEventListener("click",As),r.exploreHabitList.addEventListener("keydown",Hs),r.createCustomHabitBtn.addEventListener("click",Is),r.aiEvalBtn.addEventListener("click",ks),r.aiOptionsModal.addEventListener("click",Os),r.confirmModalConfirmBtn.addEventListener("click",_s),r.confirmModalEditBtn.addEventListener("click",Rs),r.saveNoteBtn.addEventListener("click",()=>{M("light"),Zi()}),r.fullCalendarPrevBtn.addEventListener("click",Ps),r.fullCalendarNextBtn.addEventListener("click",Ns),r.fullCalendarGrid.addEventListener("click",Bs),r.fullCalendarGrid.addEventListener("keydown",Fs),r.editHabitSaveBtn.addEventListener("click",()=>{M("light"),qi()});let e=r.editHabitForm.elements.namedItem("habit-name");e.maxLength=Ja,e.addEventListener("input",zs),r.habitIconPickerBtn.addEventListener("click",Ks),r.iconPickerGrid.addEventListener("click",Us),r.colorPickerGrid.addEventListener("click",qs),r.changeColorFromPickerBtn.addEventListener("click",Gs),r.habitTimeContainer.addEventListener("click",Vs),r.frequencyOptionsContainer.addEventListener("change",$s),r.frequencyOptionsContainer.addEventListener("click",Ws)}var ro=5,ta=9999,Ys=`${z.HABIT_CONTENT_WRAPPER}, ${z.GOAL_CONTROL_BTN}, ${z.GOAL_VALUE_WRAPPER}, ${z.SWIPE_DELETE_BTN}, ${z.SWIPE_NOTE_BTN}, ${z.EMPTY_GROUP_PLACEHOLDER}`,js=(e,t)=>{let a=document.createElement("span");a.className="ripple";let n=t.getBoundingClientRect(),i=Math.max(n.width,n.height),o=e.clientX-n.left-i/2,c=e.clientY-n.top-i/2;a.style.width=a.style.height=`${i}px`,a.style.left=`${o}px`,a.style.top=`${c}px`,t.appendChild(a),a.addEventListener("animationend",()=>a.remove(),{once:!0})},Xs=(e,t,a)=>{if(e.querySelector("input"))return;let n=s.habits.find(d=>d.id===t);if(!n)return;let i=Je(n,s.selectedDate,a),o=e.innerHTML;e.innerHTML="";let c=document.createElement("input");c.type="number",c.value=String(i),c.className="goal-input-inline",c.min="1",c.max=String(ta),c.addEventListener("click",d=>d.stopPropagation());let l=()=>{let d=parseInt(c.value,10);(isNaN(d)||d<1)&&(d=1),d>ta&&(d=ta),d!==i?(Za(t,s.selectedDate,a,d),M("medium")):e.innerHTML=o};c.addEventListener("blur",l),c.addEventListener("keydown",d=>{d.key==="Enter"&&c.blur()}),e.appendChild(c),c.focus()},Qs=e=>{let t=e.target.closest(Ys);if(!t)return;if(t.classList.contains(y.EMPTY_GROUP_PLACEHOLDER)){M("light"),Wt(),ie(r.exploreModal);return}let a=t.closest(z.HABIT_CARD),{habitId:n,time:i}=a?.dataset||{};if(!n||!i)return;let o=i;if(t.classList.contains(y.SWIPE_DELETE_BTN)){M("light");let c=s.habits.find(l=>l.id===n);c&&fe(c,s.selectedDate).length<=1?ea(n):Ji(n,o);return}if(t.classList.contains(y.SWIPE_NOTE_BTN)){M("light"),fi(n,s.selectedDate,o);return}if(t.classList.contains(y.GOAL_VALUE_WRAPPER)){e.stopPropagation(),Xs(t,n,o);return}if(t.classList.contains(y.GOAL_CONTROL_BTN)){e.stopPropagation();let c=s.habits.find(b=>b.id===n);if(!c)return;let l=t.dataset.action,d=Je(c,s.selectedDate,o),p=l==="increment"?Math.min(ta,d+ro):Math.max(1,d-ro),f=t.parentElement?.querySelector(`.${y.GOAL_VALUE_WRAPPER}`);f&&(f.classList.remove("increase","decrease"),f.offsetWidth,f.classList.add(p>d?"increase":"decrease"),setTimeout(()=>f.classList.remove("increase","decrease"),700)),Za(n,s.selectedDate,o,p),M("light");return}if(t.classList.contains(y.HABIT_CONTENT_WRAPPER)){if(a.classList.contains(y.IS_OPEN_LEFT)||a.classList.contains(y.IS_OPEN_RIGHT)){a.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT);return}let c=t.querySelector(".ripple-container");c&&js(e,c),M("light"),$i(n,o,s.selectedDate)}};function so(){r.habitContainer.addEventListener("click",Qs)}var en=0,aa=1,Zs=2,co=5,Dt=10,lo=15,x={isActive:0,startX:0,startY:0,currentX:0,direction:en,wasOpenLeft:0,wasOpenRight:0,actionWidth:60,pointerId:-1,rafId:0,hasHaptics:0,card:null,content:null,hasTypedOM:!1},uo=()=>x.isActive===1;function Js(){let e=getComputedStyle(document.documentElement);x.actionWidth=parseInt(e.getPropertyValue("--swipe-action-width"))||60,x.hasTypedOM=typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px)}function ec(e){let{card:t,wasOpenLeft:a,wasOpenRight:n}=x;t&&(a?e<-Dt&&t.classList.remove(y.IS_OPEN_LEFT):n?e>Dt&&t.classList.remove(y.IS_OPEN_RIGHT):e>Dt?t.classList.add(y.IS_OPEN_LEFT):e<-Dt&&t.classList.add(y.IS_OPEN_RIGHT))}function tc(e){if((e<0?-e:e)<=Dt)return;let t=a=>{let n=a.target;!n.closest(z.SWIPE_DELETE_BTN)&&!n.closest(z.SWIPE_NOTE_BTN)&&(a.stopPropagation(),a.preventDefault()),window.removeEventListener("click",t,!0)};window.addEventListener("click",t,!0),setTimeout(()=>window.removeEventListener("click",t,!0),150)}var ac=()=>{if(!x.card||!x.content||x.direction!==aa){x.rafId=0;return}let e=x.currentX-x.startX|0;x.wasOpenLeft&&(e+=x.actionWidth),x.wasOpenRight&&(e-=x.actionWidth),x.hasTypedOM&&x.content.attributeStyleMap?x.content.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(e),CSS.px(0))):x.content.style.transform=`translateX(${e}px)`;let t=e<0?-e:e;!x.hasHaptics&&t>lo?(M("light"),x.hasHaptics=1):x.hasHaptics&&t<lo&&(x.hasHaptics=0),x.rafId=0},na=()=>{x.rafId&&cancelAnimationFrame(x.rafId);let{card:e,content:t,pointerId:a}=x;if(e){if(a!==-1)try{e.releasePointerCapture(a)}catch{}e.classList.remove(y.IS_SWIPING),t&&(x.hasTypedOM&&t.attributeStyleMap?t.attributeStyleMap.clear():t.style.transform="",t.draggable=!0)}document.body.classList.remove("is-interaction-active"),s.uiDirtyState.habitListStructure&&requestAnimationFrame(()=>$()),window.removeEventListener("pointermove",po),window.removeEventListener("pointerup",mo),window.removeEventListener("pointercancel",na),x.card=x.content=null,x.isActive=0,x.direction=en,x.pointerId=-1},po=e=>{if(x.card){if(x.currentX=e.clientX|0,x.direction===en){let t=Math.abs(x.currentX-x.startX),a=Math.abs((e.clientY|0)-x.startY);if(t>co||a>co)if(t>a){x.direction=aa,x.isActive=1,document.body.classList.add("is-interaction-active"),x.card.classList.add(y.IS_SWIPING),x.content&&(x.content.draggable=!1);try{x.card.setPointerCapture(e.pointerId),x.pointerId=e.pointerId}catch{}}else{x.direction=Zs,na();return}}x.direction===aa&&(e.preventDefault(),x.rafId||(x.rafId=requestAnimationFrame(ac)))}},mo=()=>{if(x.card&&x.direction===aa){let e=x.currentX-x.startX|0;ec(e),tc(e)}na()};function fo(e){Js(),e.addEventListener("pointerdown",t=>{if(x.card||t.button!==0)return;let a=t.target.closest(z.HABIT_CONTENT_WRAPPER),n=a?.closest(z.HABIT_CARD);if(!n||!a)return;let i=e.querySelector(`.${y.IS_OPEN_LEFT}, .${y.IS_OPEN_RIGHT}`);i&&i!==n&&i.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT),x.card=n,x.content=a,x.startX=x.currentX=t.clientX|0,x.startY=t.clientY|0,x.wasOpenLeft=n.classList.contains(y.IS_OPEN_LEFT)?1:0,x.wasOpenRight=n.classList.contains(y.IS_OPEN_RIGHT)?1:0,x.hasHaptics=0,window.addEventListener("pointermove",po,{passive:!1}),window.addEventListener("pointerup",mo),window.addEventListener("pointercancel",na)})}var ia=80,go=15,oa=4,nc=typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px),ic=`${z.HABIT_CARD}:not(.${y.DRAGGING})`,g={isActive:!1,container:null,containerRect:null,sourceEl:null,sourceId:null,sourceTime:null,cachedSchedule:null,targetZone:null,targetCard:null,insertPos:null,indicator:null,renderedZone:null,isValidDrop:!1,scrollSpeed:0,rafId:0};function oc(e,t){let a=e.querySelectorAll(ic),n=null,i=Number.NEGATIVE_INFINITY;for(let o of a){let c=o.getBoundingClientRect(),l=t-c.top-c.height/2;l<0&&l>i&&(i=l,n=o)}return n}function ho(){if(g.isActive){if(g.scrollSpeed!==0&&g.container&&g.container.scrollBy(0,g.scrollSpeed),g.renderedZone!==g.targetZone&&(g.renderedZone&&(g.renderedZone.classList.remove(y.DRAG_OVER,y.INVALID_DROP),g.indicator&&g.indicator.parentElement===g.renderedZone&&g.indicator.remove()),g.renderedZone=g.targetZone),g.targetZone&&g.indicator){let e=g.targetZone.dataset.time===g.sourceTime,t=g.isValidDrop&&!e,a=!g.isValidDrop;if(g.targetZone.classList.contains(y.DRAG_OVER)!==t&&g.targetZone.classList.toggle(y.DRAG_OVER,t),g.targetZone.classList.contains(y.INVALID_DROP)!==a&&g.targetZone.classList.toggle(y.INVALID_DROP,a),g.indicator.parentElement!==g.targetZone&&g.targetZone.appendChild(g.indicator),g.isValidDrop){g.indicator.classList.add("visible");let n=0;if(g.targetCard)g.insertPos==="before"?n=g.targetCard.offsetTop-oa:n=g.targetCard.offsetTop+g.targetCard.offsetHeight+oa;else if(g.targetZone.children.length===0)n=oa;else{let i=g.targetZone.lastElementChild;i&&i!==g.indicator&&(n=i.offsetTop+i.offsetHeight+oa)}nc&&g.indicator.attributeStyleMap?g.indicator.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(0),CSS.px(n),CSS.px(0))):g.indicator.style.transform=`translate3d(0, ${n}px, 0)`}else g.indicator.classList.remove("visible")}g.rafId=requestAnimationFrame(ho)}}var yo=e=>{if(e.preventDefault(),!g.isActive||!g.container)return;let t=e.clientY,a=g.containerRect;if(a){let{top:d,height:p}=a,f=d+p,b=d+ia,E=f-ia;if(t<b){let S=(b-t)/ia;g.scrollSpeed=-Math.max(2,S*go)}else if(t>E){let S=(t-E)/ia;g.scrollSpeed=Math.max(2,S*go)}else g.scrollSpeed=0}let n=e.target,i=n.closest(z.DROP_ZONE);if(!i){let d=n.closest(".habit-group-wrapper");d&&(i=d.querySelector(z.DROP_ZONE))}if(!i){g.targetZone=null,g.isValidDrop=!1;return}let o=i.dataset.time,c=o===g.sourceTime,l=!0;if(!c&&g.cachedSchedule?.includes(o)&&(l=!1),g.targetZone=i,g.isValidDrop=l,l){let d=oc(i,t);if(d)g.targetCard=d,g.insertPos="before";else{let p=i.querySelector(`${z.HABIT_CARD}:not(.${y.DRAGGING}):last-child`);p?(g.targetCard=p,g.insertPos="after"):(g.targetCard=null,g.insertPos=null)}}else g.targetCard=null;e.dataTransfer.dropEffect=l?"move":"none"},bo=e=>{if(e.preventDefault(),!g.isActive||!g.isValidDrop||!g.sourceId||!g.sourceTime)return;let t=g.targetZone.dataset.time,a=g.sourceTime===t,n;g.targetCard&&g.targetCard.dataset.habitId&&(n={id:g.targetCard.dataset.habitId,pos:g.insertPos||"after"}),a?n&&(M("medium"),Jt(g.sourceId,n.id,n.pos)):(M("medium"),Yi(g.sourceId,g.sourceTime,t,n)),tn()},tn=()=>{g.rafId&&cancelAnimationFrame(g.rafId),document.body.classList.remove("is-dragging-active"),(s.uiDirtyState.habitListStructure||s.uiDirtyState.calendarVisuals)&&requestAnimationFrame(()=>$()),g.sourceEl?.classList.remove(y.DRAGGING),g.container&&g.container.classList.remove("is-dragging"),g.renderedZone&&g.renderedZone.classList.remove(y.DRAG_OVER,y.INVALID_DROP),g.indicator?.remove(),document.removeEventListener("dragover",yo),document.removeEventListener("drop",bo),document.removeEventListener("dragend",tn),g.isActive=!1,g.sourceEl=null,g.targetZone=null,g.targetCard=null,g.renderedZone=null,g.scrollSpeed=0,g.containerRect=null},rc=e=>{if(uo()){e.preventDefault();return}let a=e.target.closest(z.HABIT_CARD);if(!a||!a.dataset.habitId||!a.dataset.time)return;g.isActive=!0,g.sourceEl=a,g.sourceId=a.dataset.habitId,g.sourceTime=a.dataset.time,g.container&&(g.containerRect=g.container.getBoundingClientRect());let n=s.habits.find(o=>o.id===g.sourceId);n&&(g.cachedSchedule=fe(n,s.selectedDate)),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",g.sourceId);let i=a.querySelector(z.HABIT_CONTENT_WRAPPER);if(i){let o=i.cloneNode(!0);o.classList.add(y.DRAG_IMAGE_GHOST);let c=i.getBoundingClientRect();o.style.width=`${c.width}px`,o.style.height=`${c.height}px`;let l=window.getComputedStyle(i);o.style.backgroundColor=l.backgroundColor,o.style.backgroundImage=l.backgroundImage,o.style.backgroundSize=l.backgroundSize,o.style.color=l.color,o.style.borderRadius=l.borderRadius,o.style.position="absolute",o.style.left=`${c.left+window.scrollX}px`,o.style.top=`${c.top+window.scrollY}px`,o.style.zIndex="10000",o.style.margin="0",o.style.pointerEvents="none",o.style.transform="scale(1.05)",o.style.boxShadow="0 15px 30px rgba(0,0,0,0.3)",o.style.transformOrigin="center center",document.body.appendChild(o);let d=Math.max(0,e.clientX-c.left),p=Math.max(0,e.clientY-c.top);e.dataTransfer.setDragImage(o,d,p),setTimeout(()=>o.remove(),0)}g.indicator=document.createElement("div"),g.indicator.className="drop-indicator",document.addEventListener("dragover",yo),document.addEventListener("drop",bo),document.addEventListener("dragend",tn),M("light"),requestAnimationFrame(()=>{a.classList.add(y.DRAGGING),document.body.classList.add("is-dragging-active"),g.container&&g.container.classList.add("is-dragging"),ho()})};function vo(e){g.container=e,e.addEventListener("dragstart",rc)}var Eo=350,sc=15,cc=30,lc=1500,xo=200,te={isScrolling:!1,scrollRafId:0,pressTimerId:0,isLongPress:!1,activeDateISO:null,lastFetchTime:0},dc=()=>{te.isScrolling||(te.isScrolling=!0,te.scrollRafId=requestAnimationFrame(()=>{let e=r.calendarStrip;if(!e){te.isScrolling=!1,te.scrollRafId=0;return}let t=e.scrollLeft,a=e.scrollWidth,n=e.clientWidth,i=a-n,o=Date.now(),l=o-te.lastFetchTime<lc?cc:sc;if(t<Eo){te.lastFetchTime=o;let d=e.firstElementChild;if(d&&d.dataset.date){let p=d.dataset.date,f=document.createDocumentFragment();for(let S=0;S<l;S++)p=Xn(p,f);let b=e.scrollWidth;e.insertBefore(f,e.firstElementChild);let E=e.scrollWidth;if(e.scrollLeft+=E-b,e.children.length>xo)for(let S=0;S<l;S++)e.lastElementChild?.remove()}}else if(i-t<Eo){te.lastFetchTime=o;let d=e.lastElementChild;if(d&&d.dataset.date){let p=d.dataset.date,f=document.createDocumentFragment();for(let b=0;b<l;b++)p=jn(p,f);if(e.appendChild(f),e.children.length>xo){let b=l,E=e.scrollWidth;for(let L=0;L<b;L++)e.firstElementChild?.remove();let S=e.scrollWidth;e.scrollLeft-=E-S}}}te.isScrolling=!1,te.scrollRafId=0}))},uc=e=>{if(e.button!==0)return;let t=e.target.closest(z.DAY_ITEM);if(!t||!t.dataset.date)return;te.isLongPress=!1,te.activeDateISO=t.dataset.date,t.classList.add("is-pressing"),te.pressTimerId=window.setTimeout(()=>{te.isLongPress=!0,M("medium"),t.classList.remove("is-pressing"),mc(t)},500);let a=()=>{clearTimeout(te.pressTimerId),t.classList.remove("is-pressing"),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)};window.addEventListener("pointerup",a,{once:!0}),window.addEventListener("pointercancel",a,{once:!0})},pc=e=>{if(te.isLongPress){e.preventDefault(),e.stopPropagation();return}let t=e.target.closest(z.DAY_ITEM);if(t&&t.dataset.date){let a=t.dataset.date;if(s.selectedDate!==a){M("selection"),s.selectedDate=a;let n=r.calendarStrip.querySelector(`.${y.SELECTED}`);n&&(n.classList.remove(y.SELECTED),n.setAttribute("aria-current","false"),n.setAttribute("tabindex","-1")),t.classList.add(y.SELECTED),t.setAttribute("aria-current","date"),t.setAttribute("tabindex","0"),s.uiDirtyState.habitListStructure=!0,s.uiDirtyState.chartData=!0,document.dispatchEvent(new CustomEvent("render-app"))}}},mc=e=>{if(!e.dataset.date)return;let a=e.getBoundingClientRect(),n=r.calendarQuickActions,i=n.querySelector(".quick-actions-content");if(!i)return;let o=a.bottom+8,c=a.left+a.width/2;n.style.setProperty("--actions-top",`${o}px`),n.style.setProperty("--actions-left",`${c}px`),i.style.setProperty("--translate-x","-50%"),ie(n)},an=()=>{M("light");let e=O();r.calendarStrip.querySelector(`.${y.TODAY}`)&&s.selectedDate===e?zt(!0):(s.selectedDate=e,s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,$())},fc=e=>{let t=e.target.closest(".full-calendar-day");if(t&&t.dataset.date&&!t.classList.contains("other-month")){let a=t.dataset.date;M("selection"),s.selectedDate=a,Q(r.fullCalendarModal),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,$(),requestAnimationFrame(()=>zt(!1))}},gc=()=>{if(!s.fullCalendar)return;let{month:e,year:t}=s.fullCalendar;e--,e<0&&(e=11,t--),s.fullCalendar={month:e,year:t},Re(),M("light")},hc=()=>{if(!s.fullCalendar)return;let{month:e,year:t}=s.fullCalendar;e++,e>11&&(e=0,t++),s.fullCalendar={month:e,year:t},Re(),M("light")};function To(){r.calendarStrip.addEventListener("pointerdown",uc),r.calendarStrip.addEventListener("click",pc),r.calendarStrip.addEventListener("scroll",dc,{passive:!0}),r.headerTitle.addEventListener("click",an),r.navArrowPast.addEventListener("click",an),r.navArrowFuture.addEventListener("click",an);let e=t=>{let a=te.activeDateISO;if(Q(r.calendarQuickActions),t==="almanac"){if(M("light"),a){let n=I(a);s.fullCalendar={year:n.getUTCFullYear(),month:n.getUTCMonth()}}Re(),ie(r.fullCalendarModal);return}a&&(M(t==="completed"?"success":"medium"),Wi(a,t))};r.quickActionDone.addEventListener("click",()=>e("completed")),r.quickActionSnooze.addEventListener("click",()=>e("snoozed")),r.quickActionAlmanac.addEventListener("click",()=>e("almanac")),r.fullCalendarPrevBtn.addEventListener("click",gc),r.fullCalendarNextBtn.addEventListener("click",hc),r.fullCalendarGrid.addEventListener("click",fc)}var yc={weekday:"long",day:"numeric",month:"long",timeZone:"UTC"},ct=null,So=0,ra=null;function bc(){ct=null;let{wrapper:e,tooltip:t,indicator:a,tooltipDate:n,tooltipScoreLabel:i,tooltipScoreValue:o,tooltipHabits:c}=r.chart,{lastChartData:l,chartMinVal:d,chartValueRange:p,hasTypedOM:f}=U;if(!e||!t||!a||!n||!i||!o||!c||l.length===0||!e.isConnected)return;U.cachedChartRect||(U.cachedChartRect=e.getBoundingClientRect());let b=U.cachedChartRect.width;if(b===0)return;let E=xe.left,S=b-E-xe.right,L=l.length,R=(So-U.cachedChartRect.left-E)/S*(L-1)+.5|0,j=R<0?0:R>=L?L-1:R;if(j!==U.lastRenderedPointIndex){U.lastRenderedPointIndex=j;let re=l[j],X=yt-xe.top-xe.bottom,ae=E+j/(L-1)*S,he=xe.top+X-(re.value-d)/p*X;f&&a.attributeStyleMap?(a.style.opacity="1",a.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(ae),CSS.px(0)))):(a.style.opacity="1",a.style.transform=`translateX(${ae}px)`),ra||(ra=a.querySelector(".chart-indicator-dot")),ra&&(ra.style.top=`${he}px`);let P=ue(re.timestamp,yc);v(n,P),v(i,u("chartTooltipScore")+": "),v(o,Cn(re.value)),v(c,u("chartTooltipCompleted",{completed:re.completedCount,total:re.scheduledCount})),t.classList.contains("visible")||t.classList.add("visible");let V="-50%";ae<50?V="0%":ae>b-50&&(V="-100%"),t.style.transform=`translate3d(calc(${ae}px + ${V}), calc(${yt/2}px - 50%), 0)`}}function Lo(){let{wrapper:e,tooltip:t,indicator:a}=r.chart;if(!e||!t||!a)return;let n=o=>{So=o.clientX,ct||(ct=requestAnimationFrame(bc))},i=()=>{ct&&(cancelAnimationFrame(ct),ct=null),t.classList.remove("visible"),a.style.opacity="0",U.lastRenderedPointIndex=-1};e.addEventListener("pointermove",n),e.addEventListener("pointerleave",i),e.addEventListener("pointercancel",i)}var sa=new Map;async function wo(e){if(s.dailyDiagnoses[e]||sa.has(e))return sa.get(e);let a=(async()=>{let n="",i=le(e);if(Object.keys(i).forEach(o=>Object.keys(i[o].instances).forEach(c=>{let l=i[o].instances[c]?.note;l&&(n+=`- ${l}
`)})),!(!n.trim()||!navigator.onLine))try{let o={notes:n,themeList:u("aiThemeList"),languageName:Nt(),translations:{aiPromptQuote:u("aiPromptQuote"),aiSystemInstructionQuote:u("aiSystemInstructionQuote")}},{prompt:c,systemInstruction:l}=await He("build-quote-analysis-prompt",o),f=(await(await ze("/api/analyze",{method:"POST",body:JSON.stringify({prompt:c,systemInstruction:l})})).text()).replace(/```json|```/g,"").trim(),b=JSON.parse(f);b?.analysis&&(s.dailyDiagnoses[e]={level:b.analysis.determined_level,themes:b.relevant_themes,timestamp:Date.now()},ee())}catch(o){console.error("Context analysis failed",o)}finally{sa.delete(e)}})();return sa.set(e,a),a}var vc=500,Ec=500,xc=50,Do=!1,nn,ca=null,Tc=()=>{window.setTimeout(ot,Ec)},Sc=e=>{e.Notifications.addEventListener("permissionChange",Tc),ot()},on=()=>{nn&&clearTimeout(nn),nn=window.setTimeout(()=>{let e=navigator.onLine,t=document.body.classList.contains("is-offline");document.body.classList.toggle("is-offline",!e),t===e&&ye(),e&&(console.log("[Network] Online stable. Flushing pending sync."),be(ce()))},vc)},Lc=()=>{if(document.visibilityState==="visible"){on();let e=O();ha();let t=O();e!==t?(s.selectedDate===e&&(s.selectedDate=t),document.dispatchEvent(new CustomEvent("dayChanged"))):(ca&&cancelAnimationFrame(ca),ca=requestAnimationFrame(()=>{$(),ca=null}))}},wc=e=>{e.data&&e.data.type==="REQUEST_SYNC"&&(console.log("[SW Message] Sincroniza\xE7\xE3o solicitada pelo Service Worker."),be(ce(),!0))},Mo=e=>{let{habitId:t,time:a}=e.detail,n=s.habits.find(o=>o.id===t),i=ii(t,a);if(i||(i=document.querySelector(`.habit-card[data-habit-id="${t}"][data-time="${a}"]`)),n&&i){let o=e.type==="card-status-changed";Ut(i,n,a,void 0,{animate:o})}};function Co(){if(Do)return;Do=!0,mi(),oo(),so(),To(),Se(Sc),document.addEventListener("render-app",$),document.addEventListener("request-analysis",t=>{let a=t;a.detail?.date&&wo(a.detail.date)}),document.addEventListener("card-status-changed",Mo),document.addEventListener("card-goal-changed",Mo),window.addEventListener("online",on),window.addEventListener("offline",on),document.addEventListener("visibilitychange",Lc),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",wc),document.body.classList.toggle("is-offline",!navigator.onLine);let e=()=>{try{let t=r.habitContainer;vo(t),fo(t),Lo()}catch{}};"scheduler"in window&&window.scheduler?window.scheduler.postTask(e,{priority:"user-visible"}):setTimeout(e,xc)}function $e(e){switch(r.syncInactiveView.style.display="none",r.syncEnterKeyView.style.display="none",r.syncDisplayKeyView.style.display="none",r.syncActiveView.style.display="none",r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),e){case"inactive":r.syncInactiveView.style.display="flex";break;case"enterKey":r.syncEnterKeyView.style.display="flex";break;case"displayKey":r.syncDisplayKeyView.style.display="flex";let t=r.syncDisplayKeyView.dataset.context;r.keySavedBtn.textContent=t==="view"?u("closeButton"):u("syncKeySaved");break;case"active":r.syncActiveView.style.display="flex";break}}function Ao(e,t){for(let a=0;a<e.length;a++)e[a].disabled=t}async function Ho(e){let t=[r.submitKeyBtn,r.cancelEnterKeyBtn];Ao(t,!0),r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden");let a=r.submitKeyBtn.textContent;r.submitKeyBtn.textContent=u("syncVerifying");let n=Ae();try{Lt(),Qt(e);let i=await Ni();if(i&&i.habits&&i.habits.length>0){W("Dados encontrados na nuvem. Mesclando...","info","\u{1F9EC}");let o=ce(),c=await Et(o,i);await Ce(c),ut(),at(),s.uiDirtyState.habitListStructure=s.uiDirtyState.calendarVisuals=s.uiDirtyState.chartData=!0,await ee(!0),$(),Y("syncSynced"),be(c,!0)}else W("Cofre nuvem vazio. Inicializando com dados locais.","info","\u2B06\uFE0F"),Y("syncSynced"),be(ce(),!0);rn()}catch(i){if(n?Qt(n):vt(),r.syncErrorMsg){let o=i.message||"Erro desconhecido";(o.includes("401")||o.includes("Auth"))&&(o="Chave Inv\xE1lida ou N\xE3o Encontrada"),r.syncErrorMsg.textContent=o,r.syncErrorMsg.classList.remove("hidden")}Y("syncError"),W(`Falha na ativa\xE7\xE3o: ${i.message}`,"error","\u274C")}finally{r.submitKeyBtn.textContent=a,Ao(t,!1)}}var Dc=()=>{try{r.enableSyncBtn.disabled=!0,r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden");let e=je();Lt(),Qt(e),Y("syncSynced"),r.syncKeyText.textContent=e,r.syncDisplayKeyView.dataset.context="setup",$e("displayKey"),be(ce(),!0),setTimeout(()=>r.enableSyncBtn.disabled=!1,500)}catch(e){r.enableSyncBtn.disabled=!1,r.syncErrorMsg&&(r.syncErrorMsg.textContent=e.message||"Erro ao gerar chave",r.syncErrorMsg.classList.remove("hidden"))}},Mc=()=>{$e("enterKey"),setTimeout(()=>r.syncKeyInput.focus(),100)},Cc=()=>{r.syncKeyInput.value="",r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),rn()},Ac=()=>{let e=r.syncKeyInput.value.trim();e&&(r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),Ii(e)?Ho(e):oe(u("confirmInvalidKeyBody"),()=>Ho(e),{title:u("confirmInvalidKeyTitle"),confirmText:u("confirmButton"),cancelText:u("cancelButton")}))},Hc=()=>$e("active"),Ic=()=>{let e=r.syncKeyText.textContent;e&&navigator.clipboard.writeText(e).then(()=>{let t=r.copyKeyBtn.innerHTML;r.copyKeyBtn.innerHTML="\u2713",setTimeout(()=>{r.copyKeyBtn.innerHTML=t},1500)}).catch(()=>alert("Copie manualmente: "+e))},kc=()=>{let e=Ae();e&&(r.syncKeyText.textContent=e,r.syncDisplayKeyView.dataset.context="view",$e("displayKey"))},Oc=()=>{oe(u("confirmSyncDisable"),()=>{vt(),Y("syncInitial"),$e("inactive")},{title:u("syncDisableTitle"),confirmText:u("syncDisableConfirm"),confirmButtonStyle:"danger"})},_c=e=>{vi()};function rn(){Fe()?($e("active"),s.syncState==="syncInitial"&&Y("syncSynced")):($e("inactive"),Y("syncInitial"))}function Io(){r.enableSyncBtn&&r.enableSyncBtn.addEventListener("click",Dc),r.enterKeyViewBtn&&r.enterKeyViewBtn.addEventListener("click",Mc),r.cancelEnterKeyBtn&&r.cancelEnterKeyBtn.addEventListener("click",Cc),r.submitKeyBtn&&r.submitKeyBtn.addEventListener("click",Ac),r.keySavedBtn&&r.keySavedBtn.addEventListener("click",Hc),r.copyKeyBtn&&r.copyKeyBtn.addEventListener("click",Ic),r.viewKeyBtn&&r.viewKeyBtn.addEventListener("click",kc),r.disableSyncBtn&&r.disableSyncBtn.addEventListener("click",Oc),r.syncStatus&&r.syncStatus.addEventListener("pointerdown",_c),rn()}async function sn(){if("setAppBadge"in navigator&&"clearAppBadge"in navigator)try{let{pending:e}=J(O()),t=navigator;e>0?await t.setAppBadge(e):await t.clearAppBadge()}catch(e){console.error("Failed to set app badge:",e)}}var la="askesis_boot_attempts",Rc=3;function Pc(){let e=parseInt(sessionStorage.getItem(la)||"0",10);return e>=Rc?(console.warn("\u{1F6A8} Detected boot loop. Initiating Auto-Healing..."),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(t=>{for(let a of t)a.unregister()}),"caches"in window&&caches.keys().then(t=>{for(let a of t)caches.delete(a)}),sessionStorage.removeItem(la),setTimeout(()=>window.location.reload(),500),!1):(sessionStorage.setItem(la,(e+1).toString()),!0)}var Mt=!1,cn=!1,Nc=()=>{if("serviceWorker"in navigator&&!window.location.protocol.startsWith("file")){let e=()=>navigator.serviceWorker.register("/sw.js").catch(console.warn);document.readyState==="complete"?e():window.addEventListener("load",e)}};async function Bc(){if(await Ce(),Fe()){document.body.classList.add("is-booting");let e=Bi(),t=new Promise(a=>setTimeout(()=>{s.initialSyncDone||(console.warn("Boot sync timeout. Unlocking UI."),s.initialSyncDone=!0,a())},5e3));Promise.race([e,t]).finally(()=>{document.body.classList.remove("is-booting")})}else s.initialSyncDone=!0}function Fc(){s.hasOnboarded||(s.hasOnboarded=!0,ee())}function zc(){Co(),Io(),document.addEventListener("habitsChanged",sn),ya(),document.addEventListener("dayChanged",to),Ci(be)}function Kc(e){if(sessionStorage.removeItem(la),e){e.classList.add("hidden");let a=()=>{e.remove(),document.getElementById("initial-loader-container")?.remove()},n=setTimeout(a,400);e.addEventListener("transitionend",()=>{clearTimeout(n),a()},{once:!0})}let t=()=>{Ui(),import("./analytics-5IQ5LGBN.js").then(({initAnalytics:a})=>a()).catch(()=>{})};window.scheduler?.postTask?window.scheduler.postTask(t,{priority:"background"}):(window.requestIdleCallback||(a=>setTimeout(a,1e3)))(t)}async function Uc(e){Mt||cn||(Mt=!0,window.bootWatchdog&&(clearTimeout(window.bootWatchdog),delete window.bootWatchdog),await ki(),await Promise.all([Ti(),Ka()]),await Bc(),zc(),Fc(),$(),sn(),Kc(e),cn=!0,Mt=!1)}var ko=()=>{if(!Pc()||(Nc(),Mt||cn))return;let e=document.getElementById("initial-loader");Uc(e).catch(t=>{console.error("Boot failed:",t),Mt=!1,window.showFatalError?window.showFatalError("Erro na inicializa\xE7\xE3o: "+(t.message||t)):e&&e.isConnected&&(e.innerHTML='<div style="color:#ff6b6b;padding:2rem;text-align:center;"><h3>Falha Cr\xEDtica</h3><button onclick="location.reload()">Tentar Novamente</button></div>')})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ko):ko();
/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/
/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */
