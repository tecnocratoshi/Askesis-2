import{b as da}from"./chunk-UDAXYSIS.js";var ne=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),dn=Array.from({length:100},(e,t)=>t<10?"0"+t:String(t));function Xe(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}let e=new Uint8Array(16);try{if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(e);else throw 0}catch{let a=Date.now(),n=typeof performance<"u"&&performance.now?performance.now()*1e3:0;for(let i=0;i<16;i++){let o=Math.random()*256,l=a>>i*2&255,c=n>>i*2&255;e[i]=(o^l^c)&255}}return e[6]=e[6]&15|64,e[8]=e[8]&63|128,ne[e[0]]+ne[e[1]]+ne[e[2]]+ne[e[3]]+"-"+ne[e[4]]+ne[e[5]]+"-"+ne[e[6]]+ne[e[7]]+"-"+ne[e[8]]+ne[e[9]]+"-"+ne[e[10]]+ne[e[11]]+ne[e[12]]+ne[e[13]]+ne[e[14]]+ne[e[15]]}function K(e){if(isNaN(e.getTime()))throw new Error("CRITICAL: toUTCIsoDateString received Invalid Date.");let t=e.getUTCFullYear(),a=e.getUTCMonth()+1,n=e.getUTCDate();return t+"-"+dn[a]+"-"+dn[n]}function Bo(){let e=new Date;return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}var Ct=null,ma=0;function I(){let e=Date.now();return(!Ct||e-ma>6e4)&&(Ct=K(Bo()),ma=e),Ct}function fa(){Ct=null,ma=0}var Mt;function ga(){Mt&&(clearTimeout(Mt),Mt=void 0);let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1,0,0,0,0),a=Math.max(1e3,t.getTime()-e.getTime());Mt=window.setTimeout(()=>{fa(),document.dispatchEvent(new CustomEvent("dayChanged")),ga()},a+1e3)}function k(e){if(!e||typeof e!="string")return new Date(NaN);let t=new Date(`${e}T00:00:00.000Z`);if(isNaN(t.getTime()))return t;if(e.length===10){let a=t.getUTCFullYear(),n=t.getUTCMonth()+1,i=t.getUTCDate();if(a!==parseInt(e.substring(0,4))||n!==parseInt(e.substring(5,7))||i!==parseInt(e.substring(8,10)))return new Date(NaN)}return t}function se(e,t){let a=new Date(e);return a.setUTCDate(a.getUTCDate()+t),a}var Fo=/^\d{4}-\d{2}-\d{2}$/;function Ie(e){return!e||!Fo.test(e)?I():e}var zo=/[&<>"']/g,Ko={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Uo=e=>Ko[e];function ha(e){return e?e.replace(zo,Uo):""}var qo=/(\*\*\*(.*?)\*\*\*)|(\*\*(.*?)\*\*)|(\*(.*?)\*)|(~~(.*?)~~)/g,un=/^\d+\.\s/,Go=(e,t,a,n,i,o,l,c,d)=>t?`<strong><em>${a}</em></strong>`:n?`<strong>${i}</strong>`:o?`<em>${l}</em>`:c?`<del>${d}</del>`:e;function We(e){return ha(e).replace(qo,Go)}var Vo=/^### /,$o=/^## /,Wo=/^# /,Yo=/^[*+-\s] /;function ya(e){if(!e)return"";let t=[],a=!1,n=!1,i=()=>{a&&(t.push("</ul>"),a=!1),n&&(t.push("</ol>"),n=!1)},o=0,l=0,c=e.length;for(;o<c;){l=e.indexOf(`
`,o),l===-1&&(l=c);let d=e.substring(o,l),p=d.trim();Vo.test(p)?(i(),t.push(`<h3>${We(d.substring(4))}</h3>`)):$o.test(p)?(i(),t.push(`<h2>${We(d.substring(3))}</h2>`)):Wo.test(p)?(i(),t.push(`<h1>${We(d.substring(2))}</h1>`)):Yo.test(p)?(n&&(t.push("</ol>"),n=!1),a||(t.push("<ul>"),a=!0),t.push(`<li>${We(d.trim().substring(2))}</li>`)):p.match(un)?(a&&(t.push("</ul>"),a=!1),n||(t.push("<ol>"),n=!0),t.push(`<li>${We(d.replace(un,""))}</li>`)):(i(),p.length>0&&t.push(`<p>${We(d)}</p>`)),o=l+1}return i(),t.join("")}function Se(e){typeof window>"u"||(typeof window.OneSignal>"u"?(window.OneSignalDeferred=window.OneSignalDeferred||[],window.OneSignalDeferred.push(e)):e(window.OneSignal))}var Xo={selection:8,light:12,medium:20,heavy:40,success:[15,50,15],error:[40,60,15]};function M(e){if(typeof navigator<"u"&&navigator.vibrate)try{navigator.vibrate(Xo[e])}catch{}}var Ye=null,At=null;function jo(){if(!(Ye&&At))try{let e=getComputedStyle(document.documentElement);Ye=e.getPropertyValue("--text-primary").trim()||"#e5e5e5",At=e.getPropertyValue("--bg-color").trim()||"#000000"}catch{Ye="#e5e5e5",At="#000000"}}function ua(e,t){let a=0;for(let n=0;n<2;n++){let i=e.charCodeAt(t+n);a<<=4,i>=48&&i<=57?a|=i-48:i>=65&&i<=70?a|=i-55:i>=97&&i<=102&&(a|=i-87)}return a}var pa=new Map;function dt(e){let t=pa.get(e);if(t)return t;if(jo(),!e||e.length<4)return Ye;try{let a=e;if(e.length===4&&e.charCodeAt(0)===35){let p=e[1],f=e[2],b=e[3];a=`#${p}${p}${f}${f}${b}${b}`}let n=a.charCodeAt(0)===35?1:0,i=ua(a,n),o=ua(a,n+2),l=ua(a,n+4),d=i*299+o*587+l*114>=128e3?At:Ye;return pa.size<100&&pa.set(e,d),d}catch{return Ye}}var ba=9,ut=21,Ke=66,A={NULL:0,DONE:1,DEFERRED:2,DONE_PLUS:3},va={Morning:0,Afternoon:3,Evening:6},pn=[{labelKey:"freqDaily",value:{type:"daily"}},{labelKey:"freqSpecificDaysOfWeek",value:{type:"specific_days_of_week",days:[]}},{labelKey:"freqEvery",value:{type:"interval",unit:"days",amount:2}}],mn=730,je=["Morning","Afternoon","Evening"],pe=[{code:"pt",nameKey:"langPortuguese"},{code:"en",nameKey:"langEnglish"},{code:"es",nameKey:"langSpanish"}],s={habits:[],lastModified:0,dailyData:{},archives:{},dailyDiagnoses:{},unarchivedCache:new Map,streaksCache:new Map,habitAppearanceCache:new Map,scheduleCache:new Map,activeHabitsCache:new Map,daySummaryCache:new Map,selectedDate:I(),activeLanguageCode:"pt",pending21DayHabitIds:[],pendingConsolidationHabitIds:[],notificationsShown:[],hasOnboarded:!1,syncLogs:[],aiState:"idle",aiReqId:0,hasSeenAIResult:!0,lastAIResult:null,syncState:"syncInitial",initialSyncDone:!1,fullCalendar:{year:new Date().getUTCFullYear(),month:new Date().getUTCMonth()},uiDirtyState:{calendarVisuals:!0,habitListStructure:!0,chartData:!0},monthlyLogs:new Map,confirmAction:null,confirmEditAction:null,editingNoteFor:null,calendarDates:[]};function le(){return{version:ba,lastModified:s.lastModified,habits:s.habits,dailyData:s.dailyData,archives:s.archives,dailyDiagnoses:s.dailyDiagnoses,notificationsShown:s.notificationsShown,pending21DayHabitIds:s.pending21DayHabitIds,pendingConsolidationHabitIds:s.pendingConsolidationHabitIds,quoteState:s.quoteState,hasOnboarded:s.hasOnboarded,syncLogs:s.syncLogs,monthlyLogs:s.monthlyLogs}}function pt(){s.activeHabitsCache.clear()}function ce(e){return s.dailyData[e]||(s.dailyData[e]={}),s.dailyData[e]}function Qe(e,t){let a=ce(e);return a[t]||(a[t]={instances:{},dailySchedule:void 0}),a[t]}function Ea(e,t,a){let n=Qe(e,t);return n.instances[a]||(n.instances[a]={}),n.instances[a]}function fn(){s.scheduleCache.clear()}function xa(e,t){s.daySummaryCache.delete(e),s.streaksCache.forEach(a=>a.delete(e)),s.habitAppearanceCache.forEach(a=>a.delete(e)),s.scheduleCache.forEach(a=>a.delete(e))}function gn(){return s.uiDirtyState.chartData}function hn(){s.uiDirtyState.chartData=!0}function Qo(e){let t=new Map;for(let[a,n]of e.entries()){let i=0n;for(let o=1;o<=31;o++){let l=BigInt((o-1)*6),c=BigInt((o-1)*9);for(let d=0;d<3;d++){let p=l+BigInt(d*2),f=n>>p&3n,b=c+BigInt(d*3);i|=f<<b}}t.set(a,i)}return t}function yn(e,t){if(!e)return{version:t,habits:[],dailyData:{},archives:{},dailyDiagnoses:{},lastModified:Date.now(),notificationsShown:[],pending21DayHabitIds:[],pendingConsolidationHabitIds:[],hasOnboarded:!0,syncLogs:[],monthlyLogs:new Map};let a=e,n=a.version||0;if(a.monthlyLogs&&!(a.monthlyLogs instanceof Map))try{let i=Array.isArray(a.monthlyLogs)?a.monthlyLogs:Object.entries(a.monthlyLogs);a.monthlyLogs=new Map(i.map(([o,l])=>{let c=l;return l&&typeof l=="object"&&l.__type==="bigint"?c=BigInt(l.val):typeof l!="bigint"&&(c=BigInt(l)),[o,c]}))}catch(i){console.warn("[Migration] Failed to hydrate monthlyLogs",i),a.monthlyLogs=new Map}else a.monthlyLogs||(a.monthlyLogs=new Map);if(n<9&&a.monthlyLogs.size>0){console.info(`[Migration] Upgrading bitmasks from v${n} to v9...`);try{a.monthlyLogs=Qo(a.monthlyLogs),console.info("[Migration] Bitmask expansion successful.")}catch(i){console.error("[Migration] Bitmask expansion failed!",i)}}return a.hasOnboarded===void 0&&(a.hasOnboarded=!0),a.syncLogs||(a.syncLogs=[]),a.version=t,a}var h={},Z={};function Zo(e,t=!1){let n=e.charCodeAt(0)===35&&!/[\s.\[]/.test(e)?document.getElementById(e.slice(1)):document.querySelector(e);if(!n&&!t)throw new Error(`UI element "${e}" not found.`);return n}function m(e,t,a,n,i=!1){Object.defineProperty(e,t,{get:function(){if(n[t]===void 0){let o=Zo(a,i);return o&&(n[t]=o),o}return n[t]},enumerable:!0,configurable:!1})}var r={};m(r,"appContainer",".app-container",h);m(r,"calendarStrip","#calendar-strip",h);m(r,"headerTitle","#header-title",h);m(r,"headerTitleDesktop","#header-title .header-title-desktop",h);m(r,"headerTitleMobile","#header-title .header-title-mobile",h);m(r,"navArrowPast","#nav-arrow-past",h);m(r,"navArrowFuture","#nav-arrow-future",h);m(r,"stoicQuoteDisplay","#stoic-quote-display",h);m(r,"habitContainer","#habit-container",h);m(r,"chartContainer","#chart-container",h);m(r,"manageHabitsBtn","#manage-habits-btn",h);m(r,"fabAddHabit","#fab-add-habit",h);m(r,"manageModal","#manage-modal",h);m(r,"manageModalTitle","#manage-modal-title",h);m(r,"habitListTitle","#habit-list-title",h);m(r,"exploreModal","#explore-modal",h);m(r,"exploreHabitList","#explore-habit-list",h);m(r,"createCustomHabitBtn","#create-custom-habit-btn",h);m(r,"aiEvalBtn","#ai-eval-btn",h);m(r,"aiModal","#ai-modal",h);m(r,"aiOptionsModal","#ai-options-modal",h);m(r,"confirmModal","#confirm-modal",h);m(r,"habitList","#habit-list",h);m(r,"noHabitsMessage","#no-habits-message",h);m(r,"aiResponse","#ai-response",h);m(r,"confirmModalText","#confirm-modal-text",h);m(r,"confirmModalConfirmBtn","#confirm-modal-confirm-btn",h);m(r,"confirmModalEditBtn","#confirm-modal-edit-btn",h);m(r,"notesModal","#notes-modal",h);m(r,"notesModalTitle","#notes-modal-title",h);m(r,"notesModalSubtitle","#notes-modal-subtitle",h);m(r,"notesTextarea","#notes-textarea",h);m(r,"saveNoteBtn","#save-note-btn",h);m(r,"resetAppBtn","#reset-app-btn",h);m(r,"languagePrevBtn","#language-prev",h);m(r,"languageViewport","#language-viewport",h);m(r,"languageReel","#language-reel",h);m(r,"languageNextBtn","#language-next",h);m(r,"editHabitModal","#edit-habit-modal",h);m(r,"editHabitModalTitle","#edit-habit-modal-title",h);m(r,"editHabitForm","#edit-habit-form",h);m(r,"habitSubtitleDisplay","#habit-subtitle-display",h);m(r,"editHabitSaveBtn","#edit-habit-save-btn",h);m(r,"habitTimeContainer","#habit-time-container",h);m(r,"frequencyOptionsContainer","#frequency-options-container",h);m(r,"syncStatus","#sync-status",h);m(r,"syncSection","#sync-section",h);m(r,"syncInactiveView","#sync-inactive-view",h);m(r,"enableSyncBtn","#enable-sync-btn",h);m(r,"enterKeyViewBtn","#enter-key-view-btn",h);m(r,"syncEnterKeyView","#sync-enter-key-view",h);m(r,"syncKeyInput","#sync-key-input",h);m(r,"cancelEnterKeyBtn","#cancel-enter-key-btn",h);m(r,"submitKeyBtn","#submit-key-btn",h);m(r,"syncDisplayKeyView","#sync-display-key-view",h);m(r,"syncKeyText","#sync-key-text",h);m(r,"copyKeyBtn","#copy-key-btn",h);m(r,"keySavedBtn","#key-saved-btn",h);m(r,"syncActiveView","#sync-active-view",h);m(r,"viewKeyBtn","#view-key-btn",h);m(r,"disableSyncBtn","#disable-sync-btn",h);m(r,"notificationToggle","#notification-toggle",h);m(r,"notificationToggleLabel","#notification-toggle-label",h);m(r,"notificationStatusDesc","#notification-status-desc",h);m(r,"iconPickerModal","#icon-picker-modal",h);m(r,"iconPickerGrid","#icon-picker-grid",h);m(r,"habitIconPickerBtn","#habit-icon-picker-btn",h);m(r,"colorPickerModal","#color-picker-modal",h);m(r,"colorPickerGrid","#color-picker-grid",h);m(r,"changeColorFromPickerBtn","#change-color-from-picker-btn",h);m(r,"fullCalendarModal","#full-calendar-modal",h);m(r,"fullCalendarHeader","#full-calendar-header",h);m(r,"fullCalendarMonthYear","#full-calendar-month-year",h);m(r,"fullCalendarPrevBtn","#full-calendar-prev",h);m(r,"fullCalendarNextBtn","#full-calendar-next",h);m(r,"fullCalendarWeekdays","#full-calendar-weekdays",h);m(r,"fullCalendarGrid","#full-calendar-grid",h);m(r,"calendarQuickActions","#calendar-quick-actions",h);m(r,"quickActionDone","#quick-action-done",h);m(r,"quickActionSnooze","#quick-action-snooze",h);m(r,"quickActionAlmanac","#quick-action-almanac",h);m(r,"labelLanguage","#label-language",h);m(r,"labelSync","#label-sync",h);m(r,"labelNotifications","#label-notifications",h);m(r,"labelReset","#label-reset",h);m(r,"labelPrivacy","#label-privacy",h);m(r,"exportDataBtn","#export-data-btn",h);m(r,"importDataBtn","#import-data-btn",h);m(r,"syncInactiveDesc","#sync-inactive-desc",h);m(r,"labelEnterKey","#label-enter-key",h);m(r,"syncWarningText","#sync-warning-text",h);m(r,"syncActiveDesc","#sync-active-desc",h);m(r,"iconPickerTitle","#icon-picker-modal-title",h);m(r,"colorPickerTitle","#color-picker-modal-title",h);m(r,"habitConscienceDisplay","#habit-conscience-display",h,!0);m(r,"syncErrorMsg","#sync-error-msg",h);r.chart={};m(r.chart,"title","#chart-container .chart-title",Z);m(r.chart,"subtitle","#chart-container .app-subtitle",Z);m(r.chart,"emptyState","#chart-container .chart-empty-state",Z);m(r.chart,"dataView","#chart-container .chart-data-view",Z);m(r.chart,"wrapper","#chart-container .chart-wrapper",Z);m(r.chart,"svg",".chart-svg",Z);m(r.chart,"areaPath",".chart-area",Z);m(r.chart,"linePath",".chart-line",Z);m(r.chart,"tooltip","#chart-container .chart-tooltip",Z);m(r.chart,"tooltipDate","#chart-container .tooltip-date",Z);m(r.chart,"tooltipScoreLabel","#chart-container .tooltip-score-label",Z);m(r.chart,"tooltipScoreValue","#chart-container .tooltip-score-value",Z);m(r.chart,"tooltipHabits","#chart-container .tooltip-habits li",Z);m(r.chart,"indicator","#chart-container .chart-indicator",Z);m(r.chart,"evolutionIndicator","#chart-container .chart-evolution-indicator",Z);m(r.chart,"axisStart","#chart-container .chart-axis-labels span:first-child",Z);m(r.chart,"axisEnd","#chart-container .chart-axis-labels span:last-child",Z);var Ze={},Ht={},bn=new Map,It=new Map,Jo=100,kt={},mt={},ft={},Le={},Ot=new Map,er={weekday:"short",timeZone:"UTC"},tr=Array.from({length:7},(e,t)=>new Date(Date.UTC(1970,0,4+t)));var ar={Morning:"filterMorning",Afternoon:"filterAfternoon",Evening:"filterEvening"},_t=null,gt=null,En=null,Ta=null,Sa=null,xn=null,Tn=[],me=null,vn=0,nr=/{([^{}]+)}/g,ir=5e3;function La(e){if(Le[e])return Promise.resolve(!0);if(Ot.has(e))return Ot.get(e);let t=(async()=>{let a=new AbortController,n=setTimeout(()=>a.abort(),ir);try{let i=await fetch(`./locales/${e}.json`,{signal:a.signal});if(clearTimeout(n),!i.ok)throw new Error(`Status: ${i.status}`);let o=await i.json();return Le[e]=o,!0}catch(i){if(clearTimeout(n),console.error(`Could not load translations for ${e}:`,i),e!=="pt"&&!Le.pt)try{console.warn("Attempting to load fallback 'pt'"),await La("pt")}catch(o){console.error("CRITICAL: Could not load fallback language 'pt'.",o)}return!1}finally{Ot.delete(e)}})();return Ot.set(e,t),t}function or(e){La(e).then(t=>{t&&s.activeLanguageCode===e&&(we(e),document.dispatchEvent(new CustomEvent("language-changed")))})}function we(e){if(me=e,Le[e]?(_t=Le[e],e!=="pt"&&Le.pt?gt=Le.pt:gt=null):(_t=Le.pt||null,gt=null,or(e)),!Ze[e])try{Ze[e]=new Intl.PluralRules(e)}catch{try{Ze[e]=new Intl.PluralRules("pt")}catch{Ze[e]={select:()=>"other"}}}if(En=Ze[e],!Ht[e])try{Ht[e]=new Intl.Collator(e,{sensitivity:"base",numeric:!0})}catch{Ht[e]=new Intl.Collator("pt")}if(Ta=Ht[e],!kt[e])try{kt[e]=new Intl.ListFormat(e,{style:"long",type:"conjunction"})}catch{kt[e]={format:a=>Array.from(a).join(", ")}}if(Sa=kt[e],!mt[e])try{mt[e]={int:new Intl.NumberFormat(e,{maximumFractionDigits:0}),dec:new Intl.NumberFormat(e,{minimumFractionDigits:2,maximumFractionDigits:2}),evo:new Intl.NumberFormat(e,{minimumFractionDigits:1,maximumFractionDigits:1})}}catch{let a={maximumFractionDigits:0},n={minimumFractionDigits:2,maximumFractionDigits:2},i={minimumFractionDigits:1,maximumFractionDigits:1};try{mt[e]={int:new Intl.NumberFormat("pt",a),dec:new Intl.NumberFormat("pt",n),evo:new Intl.NumberFormat("pt",i)}}catch{mt[e]={int:new Intl.NumberFormat(void 0,a),dec:new Intl.NumberFormat(void 0,n),evo:new Intl.NumberFormat(void 0,i)}}}if(xn=mt[e],!ft[e])try{let t=new Intl.DateTimeFormat(e,er);ft[e]=tr.map(a=>t.format(a).toUpperCase())}catch{ft[e]=ft.pt||[]}Tn=ft[e]}function u(e,t){if(s.activeLanguageCode!==me&&we(s.activeLanguageCode),!_t)return e;let a=_t[e];if(a===void 0&&gt&&(a=gt[e]),a===void 0)return e;let n;if(typeof a=="string")n=a;else if(t?.count!==void 0){let o=(En||Ze.pt||new Intl.PluralRules("en")).select(t.count),l=a[o]||a.other;if(!l)return e;n=l}else return e;return t&&n.includes("{")?n.replace(nr,(i,o)=>{let l=t[o];return l!==void 0?String(l):i}):n}function Sn(e,t){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),Ta?Ta.compare(e,t):e.localeCompare(t)}function ue(e,t){if(e==null)return"---";let a;if(typeof e=="number"?a=new Date(e):e instanceof Date?a=e:a=new Date(e),isNaN(a.getTime()))return"---";s.activeLanguageCode!==me&&we(s.activeLanguageCode);let n=bn.get(me);n||(n=new WeakMap,bn.set(me,n));let i=n.get(t);if(i)return i.format(a);let o=Object.keys(t).sort(),l="";for(let d of o)l+=`${d}:${t[d]};`;let c=`${me}|${l}`;return i=It.get(c),i||(It.size>Jo&&It.clear(),i=new Intl.DateTimeFormat(me,t),It.set(c,i)),n.set(t,i),i.format(a)}function wa(e,t){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),xn[t].format(e)}var ke=e=>wa(e,"int"),Ln=e=>wa(e,"dec"),wn=e=>wa(e,"evo");function Dn(e){return e.length===0?"":(s.activeLanguageCode!==me&&we(s.activeLanguageCode),Sa?Sa.format(e):e.join(", "))}function Ue(e){return u(ar[e]||`filter${e}`)}function Mn(e){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),Tn[e.getUTCDay()]||""}function Rt(){return s.activeLanguageCode!==me&&we(s.activeLanguageCode),u(pe.find(e=>e.code===s.activeLanguageCode)?.nameKey||"langEnglish")}async function Pt(e){if(s.activeLanguageCode===e&&Le[e])return;let t=++vn,a=await La(e);t===vn&&(a?(s.activeLanguageCode=e,we(e),document.documentElement.lang=e,localStorage.setItem("habitTrackerLanguage",e),Se(n=>{n.User.setLanguage(e)}),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,s.uiDirtyState.chartData=!0,document.dispatchEvent(new CustomEvent("language-changed"))):console.warn(`setLanguage aborted: Failed to load ${e}`))}var T='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">',w='<path d="',D='"/></svg>',Cn="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7m.5-8.5a2.1 2.1 0 013 3L12 15l-4 1 1-4 9.5-9.5z",Da="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8zv6h6",An="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2",rr="M12 2a10 10 0 100 20 10 10 0 000-20",In="M12 7a5 5 0 100 10 5 5 0 000-10m0-6v2m0 18v2M4.2 4.2l1.4 1.4m12.8 12.8 1.4 1.4M1 12h2m18 0h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4",kn="M21 12.8A9 9 0 1111.2 3 7 7 0 0021 12.8z",Hn="M12 22a7 7 0 007-7c0-2.3-1.3-4.9-3.4-7.4C13.8 5.1 12 2.8 12 2.8s-1.8 2.3-3.6 4.8C6.3 10.1 5 12.7 5 15a7 7 0 007 7z",C={read:T+w+"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2zM22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"+D,meditate:T+w+"M8.2 16.2c-1.3-1.3-2.2-3-2.2-4.9C6 9.4 7.1 7.8 8.8 6.8M15.8 16.2c1.3-1.3 2.2-3 2.2-4.9 0-1.9-1.1-3.5-2.8-4.5M12 13a3 3 0 100-6 3 3 0 000 6zM12 21a9 9 0 009-9M3 12a9 9 0 019-9"+D,water:T+w+Hn+D,exercise:T+w+"M22 12h-4l-3 9L9 3l-3 9H2"+D,stretch:T+w+"M12 4a1 1 0 100 2 1 1 0 000-2M9 20l3-6 3 6M6 12l6-2 6 2"+D,journal:T+w+Da+"M16 13H8M16 17H8"+D,language:T+w+"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"+D,organize:T+w+"M21 16V8a2 2 0 00-1-1.7l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.7l7 4a2 2 0 002 0l7-4A2 2 0 0021 16zM3.3 7 12 12 20.7 7M12 22.1V12"+D,walk:T+w+"M14.9 14.3c.3-.5.3-1.1 0-1.6l-4-6c-.6-1-1.8-1.2-2.8-.6-.9.6-1.2 1.8-.6 2.8l4 6c.6 1 1.8 1.2 2.8.6.2-.1.3-.3.4-.4zM12 12l-2-2M10.1 18.7c.3-.5.3-1.1 0-1.6l-4-6c-.6-1-1.8-1.2-2.8-.6-.9.6-1.2 1.8-.6 2.8l4 6c.6 1 1.8 1.2 2.8.6.2-.1.3-.3.4-.4zz"+D,planDay:T+w+"M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20m-3.54 3.54L12 12l3.54-3.54M12 12l-3.54 3.54L12 12z"+D,creativeHobby:T+w+"M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"+D,gratitude:T+w+"M20.8 4.6a5.5 5.5 0 00-7.8 0L12 5.7l-1.1-1.1a5.5 5.5 0 00-7.8 7.8l1.1 1.1L12 21.2l7.8-7.8 1.1-1.1a5.5 5.5 0 000-7.8z"+D,talkFriend:T+w+"M21 11.5a8.4 8.4 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.4 8.4 0 01-3.8-.9L3 21l1.9-5.7a8.4 8.4 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.4 8.4 0 013.8-.9h.5a8.5 8.5 0 018 8v.5z"+D,instrument:T+w+"M9 18V5l12-2v13M6 21a3 3 0 100-6 3 3 0 000 6M18 19a3 3 0 100-6 3 3 0 000 6"+D,plants:T+w+"M7 20h10M12 4v16M10 4c-2.5 1.5-4 4-4 7M14 4c2.5 1.5 4 4 4 7"+D,finances:T+w+"M18 20V10M12 20V4M6 20V14"+D,tea:T+w+"M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zm4-6v2m4-2v2m4-2v2m4-2v2m4-2v2"+D,podcast:T+w+"M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zM19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"+D,emails:T+w+"M22 12h-6l-2 3h-4l-2-3H2M5.5 5.1L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.5-6.9A2 2 0 0016.8 4H7.2a2 2 0 00-1.8 1.1z"+D,skincare:T+w+"M17.66 7.34C16.5 5.88 14.37 5 12 5s-4.5.88-5.66 2.34A8 8 0 004 12c0 4.42 3.58 8 8 8s8-3.58 8-8a8 8 0 00-2.34-4.66z"+D,sunlight:T+w+In+D,draw:T+w+"M12 19l7-7 3 3-7 7-3-3zM18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5zM2 2l7.6 7.6M11 13a2 2 0 100-4 2 2 0 000 4"+D,familyTime:T+w+"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8M23 21v-2a4 4 0 00-3-3.9M16 3.1a4 4 0 010 7.8"+D,news:T+w+"M4 22h16a2 2 0 002-2V4a2 2 0 00-2-2H8a2 2 0 00-2 2v16a2 2 0 01-2 2Zm0 0a2 2 0 01-2-2v-9c0-1.1.9-2 2-2h2M18 14h-8M15 18h-5M10 6h8v4h-8V6Z"+D,cookHealthy:T+w+"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2M7 2v20M21 15V2v0a5 5 0 00-5 5v6c0 1.1.9 2 2 2h3"+D,learnSkill:T+w+"M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.8-3.8a6 6 0 01-7.9 7.9l-6.9 6.9a2.1 2.1 0 01-3-3l6.9-6.9a6 6 0 017.9-7.9l-3.8 3.8z"+D,photography:T+w+"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2zM12 17a4 4 0 100-8 4 4 0 000 8"+D,yoga:T+w+"M12 6a2 2 0 100-4 2 2 0 000 4M15 22v-4a2 2 0 00-2-2h-2a2 2 0 00-2 2v4M9 13l-2-2M15 13l2-2"+D,reflectDay:T+w+kn+D,custom:T+w+"M12 2 15.1 8.3 22 9.3 17 14.1 18.2 21 12 17.8 5.8 21 7 14.1 2 9.3 8.9 8.3 12 2z"+D,stoicism:T+w+"M4 22h16M7 21V10M17 21V10M12 21V10M4 10h16M4 7h16M4 4h16"+D,wind:T+w+"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"+D,sustenance:T+w+Hn+D,snowflake:T+w+"M2 12h20M12 2v20M20 20L4 4m16 0L4 20M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41M12 2.2V4.5M12 19.5v2.3M2.2 12h2.3M19.5 12h2.3"+D,dignity:T+w+"M12 2L2 7l10 15 10-15L12 2z"+D,sunMoon:T+w+"M20 15.31L23.31 12 20 8.69V4h-4.69L12 0.69 8.69 4H4v4.69L0.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z M12 6v12c3.31 0 6-2.69 6-6s-2.69-6-6-6z"+D,presence:T+w+"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"+D,abstention:T+w+"M7 11v-1a5 5 0 1110 0v1h2v11H5V11h2zm2 0h6v-1a3 3 0 10-6 0v1z"+D,movement:T+w+"M13 6v12l8.5-6L13 6z M4 6v12l8.5-6L4 6z"+D,discernment:T+w+"M12 21v-6M12 15l-6-6M12 15l6-6M6 9l-3-3M6 9l3-3M18 9l-3-3M18 9l3-3"+D,zeal:T+w+"M12 2a10 10 0 100 20 10 10 0 000-20zM2 12h20M12 2c2 3.33 2 14.67 0 18-2-3.33-2-14.67 0-18z"+D,anticipation:T+w+"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"+D},z={settings:T+w+"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"+D,ai:T+w+"M12 8V4H8M6 8h12a2 2 0 012 2v8a2 2 0 01-2 2H6a2 2 0 01-2-2v-8a2 2 0 012-2M2 14h2M20 14h2M15 13v2M9 13v2"+D,check:T+w+"M20 6L9 17l-5-5"+D,snoozed:T+w+"M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20zM12 6v6l4 2"+D,swipeDelete:T+w+An+D,swipeNote:T+w+Da+D,swipeNoteHasNote:T+'<path fill="currentColor" d="'+Da+'"/></svg>',editAction:T+w+Cn+D,graduateAction:T+w+"M22 10v6M2 10l10-5 10 5-10 5zM6 12v5c3 3 9 3 12 0v-5"+D,endAction:T+w+rr+"M15 9l-6 6M9 9l6 6"+D,deletePermanentAction:T+w+An+D,edit:T+w+Cn+D,colorPicker:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path fill="#e74c3c" d="M12 12 L12 2 A10 10 0 0 1 22 12 Z"/><path fill="#f1c40f" d="M12 12 L2 12 A10 10 0 0 1 12 2 Z"/><path fill="#2ecc71" d="M12 12 L12 22 A10 10 0 0 1 2 12 Z"/><path fill="#3498db" d="M12 12 L22 12 A10 10 0 0 1 12 22 Z"/></svg>',morning:T+w+"M12 9V7M4.2 10.2l1.4 1.4M19.8 10.2l-1.4 1.4M1 18h2m18 0h2M17 18a5 5 0 00-10 0M2 22h20"+D,afternoon:T+w+In+D,evening:T+w+kn+D,calendar:T+w+"M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zM16 2v4M8 2v4M3 10h18"+D,backArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>'};var sr={Morning:z.morning,Afternoon:z.afternoon,Evening:z.evening};function qe(e){return sr[e]??z.morning}var R=class{static getLogKey(t,a){return`${t}_${a.substring(0,7)}`}static isValidLog(t){return typeof t=="bigint"}static getStatus(t,a,n){let i=this.getLogKey(t,a),o=s.monthlyLogs?.get(i);if(o!==void 0){let l=parseInt(a.substring(8,10),10),c=BigInt((l-1)*9+va[n]),d=o>>c&7n;return d>>2n&1n?0:Number(d&3n)}return 0}static setStatus(t,a,n,i){s.monthlyLogs||(s.monthlyLogs=new Map);let o=this.getLogKey(t,a),l=parseInt(a.substring(8,10),10),c=BigInt((l-1)*9+va[n]),d=~(7n<<c),p=s.monthlyLogs.get(o)||0n,f=0n;i===0?f=4n:f=BigInt(i);let b=p&d|f<<c;s.monthlyLogs.set(o,b),s.uiDirtyState.chartData=!0}static pruneLogsForHabit(t){if(s.monthlyLogs){for(let a of s.monthlyLogs.keys())a.startsWith(t+"_")&&s.monthlyLogs.delete(a);s.uiDirtyState.chartData=!0}}static getLogsGroupedByMonth(){let t={};if(!s.monthlyLogs)return t;for(let[a,n]of s.monthlyLogs.entries()){let i=a.split("_").pop()||"unknown";t[i]||(t[i]=[]),t[i].push([a,"0x"+n.toString(16)])}return t}static serializeLogsForCloud(){return s.monthlyLogs?Array.from(s.monthlyLogs.entries()).map(([t,a])=>[t,"0x"+a.toString(16)]):[]}static deserializeLogsFromCloud(t){Array.isArray(t)&&t.forEach(([a,n])=>{try{let i=n.startsWith("0x")?n:"0x"+n;s.monthlyLogs.set(a,BigInt(i))}catch{console.warn(`[HabitService] Skipping invalid hex log: ${a}`)}})}static mergeLogs(t,a){let n=new Map(t||[]);if(!a)return n;for(let[i,o]of a.entries()){let l=n.get(i)||0n,c=0n;for(let d=0n;d<93n;d++){let p=d*3n,f=l>>p&7n,b=o>>p&7n,E=0n,S=(f&4n)===4n,L=(b&4n)===4n;S||L?E=4n:E=f|b,c|=E<<p}n.set(i,c)}return n}static clearAllLogs(){s.monthlyLogs=new Map,s.uiDirtyState.chartData=!0}};var ht=new Map,lr=365,yt=750;function cr(e){let t=ht.get(e);return t||(ht.size>lr&&ht.clear(),t=k(e),ht.set(e,t)),t}var On=()=>ht.clear();function Oe(e,t){let a=s.scheduleCache.get(e.id);if(!a)a=new Map,s.scheduleCache.set(e.id,a);else{let o=a.get(t);if(o!==void 0)return o}let n=e.scheduleHistory;if(!n||!Array.isArray(n)||n.length===0)return a.set(t,null),null;let i=null;for(let o=n.length-1;o>=0;o--){let l=n[o];if(t>=l.startDate){(!l.endDate||t<l.endDate)&&(i=l);break}}return a.size>yt&&a.clear(),a.set(t,i),i}function fe(e,t){let a=ce(t)[e.id];return a?.dailySchedule?a.dailySchedule:Oe(e,t)?.times||[]}function _e(e,t){return!e?.scheduleHistory||e.scheduleHistory.length===0?null:Oe(e,t)||e.scheduleHistory[e.scheduleHistory.length-1]}function de(e,t,a){let n=e,i=t||I();"scheduleHistory"in e&&e.scheduleHistory.length>0&&(n=_e(e,i)||e.scheduleHistory[e.scheduleHistory.length-1]);let o={name:n.nameKey?u(n.nameKey):n.name||"",subtitle:n.subtitleKey?u(n.subtitleKey):n.subtitle||""};if(a&&"id"in e){let l=e,c=R.getStatus(l.id,i,a),p=ce(i)[l.id]?.instances[a];return{...o,status:c,isCompleted:c===A.DONE||c===A.DONE_PLUS,note:p?.note,value:p?.goalOverride||0}}return o}function et(e,t,a){if(e.deletedOn&&t>=e.deletedOn)return!1;let n=s.habitAppearanceCache.get(e.id);n||(n=new Map,s.habitAppearanceCache.set(e.id,n));let i=n.get(t);if(i!==void 0)return i;let o=Oe(e,t);if(!o||e.graduatedOn)return n.set(t,!1),!1;let{frequency:l}=o,c=a||k(t),d=!1;switch(l.type){case"daily":d=!0;break;case"specific_days_of_week":d=l.days.includes(c.getUTCDay());break;case"interval":let p=cr(o.scheduleAnchor||o.startDate),f=Math.round((c.getTime()-p.getTime())/864e5);l.unit==="days"?d=f>=0&&f%l.amount===0:d=f>=0&&c.getUTCDay()===p.getUTCDay()&&Math.floor(f/7)%l.amount===0;break}return n.size>yt&&n.clear(),n.set(t,d),d}function dr(e,t){let a=fe(e,t);if(a.length===0)return!0;for(let n=0;n<a.length;n++){let i=a[n],o=R.getStatus(e.id,t,i);if(o!==A.DONE&&o!==A.DONE_PLUS)return!1}return!0}function De(e,t){let a=typeof e=="string"?s.habits.find(p=>p.id===e):e;if(!a)return 0;let n=s.streaksCache.get(a.id);n||(n=new Map,s.streaksCache.set(a.id,n));let i=n.get(t);if(i!==void 0)return i;let o=k(t);if(isNaN(o.getTime()))return 0;let l=0,c=o.getTime(),d=new Date;for(let p=0;p<mn;p++){d.setTime(c);let f=K(d);if(f<a.createdOn)break;if(et(a,f,d))if(dr(a,f))l++;else break;c-=864e5}return n.size>yt&&n.clear(),n.set(t,l),l}function Ma(e,t,a){let n=_e(e,t);if(!n||n.goal.type==="check"||!n.goal.total)return 1;let i=ce(t)[e.id];if(i?.instances[a]?.goalOverride!==void 0)return i.instances[a].goalOverride;let o=n.goal.total,l=k(t).getTime(),c=k(I()).getTime(),d=l>c?c:l-864e5,p=new Date(d),f=null,b=0;for(let S=0;S<14;S++){let L=K(p);if(L<e.createdOn)break;if(et(e,L,p)){let O=R.getStatus(e.id,L,a);if(O===A.DONE||O===A.DONE_PLUS){let _=ce(L)[e.id]?.instances?.[a];if(_&&_.goalOverride!==void 0)if(f===null)f=_.goalOverride,b++;else if(f===_.goalOverride)b++;else break;else break}}if(b>=2)return f;p.setTime(p.getTime()-864e5)}let E=De(e,K(new Date(l-864e5)));return Math.max(5,o+Math.floor(E/7)*5)}function Je(e,t,a){return ce(t)[e.id]?.instances[a]?.goalOverride??Ma(e,t,a)}function _n(e,t){let a=s.activeHabitsCache.get(e);if(a)return a;let n=t||k(e),i=[];for(let o=0;o<s.habits.length;o++){let l=s.habits[o];if(et(l,e,n)){let c=fe(l,e);c.length>0&&i.push({habit:l,schedule:c})}}return s.activeHabitsCache.size>yt&&s.activeHabitsCache.clear(),s.activeHabitsCache.set(e,i),i}function J(e,t){let a=s.daySummaryCache.get(e);if(a)return a;let n=0,i=0,o=0,l=0,c=t||k(e),d=[];for(let b=0;b<s.habits.length;b++){let E=s.habits[b];if(!et(E,e,c))continue;let S=fe(E,e),L=_e(E,e);for(let O=0;O<S.length;O++){let B=S[O],_=R.getStatus(E.id,e,B);n++,_===A.DONE||_===A.DONE_PLUS?(i++,L&&L.goal.type!=="check"&&L.goal.total&&d.push({habit:E,time:B,status:_})):_===A.DEFERRED?o++:l++}}let p=!1;if(n>0&&i===n){let b=K(new Date(c.getTime()-864e5)),E=K(new Date(c.getTime()-864e5*2)),S=J(b),L=J(E);if(S.total>0&&S.completed===S.total&&L.total>0&&L.completed===L.total){for(let O of d)if(O.status===A.DONE_PLUS){let{habit:B,time:_}=O,X=Je(B,e,_),re=Je(B,b,_),j=Je(B,E,_);if(X>re&&X>j){p=!0;break}}}}let f={total:n,completed:i,snoozed:o,pending:l,completedPercent:n?i/n*100:0,snoozedPercent:n?o/n*100:0,showPlusIndicator:p};return s.daySummaryCache.size>yt&&s.daySummaryCache.clear(),s.daySummaryCache.set(e,f),f}var ge={AI_MATCH:50,SPHERE_MATCH:40,RECOVERY:35,PERFORMANCE:30,MOMENTUM:25,TIME_OF_DAY:15,VIRTUE_ALIGN:10,RECENTLY_SHOWN:-100},ur=1200*1e3,pr=.8,mr=.7,fr=.25,gr=.15,hr=10,yr=.5;function Rn(){let e=new Date().getHours();return e<12?"morning":e<18?"afternoon":"evening"}function br(e){let t=5381,a=e.length;for(;a;)t=t*33^e.charCodeAt(--a);return t>>>0}function vr(e){let t=k(e),a=0,n=0;for(let i=1;i<=hr;i++){let o=new Date(t);o.setUTCDate(t.getUTCDate()-i);let l=K(o),c=J(l);c.total>0&&(a++,c.completed/c.total>=yr&&n++)}return a===0?1:n/a}function Er(e,t){let a={};e.forEach(o=>{let l=Oe(o,t);if(l?.times.length>0&&l.philosophy){let c=l.philosophy.virtue;a[c]=(a[c]||0)+1}});let n=0;Object.values(a).forEach(o=>{o>n&&(n=o)});let i=new Set;return n>0&&Object.entries(a).forEach(([o,l])=>{l===n&&i.add(o)}),i}function xr(e,t){let a={};e.forEach(o=>{let l=Oe(o,t);if(l?.philosophy){let c=l.philosophy.sphere;a[c]||(a[c]={total:0,done:0}),fe(o,t).forEach(p=>{a[c].total++;let f=R.getStatus(o.id,t,p);(f===A.DONE||f===A.DONE_PLUS)&&a[c].done++})}});let n=1,i=null;return Object.entries(a).forEach(([o,l])=>{if(l.total>0){let c=l.done/l.total;c<1&&c<=n&&(n=c,i=o)}}),n<.5?i:null}function Tr(e){let t=J(e);if(t.total>0&&t.completed/t.total<.2)return!1;let a=k(e),n=new Date(a.getTime()-864e5),i=K(n),o=J(i);return o.total>0&&o.completed/o.total<.4&&t.completed>0}function Sr(e,t){let a=0;for(let n of e){let i=De(n,t);i>a&&(a=i)}return a>10?"unbroken":a>3?"building":"none"}function Lr(e,t){let a=J(e),n=Rn();if(a.total===0)return"neutral";let i=a.completed/a.total,o=a.snoozed/a.total;if(i>=pr)return"triumph";if(o>fr)return"struggle";if(e===I()&&n==="evening"&&i<.1&&o<.1)return"urgency";if(i<.2&&o<.2)return vr(e)<.4?"defeat":"neutral";let c="neutral";if(t&&t.includes("-")){let d=t.split("-");d[4]&&(c=d[4])}return c==="triumph"&&i>=mr?"triumph":c==="struggle"&&o>gr?"struggle":"neutral"}function wr(e){let t=s.quoteState,a=s.dailyDiagnoses[e],n=new Set((a?a.themes:[]).map(b=>b.toLowerCase())),i=Er(s.habits,e),o=xr(s.habits,e),l=Tr(e),c=Sr(s.habits,e),d=Rn(),p=Lr(e,t?.lockedContext),f=!1;if(t&&t.lockedContext){let b=t.lockedContext.split("-");b[4]!==p&&(p==="triumph"||p==="defeat"||p==="urgency")&&(f=!0),b[3]!==d&&(f=!0)}else f=!0;return{timeOfDay:d,dominantVirtues:i,neglectedSphere:o,isRecovery:l,performanceState:p,momentumState:c,aiThemes:n,lastShownId:t?.currentId,isMajorShift:f}}function Dr(e,t){let a=1,n=(o,l,c)=>{if(o){for(let d of l)if(e.metadata.tags.includes(d)){a+=c;return}}};if(t.lastShownId===e.id&&(a+=ge.RECENTLY_SHOWN),t.aiThemes.size>0){let o=e.metadata.tags.filter(l=>t.aiThemes.has(l));a+=o.length*ge.AI_MATCH}t.neglectedSphere&&e.metadata.sphere===t.neglectedSphere&&(a+=ge.SPHERE_MATCH),n(t.isRecovery,["resilience","growth","hope"],ge.RECOVERY),t.timeOfDay==="morning"&&n(!0,["morning"],ge.TIME_OF_DAY),t.timeOfDay==="evening"&&n(!0,["evening","reflection","rest"],ge.TIME_OF_DAY),t.dominantVirtues.has(e.metadata.virtue)&&(a+=ge.VIRTUE_ALIGN);let i=t.performanceState;return i==="defeat"?n(!0,["resilience","acceptance","fate"],ge.PERFORMANCE):i==="triumph"?n(!0,["humility","temperance","death"],ge.PERFORMANCE):i==="struggle"?n(!0,["discipline","action","focus"],ge.PERFORMANCE):i==="urgency"&&(e.metadata.tags.includes("urgency")||e.metadata.tags.includes("time")||e.metadata.tags.includes("action")||e.metadata.tags.includes("death"))&&(a+=ge.PERFORMANCE*1.2),n(t.momentumState==="unbroken",["consistency","habit"],ge.MOMENTUM),a}function Pn(e,t){if(!e||e.length===0)throw new Error("No quotes provided to engine.");(!t||isNaN(Date.parse(t)))&&(t=I());let a=wr(t),n=t===I();if(n&&s.quoteState&&!a.isMajorShift&&Date.now()-s.quoteState.displayedAt<ur){let ae=e.find(he=>he.id===s.quoteState.currentId);if(ae)return ae}let i=e.map(j=>({quote:j,score:Dr(j,a)}));i.sort((j,ae)=>ae.score-j.score);let o=i[0].score,l=o>10?o*.7:0,c=i.filter(j=>j.score>=l);c.length>5&&(c=c.slice(0,5));let d=Array.from(a.dominantVirtues).sort().join(""),p=a.neglectedSphere||"none",f=`${t}-${a.timeOfDay}-${a.performanceState}-${d}-${p}`,b=parseInt(t.substring(0,4),10),E=parseInt(t.substring(8,10),10),S=n?new Date().getHours():12,L=isNaN(b)?2024:b,O=isNaN(E)?1:E,_=Math.abs(br(f)+L*O+S)%1e3/1e3,X=Math.floor(_*c.length),re=c[X].quote;return n&&(s.quoteState={currentId:re.id,displayedAt:Date.now(),lockedContext:f}),re}function v(e,t){e&&(e.firstChild&&e.firstChild.nodeType===3&&!e.firstChild.nextSibling?e.firstChild.nodeValue!==t&&(e.firstChild.nodeValue=t):e.textContent!==t&&(e.textContent=t))}function Nt(e,t,a,n){e&&(e.setAttribute("role","slider"),e.setAttribute("aria-label",u(n)),e.setAttribute("aria-valuemin","1"),e.setAttribute("aria-valuemax",String(a.length)),e.setAttribute("aria-valuenow",String(t+1)),e.setAttribute("aria-valuetext",a[t]||""),e.setAttribute("tabindex","0"))}var y={HABIT_CARD:"habit-card",HABIT_CONTENT_WRAPPER:"habit-content-wrapper",HABIT_DETAILS:"habit-details",HABIT_GOAL_CONTROLS:"habit-goal-controls",GOAL_VALUE_WRAPPER:"goal-value-wrapper",GOAL_CONTROL_BTN:"goal-control-btn",SWIPE_DELETE_BTN:"swipe-delete-btn",SWIPE_NOTE_BTN:"swipe-note-btn",DAY_ITEM:"day-item",DAY_NAME:"day-name",DAY_NUMBER:"day-number",DAY_PROGRESS_RING:"day-progress-ring",HABIT_GROUP:"habit-group",DROP_ZONE:"drop-zone",EMPTY_GROUP_PLACEHOLDER:"empty-group-placeholder",DRAG_IMAGE_GHOST:"drag-image-ghost",SELECTED:"selected",TODAY:"today",COMPLETED:"completed",SNOOZED:"snoozed",PENDING:"pending",DRAGGING:"dragging",IS_SWIPING:"is-swiping",IS_OPEN_LEFT:"is-open-left",IS_OPEN_RIGHT:"is-open-right",INVALID_DROP:"invalid-drop",DRAG_OVER:"drag-over"},F={HABIT_CARD:`.${y.HABIT_CARD}`,HABIT_CONTENT_WRAPPER:`.${y.HABIT_CONTENT_WRAPPER}`,GOAL_VALUE_WRAPPER:`.${y.GOAL_VALUE_WRAPPER}`,GOAL_CONTROL_BTN:`.${y.GOAL_CONTROL_BTN}`,SWIPE_DELETE_BTN:`.${y.SWIPE_DELETE_BTN}`,SWIPE_NOTE_BTN:`.${y.SWIPE_NOTE_BTN}`,HABIT_GOAL_CONTROLS:`.${y.HABIT_GOAL_CONTROLS}`,DAY_ITEM:`.${y.DAY_ITEM}`,DROP_ZONE:`.${y.DROP_ZONE}`,EMPTY_GROUP_PLACEHOLDER:`.${y.EMPTY_GROUP_PLACEHOLDER}`};var Nn=15,Un=200,Bn=null,Fn=null,Mr={weekday:"long",day:"numeric",month:"long",timeZone:"UTC"},zn=Array.from({length:100},(e,t)=>(t<10?"0":"")+t),Cr=()=>Bn||(Bn=(()=>{let e=document.createElement("div");return e.className=y.DAY_ITEM,e.setAttribute("role","button"),e.innerHTML=`<span class="${y.DAY_NAME}"></span><div class="${y.DAY_PROGRESS_RING}"><span class="${y.DAY_NUMBER}"></span></div>`,e})()),Kn=()=>Fn||(Fn=(()=>{let e=document.createElement("div");return e.className="full-calendar-day",e.setAttribute("role","button"),e.innerHTML=`<div class="${y.DAY_PROGRESS_RING}"><span class="${y.DAY_NUMBER}"></span></div>`,e})());function Ca(e,t,a){let n=Cr().cloneNode(!0),i=k(e);n.dataset.date=e;let o=n.firstElementChild,l=o.nextElementSibling,c=l.firstElementChild;v(o,Mn(i)),v(c,ke(i.getUTCDate())),t&&n.classList.add(y.SELECTED),a&&n.classList.add(y.TODAY);let{completedPercent:d,snoozedPercent:p,showPlusIndicator:f}=J(e,i);return d>0&&l.style.setProperty("--completed-percent",`${d}%`),p>0&&l.style.setProperty("--snoozed-percent",`${p}%`),f&&c.classList.add("has-plus"),n.setAttribute("aria-label",i.toLocaleDateString(s.activeLanguageCode,Mr)),t?(n.setAttribute("aria-current","date"),n.setAttribute("tabindex","0")):n.setAttribute("tabindex","-1"),n}function qn(){if(!r.calendarStrip||!s.uiDirtyState.calendarVisuals&&r.calendarStrip.children.length>0)return;let e=s.selectedDate||I(),t=k(e),a=I(),n=document.createDocumentFragment();for(let i=-Nn;i<=Nn;i++){let o=se(t,i),l=K(o),c=Ca(l,l===e,l===a);n.appendChild(c)}r.calendarStrip.innerHTML="",r.calendarStrip.appendChild(n),s.uiDirtyState.calendarVisuals=!1,requestAnimationFrame(()=>Bt(!1))}function Gn(e,t=r.calendarStrip){let a=se(k(e),1),n=K(a),i=I(),o=Ca(n,n===s.selectedDate,n===i);return t.appendChild(o),t===r.calendarStrip&&r.calendarStrip.children.length>Un&&r.calendarStrip.firstElementChild?.remove(),n}function Vn(e,t=r.calendarStrip){let a=se(k(e),-1),n=K(a),i=I(),o=Ca(n,n===s.selectedDate,n===i);return t instanceof DocumentFragment?t.prepend(o):t.insertBefore(o,t.firstElementChild),t===r.calendarStrip&&r.calendarStrip.children.length>Un&&r.calendarStrip.lastElementChild?.remove(),n}function Re(){if(!r.fullCalendarGrid||!s.fullCalendar)return;let{year:e,month:t}=s.fullCalendar;r.fullCalendarMonthYear.textContent=new Date(Date.UTC(e,t,1)).toLocaleDateString(s.activeLanguageCode,{month:"long",year:"numeric",timeZone:"UTC"});let a=document.createDocumentFragment(),n=new Date(Date.UTC(e,t,1)),i=new Date(Date.UTC(e,t+1,0)).getUTCDate(),o=n.getUTCDay(),l=new Date(Date.UTC(e,t,0)).getUTCDate();for(let p=0;p<o;p++){let f=l-o+1+p,b=Kn().cloneNode(!0);b.classList.add("other-month"),b.firstElementChild.firstElementChild.textContent=ke(f),a.appendChild(b)}let c=I(),d=`${e}-${zn[t+1]}-`;for(let p=1;p<=i;p++){let f=d+zn[p],b=Kn().cloneNode(!0),E=b.firstElementChild,S=E.firstElementChild;S.textContent=ke(p),b.dataset.date=f;let{completedPercent:L,snoozedPercent:O,showPlusIndicator:B}=J(f,k(f));L>0&&E.style.setProperty("--completed-percent",`${L}%`),O>0&&E.style.setProperty("--snoozed-percent",`${O}%`),B&&S.classList.add("has-plus"),f===s.selectedDate&&b.classList.add(y.SELECTED),f===c&&b.classList.add(y.TODAY),a.appendChild(b)}r.fullCalendarGrid.innerHTML="",r.fullCalendarGrid.appendChild(a)}function Bt(e=!0){r.calendarStrip&&requestAnimationFrame(()=>{let t=r.calendarStrip.querySelector(`.${y.SELECTED}`);if(t){let a=r.calendarStrip.clientWidth,n=t.offsetLeft,i=t.offsetWidth,o=t.classList.contains(y.TODAY),l;o?l=n+i-a+10:l=n-a/2+i/2,r.calendarStrip.scrollTo({left:l,behavior:e?"smooth":"auto"})}})}var tt=new Map,Ft={Morning:[],Afternoon:[],Evening:[]},$n=new Map,Zn=new WeakMap;function Ar(e){let t=$n.get(e);if(!t&&r.habitContainer){let a=r.habitContainer.querySelector(`.habit-group-wrapper[data-time-wrapper="${e}"]`),n=a?.querySelector(`.${y.HABIT_GROUP}[data-time="${e}"]`),i=a?.querySelector(".time-marker");a&&n&&i&&(t={wrapper:a,group:n,marker:i},$n.set(e,t))}return t}var Wn=null,Yn={},Xn=null,jn=null,Hr=()=>Wn||(Wn=(()=>{let e=document.createElement("div");return e.className=y.HABIT_GOAL_CONTROLS,e.innerHTML=`<button type="button" class="${y.GOAL_CONTROL_BTN}" data-action="decrement">-</button><div class="${y.GOAL_VALUE_WRAPPER}"><div class="progress"></div><div class="unit"></div></div><button type="button" class="${y.GOAL_CONTROL_BTN}" data-action="increment">+</button>`,e})()),Qn=(e,t)=>Yn[e]||(Yn[e]=(()=>{let a=document.createElement("div");return a.className=e,a.innerHTML=t,a})()),Ir=()=>jn||(jn=(()=>{let e=document.createElement("div");return e.className=y.EMPTY_GROUP_PLACEHOLDER,e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e})()),kr=()=>Xn||(Xn=(()=>{let e=document.createElement("li");return e.className=y.HABIT_CARD,e.innerHTML=`<div class="habit-actions-left"><button type="button" class="${y.SWIPE_DELETE_BTN}">${z.swipeDelete}</button></div><div class="habit-actions-right"><button type="button" class="${y.SWIPE_NOTE_BTN}">${z.swipeNote}</button></div><div class="${y.HABIT_CONTENT_WRAPPER}" role="button" tabindex="0" draggable="true"><div class="habit-icon"></div><div class="${y.HABIT_DETAILS}"><div class="name"></div><div class="subtitle"></div><div class="consolidation-message" hidden></div></div><div class="habit-goal"></div><div class="ripple-container"></div></div>`,e})()),Aa=(e,t)=>`${e}|${t}`,at=()=>tt.clear(),Jn=(e,t)=>tt.get(Aa(e,t));function Or(e,t,a,n){let i=_e(e,s.selectedDate);if(!i){n.goal.hasChildNodes()&&n.goal.replaceChildren();return}if(i.goal.type==="check"){n.goal.hasChildNodes()&&n.goal.replaceChildren();return}let o=n.goal.querySelector(`.${y.HABIT_GOAL_CONTROLS}`);o||(n.goal.replaceChildren(Hr().cloneNode(!0)),o=n.goal.firstElementChild,n.goalDecBtn=n.goalIncBtn=n.goalProgress=n.goalUnit=void 0);let l=o.querySelector(`.${y.GOAL_VALUE_WRAPPER}`),c=l.querySelector(".progress");c?(!n.goalProgress||!n.goalProgress.isConnected)&&(n.goalProgress=c,n.goalUnit=l.querySelector(".unit")):(l.innerHTML='<div class="progress"></div><div class="unit"></div>',n.goalProgress=l.querySelector(".progress"),n.goalUnit=l.querySelector(".unit")),(!n.goalDecBtn||!n.goalDecBtn.isConnected)&&(n.goalDecBtn=o.querySelector('[data-action="decrement"]')),(!n.goalIncBtn||!n.goalIncBtn.isConnected)&&(n.goalIncBtn=o.querySelector('[data-action="increment"]'));let d=a?.goalOverride??Ma(e,s.selectedDate,t);n.goalDecBtn&&(n.goalDecBtn.disabled=d<=1),n.goalProgress&&v(n.goalProgress,ke(d)),n.goalUnit&&v(n.goalUnit,u(i.goal.unitKey||"unitCheck",{count:d}))}function zt(e,t,a,n,i){let o=Zn.get(e),l=R.getStatus(t.id,s.selectedDate,a),c=y.PENDING;l===A.DONE||l===A.DONE_PLUS?c=y.COMPLETED:l===A.DEFERRED&&(c=y.SNOOZED),l===A.DONE_PLUS?e.dataset.arete!=="true"&&(e.dataset.arete="true"):e.dataset.arete&&e.removeAttribute("data-arete");let d=(n||ce(s.selectedDate))[t.id]?.instances?.[a],p=De(t,s.selectedDate),{name:f,subtitle:b}=de(t,s.selectedDate);e.classList.contains(c)||(e.classList.remove(y.PENDING,y.COMPLETED,y.SNOOZED),e.classList.add(c),c===y.COMPLETED&&i?.animate&&(o.icon.classList.remove("animate-pop"),o.icon.offsetWidth,o.icon.classList.add("animate-pop")));let E=_e(t,s.selectedDate);if(!E)return;o.cachedIconHtml!==E.icon&&(o.icon.innerHTML=o.cachedIconHtml=E.icon),o.icon.style.color=E.color,o.icon.style.backgroundColor=`${E.color}30`;let S=p>=Ke,L=p>=ut&&!S;e.classList.toggle("consolidated",S),e.classList.toggle("semi-consolidated",L),v(o.name,f),v(o.subtitle,b);let O=S?u("habitConsolidatedMessage"):L?u("habitSemiConsolidatedMessage"):"";v(o.consolidationMsg,O),o.consolidationMsg.hidden=!O;let B=!!d?.note;o.noteBtn.dataset.hasNote!==String(B)&&(o.noteBtn.innerHTML=B?z.swipeNoteHasNote:z.swipeNote,o.noteBtn.dataset.hasNote=String(B)),c===y.COMPLETED?o.goal.replaceChildren(Qn("completed-wrapper",z.check).cloneNode(!0)):c===y.SNOOZED?o.goal.replaceChildren(Qn("snoozed-wrapper",z.snoozed).cloneNode(!0)):Or(t,a,d,o)}function _r(e,t,a){let n=kr().cloneNode(!0);n.dataset.habitId=e.id,n.dataset.time=t;let i=Aa(e.id,t);tt.set(i,n);let o=n.firstElementChild,l=o.nextElementSibling,c=l.nextElementSibling,d=c.children[1],p=c.children[2];return Zn.set(n,{icon:c.children[0],contentWrapper:c,name:d.children[0],subtitle:d.children[1],details:d,consolidationMsg:d.children[2],noteBtn:l.firstElementChild,deleteBtn:o.firstElementChild,goal:p}),zt(n,e,t,a),n}function ei(){if(document.body.classList.contains("is-interaction-active")||!s.uiDirtyState.habitListStructure)return;let e=k(s.selectedDate),t=ce(s.selectedDate),a=_n(s.selectedDate,e);je.forEach(o=>Ft[o].length=0);for(let o=0;o<a.length;o++){let{habit:l,schedule:c}=a[o];for(let d=0;d<c.length;d++)Ft[c[d]].push(l)}let n=je.filter(o=>Ft[o].length===0),i=new Set;je.forEach(o=>{let l=Ar(o);if(!l)return;let c=Ft[o],d=c.length>0;l.marker.style.display=d?"":"none",d&&(l.marker.innerHTML=qe(o));let p=[];if(d)for(let b=0;b<c.length;b++){let E=c[b],S=Aa(E.id,o);i.add(S);let L=tt.get(S);L?(L.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT,y.IS_SWIPING,y.DRAGGING),zt(L,E,o,t)):L=_r(E,o,t),p.push(L)}let f=o===n[0];if(l.wrapper.classList.toggle("has-habits",d),l.wrapper.classList.toggle("is-collapsible",!d&&!f),!d){let b=l.group.querySelector(F.EMPTY_GROUP_PLACEHOLDER);b||(b=Ir().cloneNode(!0)),b.classList.toggle("show-smart-placeholder",f);let E=f?`<span class="placeholder-icon-generic">${n.map(qe).join('<span class="icon-separator">/</span>')}</span><span class="placeholder-icon-specific">${qe(o)}</span>`:`<span class="placeholder-icon-specific">${qe(o)}</span>`;b.innerHTML=`<div class="time-of-day-icon">${E}</div><span class="placeholder-arrow">\u2192</span><span>${u("dragToAddHabit")}</span>`,p.push(b)}l.group.replaceChildren(...p)});for(let o of tt.keys())i.has(o)||tt.delete(o);s.uiDirtyState.habitListStructure=!1}var Ia=30,Rr=100,Pr=.025,Nr=1.5,bt=75,xe={top:5,right:0,bottom:5,left:3},ti={month:"short",day:"numeric",timeZone:"UTC",year:void 0},ai={month:"short",day:"numeric",timeZone:"UTC",year:"2-digit"},ni=Array.from({length:Ia},()=>({date:"",timestamp:0,value:0,completedCount:0,scheduledCount:0})),U={lastChartData:[],cachedChartRect:null,chartMinVal:0,chartValueRange:100,lastRenderedPointIndex:-1,hasTypedOM:typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px)},ka=null,ii=0,Kt=!0,Ut=!1,oi=null,ri=null,si=!1,Ha=0;function Br(){try{let e=k(s.selectedDate);if(isNaN(e.getTime()))throw new Error("Invalid selectedDate for chart calculation");let t=e.getTime()-(Ia-1)*864e5,a=new Date(t),n=I(),i=Rr;for(let o=0;o<Ia;o=o+1|0){a.setTime(t);let l=K(a),c=J(l,a),{total:d,completed:p,pending:f,showPlusIndicator:b}=c,E=l===n,S=l>n,L;if(S||E&&f>0)L=i;else if(d>0){let _=(p/d-.5)*2;b&&(_=1*Nr);let X=_*Pr;L=i*(1+X)}else L=i;let O=ni[o];O.date=l,O.timestamp=t,O.value=L,O.completedCount=p,O.scheduledCount=d,i=L,t+=864e5}return ni}catch(e){return console.error("Critical error in calculateChartData:",e),[]}}function Fr(e,t){let a=e.length;if(a===0)return{areaPathData:"",linePathData:""};let n=1/0,i=-1/0;for(let N=0;N<a;N=N+1|0){let ve=e[N].value;ve<n&&(n=ve),ve>i&&(i=ve)}let o=2,l=i-n;if(l<o){let N=(n+i)/2;n=N-o/2,i=N+o/2,l=o}let c=l*.25,d=n-c,f=i+c-d;U.chartMinVal=d,U.chartValueRange=f>0?f:1;let b=`0 0 ${t} ${bt}`;r.chart.svg.getAttribute("viewBox")!==b&&r.chart.svg.setAttribute("viewBox",b);let E=xe.left,S=xe.top,L=t-E-xe.right,O=bt-S-xe.bottom,B=L/(a-1),_=O/U.chartValueRange,X=S+O,re=e[0].value,j=E,ae=X-(re-d)*_,he="M "+j+" "+ae,P=.25;for(let N=0;N<a-1;N=N+1|0){let ve=e[N>0?N-1:N].value,Mo=E+(N>0?N-1:N)*B,Co=X-(ve-d)*_,Ao=e[N].value,ln=E+N*B,cn=X-(Ao-d)*_,Ho=e[N+1].value,la=E+(N+1)*B,ca=X-(Ho-d)*_,Io=e[N+2<a?N+2:N+1].value,ko=E+(N+2<a?N+2:N+1)*B,Oo=X-(Io-d)*_,_o=ln+(la-Mo)*P,Ro=cn+(ca-Co)*P,Po=la-(ko-ln)*P,No=ca-(Oo-cn)*P;he+=" C "+_o+" "+Ro+", "+Po+" "+No+", "+la+" "+ca}let V=X-(d-d)*_,Te=E+(a-1)*B;return{areaPathData:he+" V "+V+" L "+j+" "+V+" Z",linePathData:he}}function zr(e){let{axisStart:t,axisEnd:a}=r.chart,n=e[0].timestamp,i=e[e.length-1].timestamp,o=new Date().getUTCFullYear(),l=new Date(n).getUTCFullYear(),c=new Date(i).getUTCFullYear(),d=ue(n,l!==o?ai:ti),p=ue(i,c!==o?ai:ti);v(t,d),v(a,p)}function Kr(e){let{evolutionIndicator:t}=r.chart,a=e[e.length-1],n=e[0],i=e.length;for(let c=0;c<i;c=c+1|0)if(e[c].scheduledCount>0){n=e[c];break}let o=(a.value-n.value)/n.value*100,l=`chart-evolution-indicator ${o>=0?"positive":"negative"}`;t.className!==l&&(t.className=l),v(t,`${o>0?"+":""}${wn(o)}%`)}function Oa(e){let{areaPath:t,linePath:a}=r.chart;if(!t||!a||!e||e.length===0)return;let n=r.chart.wrapper.getBoundingClientRect().width;if(!n&&r.chartContainer.clientWidth>0&&(n=r.chartContainer.clientWidth-32),n||(n=300),e===ka&&n===ii)return;let{areaPathData:i,linePathData:o}=Fr(e,n);t.setAttribute("d",i),a.setAttribute("d",o),zr(e),Kr(e),ka=e,ii=n,U.cachedChartRect=null}function Ur(){si||!r.chartContainer||(si=!0,oi=new IntersectionObserver(e=>{Kt=e[0].isIntersecting,Kt&&Ut&&(Ut=!1,Oa(U.lastChartData))},{threshold:.1}),oi.observe(r.chartContainer),ri=new ResizeObserver(()=>{Ha&&cancelAnimationFrame(Ha),Ha=requestAnimationFrame(()=>{Kt&&(U.cachedChartRect=null,Oa(U.lastChartData))})}),ri.observe(r.chartContainer))}function _a(){try{Ur(),(gn()||U.lastChartData.some(t=>t.date===""))&&(U.lastChartData=Br(),U.lastRenderedPointIndex=-1,ka=null);let e=U.lastChartData.length<2||U.lastChartData.every(t=>t.scheduledCount===0);if(r.chartContainer.classList.toggle("is-empty",e),r.chart.title){let t=u("appName");r.chart.title.innerHTML!==t&&(r.chart.title.innerHTML=t)}if(r.chart.subtitle){let n=J(s.selectedDate).completed>0?"chartSubtitleProgress":"appSubtitle",i=u(n);r.chart.subtitle.textContent!==i&&(r.chart.subtitle.textContent=i)}if(e){if(r.chart.emptyState){let t=u("chartEmptyState");r.chart.emptyState.textContent!==t&&(r.chart.emptyState.textContent=t)}return}Kt?(Oa(U.lastChartData),Ut=!1):Ut=!0}catch(e){console.error("Failed to render chart:",e),r.chartContainer.classList.add("is-empty")}}var q=Object.freeze({type:"check",unitKey:"unitCheck"}),H=Object.freeze({type:"daily"}),nt=Object.freeze([{nameKey:"predefinedHabitSustenanceName",subtitleKey:"predefinedHabitSustenanceSubtitle",icon:C.sustenance,color:"#3498DB",times:["Morning"],goal:q,frequency:H,isDefault:!0,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.sustento.conscience",stoicConcept:"Sophrosyne / Diaita",masterQuoteId:"cit_musonio_rufo_nutricao_01"}},{nameKey:"predefinedHabitInhibitionName",subtitleKey:"predefinedHabitInhibitionSubtitle",icon:C.snowflake,color:"#95A5A6",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Courage",discipline:"Desire",nature:"Addition",conscienceKey:"habit.inhibition.conscience",stoicConcept:"Askesis / Ponos",masterQuoteId:"cit_seneca_inibicao_01"}},{nameKey:"predefinedHabitDignityName",subtitleKey:"predefinedHabitDignitySubtitle",icon:C.dignity,color:"#8E44AD",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.dignity.conscience",stoicConcept:"Eustatheia / Dignitas",masterQuoteId:"cit_marco_compostura_01"}},{nameKey:"predefinedHabitPresenceName",subtitleKey:"predefinedHabitPresenceSubtitle",icon:C.presence,color:"#5DADE2",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.presence.conscience",stoicConcept:"Prosoche / Pneuma",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitAbstentionName",subtitleKey:"predefinedHabitAbstentionSubtitle",icon:C.abstention,color:"#BDC3C7",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Temperance",discipline:"Desire",nature:"Subtraction",conscienceKey:"habit.abstention.conscience",stoicConcept:"Abstine / Sophrosyne",masterQuoteId:"cit_epicteto_abstine_01"}},{nameKey:"predefinedHabitDiscernmentName",subtitleKey:"predefinedHabitDiscernmentSubtitle",icon:C.discernment,color:"#f1c40f",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.discernment.conscience",stoicConcept:"Dichotomy of Control / Prohairesis",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitAnticipationName",subtitleKey:"predefinedHabitAnticipationSubtitle",icon:C.anticipation,color:"#922B21",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Courage",discipline:"Desire",nature:"Addition",conscienceKey:"habit.anticipation.conscience",stoicConcept:"Premeditatio Malorum",masterQuoteId:"cit_seneca_antecipacao_01"}},{nameKey:"predefinedHabitMovementName",subtitleKey:"predefinedHabitMovementSubtitle",icon:C.movement,color:"#E67E22",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Courage",discipline:"Action",nature:"Addition",conscienceKey:"habit.movement.conscience",stoicConcept:"Gymnazein / Officium",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitExerciseName",subtitleKey:"predefinedHabitExerciseSubtitle",icon:C.exercise,color:"#2ECC71",times:["Afternoon"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Courage",discipline:"Action",nature:"Addition",conscienceKey:"habit.exercise.conscience",stoicConcept:"Ponos / Gymnazein",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitStretchName",subtitleKey:"predefinedHabitStretchSubtitle",icon:C.stretch,color:"#FADBD8",times:["Morning"],goal:{type:"minutes",total:5,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.exercise.conscience",stoicConcept:"Tasis",masterQuoteId:"cit_socrates_movimento_01"}},{nameKey:"predefinedHabitYogaName",subtitleKey:"predefinedHabitYogaSubtitle",icon:C.yoga,color:"#5DADE2",times:["Morning"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.yoga.conscience",stoicConcept:"Askesis",masterQuoteId:"cit_seneca_inibicao_01"}},{nameKey:"predefinedHabitReadName",subtitleKey:"predefinedHabitReadSubtitle",icon:C.read,color:"#e74c3c",times:["Evening"],goal:{type:"pages",total:10,unitKey:"unitPage"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.read.conscience",stoicConcept:"Lectio",masterQuoteId:"cit_seneca_leitura_01"}},{nameKey:"predefinedHabitMeditateName",subtitleKey:"predefinedHabitMeditateSubtitle",icon:C.meditate,color:"#BB8FCE",times:["Morning"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.meditate.conscience",stoicConcept:"Prosoche",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitZealName",subtitleKey:"predefinedHabitZealSubtitle",icon:C.zeal,color:"#58D68D",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.zeal.conscience",stoicConcept:"Oikeiosis / Cosmopolitanism",masterQuoteId:"cit_marco_zelo_01"}},{nameKey:"predefinedHabitJournalName",subtitleKey:"predefinedHabitJournalSubtitle",icon:C.journal,color:"#A1887F",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.journal.conscience",stoicConcept:"Hypomnemata",masterQuoteId:"cit_marco_escrita_01"}},{nameKey:"predefinedHabitPlanDayName",subtitleKey:"predefinedHabitPlanDaySubtitle",icon:C.planDay,color:"#007AFF",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.plan.conscience",stoicConcept:"Taxis",masterQuoteId:"cit_seneca_tempo_01"}},{nameKey:"predefinedHabitGratitudeName",subtitleKey:"predefinedHabitGratitudeSubtitle",icon:C.gratitude,color:"#E84393",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Justice",discipline:"Desire",nature:"Addition",conscienceKey:"habit.gratitude.conscience",stoicConcept:"Eucharistia",masterQuoteId:"cit_epicteto_gratidao_01"}},{nameKey:"predefinedHabitCadenciaName",subtitleKey:"predefinedHabitCadenciaSubtitle",icon:C.sunMoon,color:"#F1C40F",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Wisdom",discipline:"Desire",nature:"Addition",conscienceKey:"habit.cadencia.conscience",stoicConcept:"Logos / Kata Physin",masterQuoteId:"cit_seneca_cadencia_01"}},{nameKey:"predefinedHabitReflectDayName",subtitleKey:"predefinedHabitReflectDaySubtitle",icon:C.reflectDay,color:"#FADBD8",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:1,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.reflect.conscience",stoicConcept:"Exetasis",masterQuoteId:"quote_ma_001"}},{nameKey:"predefinedHabitStoicismName",subtitleKey:"predefinedHabitStoicismSubtitle",icon:C.stoicism,color:"#7F8C8D",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.stoicism.conscience",stoicConcept:"Prokopton",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitLanguageName",subtitleKey:"predefinedHabitLanguageSubtitle",icon:C.language,color:"#1ABC9C",times:["Afternoon"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.language.conscience",stoicConcept:"Logos",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitOrganizeName",subtitleKey:"predefinedHabitOrganizeSubtitle",icon:C.organize,color:"#BDC3C7",times:["Evening"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.organize.conscience",stoicConcept:"Kosmos",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitCreativeHobbyName",subtitleKey:"predefinedHabitCreativeHobbySubtitle",icon:C.creativeHobby,color:"#e84393",times:["Afternoon"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.hobby.conscience",stoicConcept:"Techne",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitTalkFriendName",subtitleKey:"predefinedHabitTalkFriendSubtitle",icon:C.talkFriend,color:"#3498db",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.friend.conscience",stoicConcept:"Philia",masterQuoteId:"cit_hierocles_circulos_01"}},{nameKey:"predefinedHabitInstrumentName",subtitleKey:"predefinedHabitInstrumentSubtitle",icon:C.instrument,color:"#e67e22",times:["Evening"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.instrument.conscience",stoicConcept:"Harmonia",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitPlantsName",subtitleKey:"predefinedHabitPlantsSubtitle",icon:C.plants,color:"#27ae60",times:["Morning"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.plants.conscience",stoicConcept:"Physis",masterQuoteId:"cit_zeno_natureza_01"}},{nameKey:"predefinedHabitFinancesName",subtitleKey:"predefinedHabitFinancesSubtitle",icon:C.finances,color:"#34495e",times:["Evening"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:2,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.finances.conscience",stoicConcept:"Oikonomia",masterQuoteId:"cit_epicteto_abstine_01"}},{nameKey:"predefinedHabitTeaName",subtitleKey:"predefinedHabitTeaSubtitle",icon:C.tea,color:"#16a085",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Desire",nature:"Addition",conscienceKey:"habit.tea.conscience",stoicConcept:"Ataraxia",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitPodcastName",subtitleKey:"predefinedHabitPodcastSubtitle",icon:C.podcast,color:"#007aff",times:["Afternoon"],goal:{type:"minutes",total:25,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.podcast.conscience",stoicConcept:"Akroasis",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitEmailsName",subtitleKey:"predefinedHabitEmailsSubtitle",icon:C.emails,color:"#f39c12",times:["Morning"],goal:{type:"minutes",total:5,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Structural",level:1,virtue:"Justice",discipline:"Action",nature:"Subtraction",conscienceKey:"habit.emails.conscience",stoicConcept:"Katharsis / Taxis",masterQuoteId:"cit_seneca_tempo_01"}},{nameKey:"predefinedHabitSkincareName",subtitleKey:"predefinedHabitSkincareSubtitle",icon:C.skincare,color:"#d35400",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.skincare.conscience",stoicConcept:"Therapeia",masterQuoteId:"cit_marco_compostura_01"}},{nameKey:"predefinedHabitDrawName",subtitleKey:"predefinedHabitDrawSubtitle",icon:C.draw,color:"#8e44ad",times:["Afternoon"],goal:{type:"minutes",total:15,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Action",nature:"Addition",conscienceKey:"habit.draw.conscience",stoicConcept:"Mimesis",masterQuoteId:"cit_marco_ordem_01"}},{nameKey:"predefinedHabitFamilyTimeName",subtitleKey:"predefinedHabitFamilyTimeSubtitle",icon:C.familyTime,color:"#f1c40f",times:["Evening"],goal:{type:"minutes",total:30,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Social",level:1,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.family.conscience",stoicConcept:"Oikeiosis / Storge",masterQuoteId:"cit_hierocles_circulos_01"}},{nameKey:"predefinedHabitNewsName",subtitleKey:"predefinedHabitNewsSubtitle",icon:C.news,color:"#7f8c8d",times:["Morning"],goal:{type:"minutes",total:10,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.news.conscience",stoicConcept:"Kosmopolites",masterQuoteId:"cit_epicteto_controle_01"}},{nameKey:"predefinedHabitCookHealthyName",subtitleKey:"predefinedHabitCookHealthySubtitle",icon:C.cookHealthy,color:"#27ae60",times:["Evening"],goal:q,frequency:H,philosophy:{sphere:"Biological",level:1,virtue:"Temperance",discipline:"Action",nature:"Addition",conscienceKey:"habit.cook.conscience",stoicConcept:"Dieta",masterQuoteId:"cit_musonio_rufo_nutricao_01"}},{nameKey:"predefinedHabitLearnSkillName",subtitleKey:"predefinedHabitLearnSkillSubtitle",icon:C.learnSkill,color:"#e74c3c",times:["Afternoon"],goal:{type:"minutes",total:20,unitKey:"unitMin"},frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.learn.conscience",stoicConcept:"Episteme",masterQuoteId:"cit_socrates_aprendizado_01"}},{nameKey:"predefinedHabitPhotographyName",subtitleKey:"predefinedHabitPhotographySubtitle",icon:C.photography,color:"#95a5a6",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Mental",level:2,virtue:"Wisdom",discipline:"Assent",nature:"Addition",conscienceKey:"habit.photo.conscience",stoicConcept:"Phantasia",masterQuoteId:"cit_marco_presenca_01"}},{nameKey:"predefinedHabitVolunteerName",subtitleKey:"predefinedHabitVolunteerSubtitle",icon:C.gratitude,color:"#e74c3c",times:["Afternoon"],goal:q,frequency:H,philosophy:{sphere:"Social",level:2,virtue:"Justice",discipline:"Action",nature:"Addition",conscienceKey:"habit.volunteer.conscience",stoicConcept:"Koinonia",masterQuoteId:"cit_marco_zelo_01"}}]);var Pe=[],qr={day:"numeric",month:"long",timeZone:"UTC"},Ra=["#e74c3c","#f1c40f","#3498db","#2ecc71","#9b59b6","#1abc9c","#34495e","#e67e22","#e84393","#7f8c8d","#26A69A","#FFA726","#5C6BC0","#EC407A","#9CCC65"];function Gr(){let e=new Map(Ra.map(n=>[n,0]));s.habits.forEach(n=>{let i=n.scheduleHistory[n.scheduleHistory.length-1];!n.graduatedOn&&i&&e.has(i.color)&&e.set(i.color,e.get(i.color)+1)});let t=Math.min(...e.values()),a=Ra.filter(n=>e.get(n)===t);return a[s.habits.length%a.length]}function li(){document.addEventListener("keydown",e=>{let t=Pe[Pe.length-1];if(t){if(e.key==="Escape")M("light"),Q(t.element);else if(e.key==="Tab"){let{firstFocusable:a,lastFocusable:n}=t;a&&n&&(e.shiftKey&&document.activeElement===a?(n.focus(),e.preventDefault()):!e.shiftKey&&document.activeElement===n&&(a.focus(),e.preventDefault()))}}}),document.addEventListener("click",e=>{let t=Pe[Pe.length-1];t&&e.target===t.element&&(M("light"),Q(t.element))})}function ie(e,t,a){let n={element:e,previousFocus:document.activeElement,onClose:a},i=e.querySelector(".modal-header");if(i){let l=i.querySelector(".modal-header-spacer");if(l&&!l.previousElementSibling?.classList.contains("modal-back-btn")){let c=document.createElement("button");c.className="modal-back-btn",c.innerHTML=z.backArrow,c.setAttribute("aria-label",u("aria_go_back")),c.addEventListener("click",()=>{M("light"),Q(e)}),l.replaceWith(c)}}e.classList.add("visible");let o=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');o.length&&(n.firstFocusable=o[0],n.lastFocusable=o[o.length-1],setTimeout(()=>(t||o[0]).focus(),100)),Pe.push(n),r.appContainer.setAttribute("inert","")}function Q(e,t=!1){let a=Pe.findIndex(l=>l.element===e);if(a===-1)return;let[n]=Pe.splice(a,1);e.classList.remove("visible"),Pe.length===0&&r.appContainer.removeAttribute("inert");let i=e.querySelector(".modal-header"),o=i?.querySelector(".modal-back-btn");if(i&&o){let l=document.createElement("div");l.className="modal-header-spacer",o.replaceWith(l)}t||n.onClose?.(),n.previousFocus?.focus()}function qt(){let e=s.habits.filter(n=>!n.deletedOn);if(e.length===0){r.habitList.classList.add("hidden"),r.noHabitsMessage.classList.remove("hidden");return}r.habitList.classList.remove("hidden"),r.noHabitsMessage.classList.add("hidden");let t=e.map(n=>{let{name:i,subtitle:o}=de(n),l=n.graduatedOn?"graduated":n.scheduleHistory[n.scheduleHistory.length-1].endDate?"ended":"active";return{h:n,st:l,name:i,subtitle:o}}).sort((n,i)=>{let o={active:0,graduated:1,ended:2};return o[n.st]-o[i.st]||Sn(n.name,i.name)}),a=I();r.habitList.innerHTML=t.map(({h:n,st:i,name:o,subtitle:l})=>{let c=n.scheduleHistory[n.scheduleHistory.length-1];return`<li class="habit-list-item ${i}" data-habit-id="${n.id}"><span class="habit-main-info"><span class="habit-icon-slot" style="color:${c.color}">${c.icon}</span><div style="display:flex;flex-direction:column;flex-grow:1;"><span class="habit-name">${o}</span>${l?`<span class="habit-subtitle" style="font-size:11px;color:var(--text-tertiary)">${l}</span>`:""}</div>${i!=="active"?`<span class="habit-name-status">${u(i==="graduated"?"modalStatusGraduated":"modalStatusEnded")}</span>`:""}</span><div class="habit-list-actions">${i==="active"?`${De(n,a)>=Ke?`<button class="graduate-habit-btn" aria-label="${u("aria_graduate",{name:o})}">${z.graduateAction}</button>`:`<button class="end-habit-btn" aria-label="${u("aria_end",{name:o})}">${z.endAction}</button>`}`:`<button class="permanent-delete-habit-btn" aria-label="${u("aria_delete_permanent",{name:o})}">${z.deletePermanentAction}</button>`}</div></li>`}).join("")}function oe(e,t,a){r.confirmModalText.innerHTML=e,s.confirmAction=t,s.confirmEditAction=a?.onEdit||null,v(r.confirmModal.querySelector("h2"),a?.title||u("modalConfirmTitle")),r.confirmModalConfirmBtn.className=`btn ${a?.confirmButtonStyle==="danger"?"btn--danger":"btn--primary"}`,v(r.confirmModalConfirmBtn,a?.confirmText||u("confirmButton")),r.confirmModalEditBtn.classList.toggle("hidden",!a?.onEdit),a?.editText&&v(r.confirmModalEditBtn,a.editText);let n=()=>{s.confirmAction=null,s.confirmEditAction=null,a?.onCancel?.()};ie(r.confirmModal,void 0,n)}function ci(e,t,a){let n=s.habits.find(i=>i.id===e);n&&(s.editingNoteFor={habitId:e,date:t,time:a},v(r.notesModalTitle,de(n,t).name),v(r.notesModalSubtitle,`${ue(k(t),qr)} - ${Ue(a)}`),r.notesTextarea.value=ce(t)[e]?.instances[a]?.note||"",ie(r.notesModal,r.notesTextarea,()=>s.editingNoteFor=null))}function Pa(){if(!s.editingHabit)return;let{color:e}=s.editingHabit.formData,t=dt(e);r.iconPickerGrid.style.setProperty("--current-habit-bg-color",e),r.iconPickerGrid.style.setProperty("--current-habit-fg-color",t),r.iconPickerGrid.innerHTML=Object.values(C).map(a=>`<button type="button" class="icon-picker-item" data-icon-svg="${ha(a)}">${a}</button>`).join(""),r.iconPickerModal.querySelector("#change-color-from-picker-btn").innerHTML=z.colorPicker}function di(){let e=s.editingHabit?.formData.color;r.colorPickerGrid.innerHTML=Ra.map(t=>`<button type="button" class="color-swatch ${e===t?"selected":""}" style="background-color:${t}" data-color="${t}"></button>`).join("")}function Gt(){if(!s.editingHabit)return;let e=s.editingHabit.formData.frequency,t=e.type==="daily",a=e.type==="specific_days_of_week",n=e.type==="interval",i=[0,1,2,3,4,5,6];s.activeLanguageCode!=="pt"&&i.push(i.shift());let o=a?new Set(e.days):new Set,l=n?e.amount:2,c=n?e.unit:"days";r.frequencyOptionsContainer.innerHTML=`<div class="form-section frequency-options"><div class="form-row"><label><input type="radio" name="frequency-type" value="daily" ${t?"checked":""}>${u("freqDaily")}</label></div><div class="form-row form-row--vertical"><label><input type="radio" name="frequency-type" value="specific_days_of_week" ${a?"checked":""}>${u("freqSpecificDaysOfWeek")}</label><div class="frequency-details ${a?"visible":""}"><div class="weekday-picker">${i.map(d=>`<label><input type="checkbox" class="visually-hidden" data-day="${d}" ${o.has(d)?"checked":""}><span class="weekday-button">${u(`weekday${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d]}`).charAt(0)}</span></label>`).join("")}</div></div></div><div class="form-row form-row--vertical"><label><input type="radio" name="frequency-type" value="interval" ${n?"checked":""}>${u("freqEvery")}</label><div class="frequency-details ${n?"visible":""}"><div class="interval-control-group"><button type="button" class="stepper-btn" data-action="interval-decrement">-</button><span class="interval-amount-display">${ke(l)}</span><button type="button" class="stepper-btn" data-action="interval-increment">+</button><button type="button" class="unit-toggle-btn" data-action="interval-unit-toggle">${u(c==="days"?"unitDays":"unitWeeks",{count:l})}</button></div></div></div></div>`}function Na(){if(!s.editingHabit)return;Gt();let e=s.editingHabit.formData;r.habitTimeContainer.innerHTML=`<div class="segmented-control">${je.map(n=>`<button type="button" class="segmented-control-option ${e.times.includes(n)?"selected":""}" data-time="${n}">${qe(n)}${Ue(n)}</button>`).join("")}</div>`;let t=r.editHabitForm.elements.namedItem("habit-name");t&&(t.placeholder=u("modalEditFormNameLabel"),e.nameKey&&(t.value=u(e.nameKey)));let a=r.habitConscienceDisplay;if(!a&&r.editHabitForm&&(a=document.createElement("div"),a.id="habit-conscience-display",a.className="habit-conscience-text",r.editHabitForm.querySelector(".habit-identity-section")?.insertAdjacentElement("afterend",a)),a){let n=e.philosophy;n?.conscienceKey?(v(a,u(n.conscienceKey)),a.style.display="block"):a.style.display="none"}}function Ba(e,t){let a=!e||!e.id,n=Ie(t||s.selectedDate),i;if(a)i={icon:C.custom,color:Gr(),times:["Morning"],goal:{type:"check"},frequency:{type:"daily"},name:"",subtitleKey:"customHabitSubtitle",...e};else{let p=Oe(e,n)||e.scheduleHistory[0],f=p.frequency,b=f.type==="specific_days_of_week"?{...f,days:[...f.days]}:{...f};i={...p,times:[...p.times],frequency:b,goal:{...p.goal}}}s.editingHabit={isNew:a,habitId:a?void 0:e.id,originalData:a?void 0:e,formData:i,targetDate:n};let o=r.editHabitForm.elements.namedItem("habit-name");o&&(o.value=a?i.nameKey?u(i.nameKey):"":de(e,n).name);let l=r.habitIconPickerBtn;l.innerHTML=i.icon,l.style.backgroundColor=i.color,l.style.color=dt(i.color);let c=a?i.subtitleKey?u(i.subtitleKey):"":de(e,n).subtitle;r.habitSubtitleDisplay&&v(r.habitSubtitleDisplay,c);let d=l.nextElementSibling;d&&d.classList.contains("edit-icon-overlay")&&(d.innerHTML=C.learnSkill),Na(),ie(r.editHabitModal)}function Vt(){r.exploreHabitList.innerHTML=nt.map((t,a)=>`<div 
            class="explore-habit-item" 
            data-index="${a}" 
            role="button" 
            tabindex="0"
            style="--delay: ${a*50}ms;"
        >
            <div class="explore-habit-icon" style="background-color:${t.color}30;color:${t.color}">${t.icon}</div>
            <div class="explore-habit-details">
                <div class="name">${u(t.nameKey)}</div>
                <div class="subtitle">${u(t.subtitleKey)}</div>
            </div>
        </div>`).join("")}function $t(){let e=pe.findIndex(n=>n.code===s.activeLanguageCode),t=pe.map(n=>u(n.nameKey));if(r.languageViewport.classList.contains("is-interacting"))return;let a=r.languageReel.querySelector(".reel-option")?.offsetWidth||95;r.languageReel.style.transform=`translateX(${-e*a}px)`,Nt(r.languageViewport,e,t,"language_ariaLabel")}function fi(){let e=s.syncLogs||[];if(e.length===0)return oe("Nenhum log de sincroniza\xE7\xE3o dispon\xEDvel ainda.",()=>{},{title:"Monitor de Sync",hideCancel:!0});let a=`
        <div style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
            ${e.slice().reverse().map(n=>{let i=new Date(n.time).toLocaleTimeString();return`<div style="font-family:monospace; font-size:11px; padding:6px 0; border-bottom:1px solid var(--border-color); color:${n.type==="error"?"#ff6b6b":n.type==="success"?"#27ae60":"var(--text-secondary)"}">
            <span style="opacity:0.5">[${i}]</span> ${n.icon||""} ${n.msg}
        </div>`}).join("")}
        </div>
    `;oe(a,()=>{},{title:"Monitor de Sincroniza\xE7\xE3o",confirmText:"Fechar",hideCancel:!0})}var ui=null,pi=null,vt=null,mi=null,gi=null,hi=null,Vr={month:"long",day:"numeric",timeZone:"UTC"},$r={weekday:"long",month:"long",day:"numeric",timeZone:"UTC"},Wr={day:"2-digit",month:"2-digit",timeZone:"UTC"};function Yr(e){if(mi!==e){mi=e;let t=k(e);gi=K(se(t,-1)),hi=K(se(t,1))}}function Xr(){if(ui===s.selectedDate&&pi===s.activeLanguageCode)return;let e=I();Yr(e);let t=s.selectedDate,a=null;t===e?a="headerTitleToday":t===gi?a="headerTitleYesterday":t===hi&&(a="headerTitleTomorrow");let n,i,o=k(t),l=ue(o,Wr);if(a){let c=u(a);n=c,i=t===e?c:l}else i=l,n=ue(o,Vr);v(r.headerTitleDesktop,n),v(r.headerTitleMobile,i),r.headerTitle.setAttribute("aria-label",ue(o,$r)),r.navArrowPast.classList.toggle("hidden",!(t<e)),r.navArrowFuture.classList.toggle("hidden",!(t>e)),ui=t,pi=s.activeLanguageCode}function jr(){r.manageHabitsBtn.hasChildNodes()||(r.manageHabitsBtn.innerHTML=z.settings);let e=r.aiEvalBtn.querySelector(".default-icon");e&&!e.hasChildNodes()&&(e.innerHTML=z.ai)}function Fa(){let e=u("appName"),t=document.createElement("div");t.innerHTML=e,document.title=t.textContent||"Askesis",r.fabAddHabit.setAttribute("aria-label",u("fabAddHabit_ariaLabel")),r.manageHabitsBtn.setAttribute("aria-label",u("manageHabits_ariaLabel")),r.aiEvalBtn.setAttribute("aria-label",u("aiEval_ariaLabel")),v(r.exploreModal.querySelector("h2"),u("modalExploreTitle")),v(r.createCustomHabitBtn,u("modalExploreCreateCustom")),v(r.exploreModal.querySelector(".modal-close-btn"),u("closeButton")),v(r.manageModalTitle,u("modalManageTitle")),v(r.habitListTitle,u("modalManageHabitsSubtitle")),v(r.labelLanguage,u("modalManageLanguage")),r.languagePrevBtn.setAttribute("aria-label",u("languagePrev_ariaLabel")),r.languageNextBtn.setAttribute("aria-label",u("languageNext_ariaLabel")),v(r.labelSync,u("syncLabel")),v(r.labelNotifications,u("modalManageNotifications")),v(r.labelReset,u("modalManageReset")),v(r.resetAppBtn,u("modalManageResetButton")),v(r.manageModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.labelPrivacy,u("privacyLabel")),v(r.exportDataBtn,u("exportButton")),v(r.importDataBtn,u("importButton")),v(r.syncInactiveDesc,u("syncInactiveDesc")),v(r.enableSyncBtn,u("syncEnable")),v(r.enterKeyViewBtn,u("syncEnterKey")),v(r.labelEnterKey,u("syncLabelEnterKey")),v(r.cancelEnterKeyBtn,u("cancelButton")),v(r.submitKeyBtn,u("syncSubmitKey")),r.syncWarningText.innerHTML!==u("syncWarning")&&(r.syncWarningText.innerHTML=u("syncWarning")),v(r.keySavedBtn,r.syncDisplayKeyView.dataset.context==="view"?u("closeButton"):u("syncKeySaved")),v(r.syncActiveDesc,u("syncActiveDesc")),v(r.viewKeyBtn,u("syncViewKey")),v(r.disableSyncBtn,u("syncDisable")),v(r.aiModal.querySelector("h2"),u("modalAITitle")),v(r.aiModal.querySelector(".modal-close-btn"),u("closeButton")),v(r.aiOptionsModal.querySelector("h2"),u("modalAIOptionsTitle"));let a=(i,o,l)=>{let c=r.aiOptionsModal.querySelector(`[data-analysis-type="${i}"]`);c&&(v(c.querySelector(".ai-option-title"),u(o)),v(c.querySelector(".ai-option-desc"),u(l)))};a("monthly","aiOptionMonthlyTitle","aiOptionMonthlyDesc"),a("quarterly","aiOptionQuarterlyTitle","aiOptionQuarterlyDesc"),a("historical","aiOptionHistoricalTitle","aiOptionHistoricalDesc"),v(r.confirmModal.querySelector("h2"),u("modalConfirmTitle")),v(r.confirmModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.confirmModalConfirmBtn,u("confirmButton")),v(r.notesModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.saveNoteBtn,u("modalNotesSaveButton")),r.notesTextarea.placeholder=u("modalNotesTextareaPlaceholder"),v(r.iconPickerTitle,u("modalIconPickerTitle")),v(r.iconPickerModal.querySelector(".modal-close-btn"),u("cancelButton")),v(r.colorPickerTitle,u("modalColorPickerTitle")),v(r.colorPickerModal.querySelector(".modal-close-btn"),u("cancelButton"));let n=(i,o,l)=>{let c=`${o} ${l}`;i.innerHTML!==c&&(i.innerHTML=c)};n(r.quickActionDone,z.check,u("quickActionMarkAllDone")),n(r.quickActionSnooze,z.snoozed,u("quickActionMarkAllSnoozed")),n(r.quickActionAlmanac,z.calendar,u("quickActionOpenAlmanac")),v(r.noHabitsMessage,u("modalManageNoHabits")),s.editingHabit&&Na()}function $(){jr(),Xr(),qn(),ei(),"scheduler"in window&&window.scheduler?window.scheduler.postTask(()=>{ye(),_a(),window.scheduler.postTask(()=>it(),{priority:"background"})},{priority:"user-visible"}):requestAnimationFrame(()=>{ye(),_a(),"requestIdleCallback"in window?requestIdleCallback(()=>it()):setTimeout(it,50)}),r.manageModal.classList.contains("visible")&&qt()}function ot(){if(r.notificationToggle.disabled&&!r.notificationToggleLabel.classList.contains("disabled")){v(r.notificationStatusDesc,u("notificationChangePending"));return}Se(t=>{let a=t.User.PushSubscription.optedIn,n=t.Notifications.permission;r.notificationToggle.checked!==a&&(r.notificationToggle.checked=a);let i=n==="denied";r.notificationToggle.disabled!==i&&(r.notificationToggle.disabled=i,r.notificationToggleLabel.classList.toggle("disabled",i));let o="notificationStatusOptedOut";i?o="notificationStatusDisabled":a&&(o="notificationStatusEnabled"),v(r.notificationStatusDesc,u(o))})}function Qr(){let e=pe.map(t=>u(t.nameKey));r.languageReel.innerHTML=e.map(t=>`<span class="reel-option">${t}</span>`).join(""),Nt(r.languageViewport,pe.findIndex(t=>t.code===s.activeLanguageCode),e,"language_ariaLabel")}function ye(){let e=s.pending21DayHabitIds.length>0||s.pendingConsolidationHabitIds.length>0,t=(s.aiState==="completed"||s.aiState==="error")&&!s.hasSeenAIResult;r.aiEvalBtn.classList.toggle("loading",s.aiState==="loading"),r.aiEvalBtn.disabled=s.aiState==="loading",r.aiEvalBtn.classList.toggle("offline",!navigator.onLine),r.aiEvalBtn.classList.toggle("has-notification",e||t)}var Wt=null;function Zr(){Wt||(Wt=e=>{e.target.closest(".stoic-quote")||r.stoicQuoteDisplay.querySelector(".quote-expanded")&&(vt=null,it())},document.addEventListener("click",Wt,{capture:!0}),r.habitContainer.addEventListener("scroll",Wt,{passive:!0}))}function it(){s.dailyDiagnoses[s.selectedDate]||document.dispatchEvent(new CustomEvent("request-analysis",{detail:{date:s.selectedDate}}));let e=new Date().getHours(),t=e<12?"Morning":e<18?"Afternoon":"Evening",a=J(s.selectedDate),n=`${a.completed}/${a.total}`,i=`${s.selectedDate}|${s.activeLanguageCode}|${t}|${n}`;if(vt&&vt.contextKey===i)return;let o;try{o=Pn(da,s.selectedDate)}catch{o=da[0]}vt={id:o.id,contextKey:i};let l=s.dailyDiagnoses[s.selectedDate],c=l?l.level:1,d=s.activeLanguageCode,p=o.adaptations[`level_${c}`][d],f=r.stoicQuoteDisplay;f.classList.remove("visible"),f.innerHTML="";let b=document.createElement("span");b.className="quote-adaptation",b.textContent=p+" ";let E=document.createElement("button");E.className="quote-expander",E.textContent="...",E.setAttribute("aria-label",u("expandQuote")),E.onclick=S=>{S.stopPropagation(),f.innerHTML="";let L=document.createElement("span");L.className="quote-expanded",L.style.fontStyle="italic",L.textContent=`"${o.original_text[d]}" \u2014 ${u(o.author)}`,f.appendChild(L),Zr()},f.appendChild(b),f.appendChild(E),requestAnimationFrame(()=>{if(!b.isConnected)return;let S=b.getClientRects(),L=S.length===1;S.length>1&&Math.abs(S[S.length-1].top-S[0].top)<5&&(L=!0),f.style.justifyContent=L?"flex-end":"flex-start",f.style.textAlign=L?"right":"left",f.classList.add("visible")})}document.addEventListener("language-changed",()=>{Qr(),$t(),Fa(),r.syncStatus&&v(r.syncStatus,u(s.syncState)),$()});document.addEventListener("habitsChanged",()=>{vt=null,"requestIdleCallback"in window?requestIdleCallback(()=>it()):setTimeout(it,1e3)});async function yi(){let e=localStorage.getItem("habitTrackerLanguage"),t=navigator.language.split("-")[0],a=e&&["pt","en","es"].includes(e)?e:["pt","en","es"].includes(t)?t:"pt";await Pt(a)}var Jr="AskesisDB",es=1,Be="app_state",vi="askesis_core_json",Ei="askesis_logs_binary",ts=15e3,as=800,rt=null,Ne,Ge=null,Me=null;function za(){return rt||(rt=new Promise((e,t)=>{let a=setTimeout(()=>{rt=null,t(new Error("Timeout IDB"))},ts),n=indexedDB.open(Jr,es);n.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(Be)||o.createObjectStore(Be)},n.onsuccess=i=>{clearTimeout(a);let o=i.target.result;o.onclose=o.onversionchange=()=>rt=null,e(o)},n.onerror=()=>{clearTimeout(a),rt=null,t(n.error)}})),rt}async function xi(e){let t=await za();return new Promise((a,n)=>{let i=t.transaction(Be,"readwrite"),o=i.objectStore(Be),l=e.monthlyLogs,c={...e};if(delete c.monthlyLogs,o.put(c,vi),l&&l.size>0){let d={};l.forEach((p,f)=>{d[f]=p.toString(16)}),o.put(d,Ei)}i.oncomplete=()=>a(),i.onerror=()=>n(i.error)})}var Ti=null,Si=e=>Ti=e;function ns(e,t){if(e.length===0)return;let a=new Set(e.map(n=>n.id));for(let n in t){for(let i in t[n])a.has(i)||delete t[n][i];Object.keys(t[n]).length===0&&delete t[n]}}async function bi(e=!1,t=!1){Ge&&await Ge,Ge=(async()=>{s.lastModified=Math.max(Date.now(),s.lastModified+1);let a=le();try{await xi(a)}catch(n){console.error("IDB Save Failed:",n)}t||Ti?.(a,e)})();try{await Ge}finally{Ge=null}}function is(){Ne!==void 0&&(clearTimeout(Ne),Ne=void 0),Me&&(Me(),Me=null)}async function ee(e=!1,t=!1){if(Ne!==void 0&&(clearTimeout(Ne),Ne=void 0),e){let a=Me;Me=null,await bi(!0,t),a?.()}else return new Promise(a=>{let n=Me;Me=()=>{n?.(),a()},Ne=self.setTimeout(async()=>{Ne=void 0;let i=Me;Me=null,await bi(!1,t),i?.()},as)})}var Ka=async e=>{Ge&&await Ge;try{await xi(e)}catch(t){console.error("[Persistence] Immediate Cloud Persistence Failed:",t)}};async function Ce(e){let t=e,a;if(!t)try{let n=await za();await new Promise(i=>{let o=n.transaction(Be,"readonly"),l=o.objectStore(Be),c=l.get(vi),d=l.get(Ei);o.oncomplete=()=>{t=c.result,a=d.result,i()},o.onerror=()=>i()})}catch(n){console.warn("[Persistence] Failed to read state from IDB",n)}if(t){a&&!t.monthlyLogs&&(t.monthlyLogs=a);let n=yn(t,ba);s.monthlyLogs=n.monthlyLogs,(!s.monthlyLogs||s.monthlyLogs.size===0)&&a&&typeof a=="object"&&!Array.isArray(a)&&(s.monthlyLogs=new Map,Object.entries(a).forEach(([o,l])=>{s.monthlyLogs.set(o,BigInt("0x"+l))})),s.habits=[...n.habits||[]],s.lastModified=n.lastModified||Date.now(),s.dailyData=n.dailyData||{},s.archives=n.archives||{},s.dailyDiagnoses=n.dailyDiagnoses||{},s.notificationsShown=[...n.notificationsShown||[]],s.pending21DayHabitIds=[...n.pending21DayHabitIds||[]],s.pendingConsolidationHabitIds=[...n.pendingConsolidationHabitIds||[]],s.hasOnboarded=n.hasOnboarded??!0,s.syncLogs=n.syncLogs||[],["streaksCache","scheduleCache","activeHabitsCache","unarchivedCache","habitAppearanceCache","daySummaryCache"].forEach(o=>s[o].clear()),at(),Object.assign(s.uiDirtyState,{calendarVisuals:!0,habitListStructure:!0,chartData:!0});let i=()=>ns(s.habits,s.dailyData);return"scheduler"in window&&window.scheduler&&window.scheduler.postTask(i,{priority:"background"}),document.dispatchEvent(new CustomEvent("render-app")),n}return null}var Li=async()=>{is();try{let t=(await za()).transaction(Be,"readwrite");t.objectStore(Be).clear(),await new Promise(a=>t.oncomplete=a)}catch(e){console.warn("IDB clear failed",e)}s.monthlyLogs=new Map};var Yt="habitTrackerSyncKey",Fe=()=>!!localStorage.getItem(Yt),Ae=()=>localStorage.getItem(Yt),Xt=e=>{e&&localStorage.setItem(Yt,e)},Et=()=>{localStorage.removeItem(Yt)},Di=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e),Ua=null,wi=null;async function os(){let e=Ae();if(!e)return null;if(Ua&&wi===e)return Ua;if(window.crypto&&window.crypto.subtle)try{let a=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",a),o=Array.from(new Uint8Array(n)).map(l=>l.toString(16).padStart(2,"0")).join("");return Ua=o,wi=e,o}catch(t){console.warn("[API] Crypto Digest failed, falling back to raw auth",t)}return null}async function ze(e,t={},a=!1){let n=new Headers(t.headers||{});if(n.has("Content-Type")||n.set("Content-Type","application/json"),a){let l=await os();if(l)n.set("X-Sync-Key-Hash",l),n.set("Authorization",`Bearer ${Ae()}`);else throw new Error("Sync Key missing or environment insecure (No Crypto API).")}let i={...t,headers:n,keepalive:t.method==="POST"},o=await fetch(e,i);return o.status===401&&Fe()&&console.error("[API] Unauthorized. Local key might be revoked."),o}var Mi=async()=>{};function Ci(e){if(e.monthlyLogs&&!(e.monthlyLogs instanceof Map)){let t=Array.isArray(e.monthlyLogs)?e.monthlyLogs:Object.entries(e.monthlyLogs),a=new Map;t.forEach(n=>{let i=(Array.isArray(n),n[0]),o=(Array.isArray(n),n[1]);try{if(o&&typeof o=="object"&&o.__type==="bigint")a.set(i,BigInt(o.val));else if(typeof o=="string"){let l=o.startsWith("0x")?o:"0x"+o;a.set(i,BigInt(l))}else typeof o=="bigint"?a.set(i,o):a.set(i,BigInt(o))}catch(l){console.warn(`[Merge] Failed to hydrate bitmask for ${i}`,l)}}),e.monthlyLogs=a}}function rs(e,t){let a=new Map;return t.forEach(n=>a.set(n.startDate,{...n})),e.forEach(n=>a.set(n.startDate,{...n})),Array.from(a.values()).sort((n,i)=>n.startDate.localeCompare(i.startDate))}function ss(e,t){for(let a in e){if(!t[a]){t[a]=e[a];continue}let n=e[a].instances||{},i=t[a].instances||{};for(let o in n){let l=n[o],c=i[o];l&&(c?((l.note?.length||0)>(c.note?.length||0)&&(c.note=l.note),l.goalOverride!==void 0&&(c.goalOverride=l.goalOverride)):i[o]=l)}e[a].dailySchedule&&(t[a].dailySchedule=e[a].dailySchedule)}}async function xt(e,t){Ci(e),Ci(t);let a=e.lastModified||0,n=t.lastModified||0,i,o;e.habits.length===0&&t.habits.length>0?(i=t,o=e):t.habits.length===0&&e.habits.length>0?(i=e,o=t):(i=a>=n?e:t,o=a>=n?t:e);let l=structuredClone(i),c=new Map;l.habits.forEach(d=>c.set(d.id,d)),o.habits.forEach(d=>{let p=c.get(d.id);p?(p.scheduleHistory=rs(p.scheduleHistory,d.scheduleHistory),d.deletedOn&&(!p.deletedOn||d.deletedOn>p.deletedOn)&&(p.deletedOn=d.deletedOn),d.graduatedOn&&(!p.graduatedOn||d.graduatedOn<p.graduatedOn)&&(p.graduatedOn=d.graduatedOn)):c.set(d.id,d)}),l.habits=Array.from(c.values());for(let d in o.dailyData)l.dailyData[d]?ss(o.dailyData[d],l.dailyData[d]):l.dailyData[d]=o.dailyData[d];return l.monthlyLogs=R.mergeLogs(i.monthlyLogs,o.monthlyLogs),l.lastModified=Math.max(a,n,Date.now())+1,l}var qa=null,ls=2e3,st=!1,St=null,Tt=null,Ga=new Map;function cs(){return Tt||(Tt=new Worker("./sync-worker.js",{type:"module"}),Tt.onmessage=e=>{let{id:t,status:a,result:n,error:i}=e.data,o=Ga.get(t);o&&(a==="success"?o.resolve(n):o.reject(new Error(i)),Ga.delete(t))},Tt.onerror=e=>{console.error("Critical Worker Error:",e)}),Tt}function He(e,t,a){return new Promise((n,i)=>{let o=Xe();Ga.set(o,{resolve:n,reject:i}),cs().postMessage({id:o,type:e,payload:t,key:a})})}function ds(e){let t={};t.core={version:e.version,habits:e.habits,dailyData:e.dailyData,dailyDiagnoses:e.dailyDiagnoses,notificationsShown:e.notificationsShown,hasOnboarded:e.hasOnboarded,quoteState:e.quoteState};let a=R.getLogsGroupedByMonth();for(let n in a)t[`logs:${n}`]=a[n];for(let n in e.archives)t[`archive:${n}`]=e.archives[n];return t}var lt=new Map;function $a(){lt.clear(),console.debug("[Sync] Hash cache cleared.")}function Ai(e,t=0){let a=e.length&3,n=e.length-a,i=t,o=3432918353,l=461845907,c=0;for(;c<n;){let p=e.charCodeAt(c)&255|(e.charCodeAt(++c)&255)<<8|(e.charCodeAt(++c)&255)<<16|(e.charCodeAt(++c)&255)<<24;++c,p=(p&65535)*o+(((p>>>16)*o&65535)<<16)&4294967295,p=p<<15|p>>>17,p=(p&65535)*l+(((p>>>16)*l&65535)<<16)&4294967295,i^=p,i=i<<13|i>>>19,i=i*5+3864292196&4294967295}let d=0;switch(a){case 3:d^=(e.charCodeAt(c+2)&255)<<16;case 2:d^=(e.charCodeAt(c+1)&255)<<8;case 1:d^=e.charCodeAt(c)&255,d=(d&65535)*o+(((d>>>16)*o&65535)<<16)&4294967295,d=d<<15|d>>>17,d=(d&65535)*l+(((d>>>16)*l&65535)<<16)&4294967295,i^=d}return i^=e.length,i^=i>>>16,i=(i&65535)*2246822507+(((i>>>16)*2246822507&65535)<<16)&4294967295,i^=i>>>13,i=(i&65535)*3266489909+(((i>>>16)*3266489909&65535)<<16)&4294967295,i^=i>>>16,(i>>>0).toString(16)}function W(e,t="info",a){s.syncLogs||(s.syncLogs=[]),s.syncLogs.push({time:Date.now(),msg:e,type:t,icon:a}),s.syncLogs.length>50&&s.syncLogs.shift(),console.debug(`[Sync Log] ${e}`)}function Y(e){s.syncState=e,r.syncStatus&&(r.syncStatus.textContent=u(e))}async function us(e){let t=Ae();if(!t)return Y("syncError");try{W("Conflito detectado. Mesclando dados...","info","\u{1F504}");let a={};for(let l in e)if(l!=="lastModified")try{let c=await He("decrypt",e[l],t);a[l]=c}catch(c){console.warn(`[Sync] Failed to decrypt shard ${l}, skipping.`,c)}let n={version:a.core?.version||0,lastModified:parseInt(e.lastModified||"0",10),habits:a.core?.habits||[],dailyData:a.core?.dailyData||{},archives:{},monthlyLogs:new Map,notificationsShown:a.core?.notificationsShown||[],hasOnboarded:a.core?.hasOnboarded??!0};for(let l in a)l.startsWith("archive:")&&(n.archives[l.replace("archive:","")]=a[l]),l.startsWith("logs:")&&a[l].forEach(([c,d])=>n.monthlyLogs.set(c,BigInt(d)));let i=le(),o=await xt(i,n);await Ka(o),await Ce(o),$(),Y("syncSynced"),W("Mesclagem conclu\xEDda.","success","\u2728"),lt.clear(),be(o,!0)}catch(a){W(`Erro na resolu\xE7\xE3o: ${a.message}`,"error","\u274C"),Y("syncError")}}async function Va(){if(st||!St)return;st=!0;let e=St;St=null;let t=Ae();if(!t){Y("syncError"),st=!1;return}try{let a=ds(e),n={},i=0;for(let d in a){let p=Ai(JSON.stringify(a[d])),f=lt.get(d);if(p!==f){let b=await He("encrypt",a[d],t);n[d]=b,lt.set(d,p),i++}}if(i===0){Y("syncSynced"),st=!1;return}W(`Sincronizando ${i} pacotes...`,"info","\u{1F4E4}");let l={lastModified:e.lastModified||Date.now(),shards:n},c=await ze("/api/sync",{method:"POST",body:JSON.stringify(l)},!0);if(c.status===409)lt.clear(),await us(await c.json());else if(c.ok)W("Nuvem atualizada.","success","\u2705"),Y("syncSynced"),document.dispatchEvent(new CustomEvent("habitsChanged"));else{let d=await c.json().catch(()=>({}));throw new Error(d.error||`Erro ${c.status}`)}}catch(a){W(`Falha no envio: ${a.message}`,"error","\u26A0\uFE0F"),Y("syncError")}finally{st=!1,St&&setTimeout(Va,500)}}function be(e,t=!1){Fe()&&(St=e,Y("syncSaving"),qa&&clearTimeout(qa),!st&&(t?Va():qa=window.setTimeout(Va,ls)))}async function Hi(e){let t=Ae();if(t)try{let a={};for(let i in e)if(i!=="lastModified")try{a[i]=await He("decrypt",e[i],t),lt.set(i,Ai(JSON.stringify(a[i])))}catch(o){console.warn(`[Sync] Skip decrypt ${i}`,o)}let n={version:a.core?.version||0,lastModified:parseInt(e.lastModified||"0",10),habits:a.core?.habits||[],dailyData:a.core?.dailyData||{},archives:{},monthlyLogs:new Map,notificationsShown:a.core?.notificationsShown||[],hasOnboarded:a.core?.hasOnboarded??!0,quoteState:a.core?.quoteState};for(let i in a)i.startsWith("archive:")&&(n.archives[i.replace("archive:","")]=a[i]),i.startsWith("logs:")&&a[i].forEach(([o,l])=>n.monthlyLogs.set(o,BigInt(l)));return n}catch(a){console.error("State reconstruction failed:",a);return}}async function Ii(){W("Baixando dados remotos...","info","\u{1F50D}");let e=await ze("/api/sync",{},!0);if(e.status===304){W("Sem novidades na nuvem.","info","\u{1F4A4}");return}if(!e.ok)throw new Error("Falha na conex\xE3o com a nuvem");let t=await e.json();if(!t||Object.keys(t).length===0){W("Cofre vazio na nuvem.","info","\u{1F32B}\uFE0F");return}return W("Dados baixados com sucesso.","success","\u{1F4E5}"),await Hi(t)}async function ki(){if(!Fe()){s.initialSyncDone=!0;return}Y("syncSaving");try{let e=await ze("/api/sync",{},!0);if(e.status===304){s.initialSyncDone=!0,Y("syncSynced");return}if(!e.ok)throw new Error("Cloud fetch failed with status "+e.status);let t=await e.json();if(!t||Object.keys(t).length===0){s.initialSyncDone=!0;return}let a=await Hi(t);if(!a){s.initialSyncDone=!0;return}let n=le(),i=a.lastModified||0,o=n.lastModified||0;if(i>o){W("Atualiza\xE7\xE3o remota detectada.","info","\u2601\uFE0F");let l=await xt(n,a);await Ka(l),await Ce(l),$()}else o>i?(W("Sincronizando mudan\xE7as locais...","info","\u{1F680}"),be(n,!0)):Y("syncSynced");return a}catch(e){console.warn("[Cloud] Boot sync failed (Offline or Error). Proceeding locally.",e),Y("syncError");return}finally{s.initialSyncDone=!0}}var ps=90,Wa=[],Ya=[],Xa=!1,G={isLocked:!1,drop:null,removal:null,ending:null,deletion:null,reset(){this.isLocked=!1,this.drop=this.removal=this.ending=this.deletion=null}};function Ve(e=!1,t=!1){e&&(fn(),at(),On()),pt(),s.uiDirtyState.habitListStructure=s.uiDirtyState.calendarVisuals=!0,s.initialSyncDone?s.lastModified=Math.max(Date.now(),(s.lastModified||0)+1):s.lastModified=s.lastModified+1,document.body.classList.remove("is-interaction-active","is-dragging-active"),ee(t),requestAnimationFrame(()=>{["render-app","habitsChanged"].forEach(a=>document.dispatchEvent(new CustomEvent(a)))})}function _i(e,t){xa(e,t),s.uiDirtyState.calendarVisuals=!0,s.initialSyncDone?s.lastModified=Math.max(Date.now(),(s.lastModified||0)+1):s.lastModified=s.lastModified+1,ee(),["render-app","habitsChanged"].forEach(a=>document.dispatchEvent(new CustomEvent(a)))}function jt(e){if(G.isLocked)return null;G.isLocked=!0;let t=s.habits.find(a=>a.id===e);return t||G.reset(),t}function Lt(e,t,a,n=!1){let i=s.habits.find(c=>c.id===e);if(!i||!/^\d{4}-\d{2}-\d{2}$/.test(t))return;let o=i.scheduleHistory,l=o.findIndex(c=>t>=c.startDate&&(!c.endDate||t<c.endDate));if(l!==-1){let c=o[l];c.startDate===t?o[l]=a({...c}):(c.endDate=t,o.push(a({...c,startDate:t,endDate:void 0})))}else{let c=o[o.length-1];c&&(c.endDate&&c.endDate>t&&(c.endDate=t),o.push(a({...c,startDate:t,endDate:void 0})))}o.sort((c,d)=>c.startDate.localeCompare(d.startDate)),i.graduatedOn=void 0,Ve(!0,n)}function Ri(e,t){let a=De(e,t),n=a===ut?s.pending21DayHabitIds:a===Ke?s.pendingConsolidationHabitIds:null;n&&!s.notificationsShown.includes(`${e.id}-${a}`)&&!n.includes(e.id)&&(n.push(e.id),ye())}var ms=()=>{let e=G.drop,t=Ie(s.selectedDate);if(!e)return G.reset();let a=s.habits.find(n=>n.id===e.habitId);if(a){let n=Qe(t,e.habitId),i=[...fe(a,t)],o=i.indexOf(e.fromTime);o>-1&&i.splice(o,1),i.includes(e.toTime)||i.push(e.toTime);let l=R.getStatus(e.habitId,t,e.fromTime);l!==A.NULL&&(R.setStatus(e.habitId,t,e.toTime,l),R.setStatus(e.habitId,t,e.fromTime,A.NULL)),n.instances[e.fromTime]&&(n.instances[e.toTime]=n.instances[e.fromTime],delete n.instances[e.fromTime]),n.dailySchedule=i,e.reorderInfo&&Qt(e.habitId,e.reorderInfo.id,e.reorderInfo.pos,!0),Ve(!1)}G.reset()},fs=()=>{let e=G.drop,t=Ie(s.selectedDate);if(!e)return G.reset();let a=Qe(t,e.habitId);a.dailySchedule=void 0;let n=R.getStatus(e.habitId,t,e.fromTime);n!==A.NULL&&(R.setStatus(e.habitId,t,e.toTime,n),R.setStatus(e.habitId,t,e.fromTime,A.NULL)),a.instances[e.fromTime]&&(a.instances[e.toTime]=a.instances[e.fromTime],delete a.instances[e.fromTime]),e.reorderInfo&&Qt(e.habitId,e.reorderInfo.id,e.reorderInfo.pos,!0),Lt(e.habitId,t,i=>{let o=[...i.times],l=o.indexOf(e.fromTime);return l>-1&&o.splice(l,1),o.includes(e.toTime)||o.push(e.toTime),{...i,times:o}}),G.reset()},gs=async()=>{let e=G.deletion;if(!e)return;let t=s.habits.find(a=>a.id===e.habitId);if(!t)return G.reset();t.deletedOn=t.createdOn,R.pruneLogsForHabit(t.id),Object.keys(s.dailyData).forEach(a=>{s.dailyData[a][t.id]&&(delete s.dailyData[a][t.id],Object.keys(s.dailyData[a]).length===0&&delete s.dailyData[a])}),He("prune-habit",{habitId:t.id,archives:s.archives}).then(a=>{Object.keys(a).forEach(n=>{a[n]===""?delete s.archives[n]:s.archives[n]=a[n]}),s.unarchivedCache.clear(),ee()}).catch(a=>console.error("Archive pruning failed",a)),Ve(!0,!0),G.reset()};function Pi(){let e=async()=>{let t=K(se(k(I()),-ps)),a={},n=[];if(Object.keys(s.dailyData).forEach(i=>{if(i<t){let o=i.substring(0,4);a[o]??(a[o]={additions:{},base:s.unarchivedCache.get(o)||s.archives[o]}),a[o].additions[i]=s.dailyData[i],n.push(i)}}),n.length!==0)try{let i=await He("archive",a);Object.keys(i).forEach(o=>{s.archives[o]=i[o],s.unarchivedCache.delete(o),Object.keys(a[o].additions).forEach(l=>delete s.dailyData[l])}),await ee()}catch(i){console.error(i)}};"requestIdleCallback"in window?requestIdleCallback(()=>e()):setTimeout(e,5e3)}function Qt(e,t,a,n=!1){let i=s.habits,o=i.findIndex(d=>d.id===e),l=i.findIndex(d=>d.id===t);if(o===-1||l===-1)return;let[c]=i.splice(o,1);i.splice(a==="before"?o<l?l-1:l:o<l?l:l+1,0,c),n||Ve(!1)}function Ni(){if(!s.editingHabit)return;let{isNew:e,habitId:t,formData:a,targetDate:n}=s.editingHabit;a.name&&(a.name=a.name.replace(/[<>{}]/g,"").trim());let i=a.nameKey?u(a.nameKey):a.name;if(!i)return;let o={...a,times:[...a.times],goal:{...a.goal},frequency:a.frequency.type==="specific_days_of_week"?{...a.frequency,days:[...a.frequency.days]}:{...a.frequency}};if(Q(r.editHabitModal),e){let l=s.habits.find(c=>{let d=c.scheduleHistory[c.scheduleHistory.length-1];return c.graduatedOn||c.deletedOn||d.endDate&&n>=d.endDate?!1:de(c,n).name.trim().toLowerCase()===i.trim().toLowerCase()});l?Lt(l.id,n,c=>({...c,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy??c.philosophy,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,times:o.times,frequency:o.frequency})):(s.habits.push({id:Xe(),createdOn:n,scheduleHistory:[{startDate:n,times:o.times,frequency:o.frequency,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,scheduleAnchor:n,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy}]}),Ve(!0))}else{let l=s.habits.find(c=>c.id===t);if(!l)return;Qe(n,l.id).dailySchedule=void 0,n<l.createdOn&&(l.createdOn=n),Lt(l.id,n,c=>({...c,icon:o.icon,color:o.color,goal:o.goal,philosophy:o.philosophy??c.philosophy,name:o.name,nameKey:o.nameKey,subtitleKey:o.subtitleKey,times:o.times,frequency:o.frequency}))}}async function Bi(e){if(s.aiState==="loading")return;let t=++s.aiReqId;s.aiState="loading",s.hasSeenAIResult=!1,ye(),Q(r.aiOptionsModal),W(`Iniciando an\xE1lise IA (${e})...`,"info","\u{1F916}");try{let a={promptTemplate:u(e==="monthly"?"aiPromptMonthly":e==="quarterly"?"aiPromptQuarterly":"aiPromptGeneral"),aiDaysUnit:u("unitDays",{count:2})};["aiPromptGraduatedSection","aiPromptNoData","aiPromptNone","aiSystemInstruction","aiPromptHabitDetails","aiVirtue","aiDiscipline","aiSphere","stoicVirtueWisdom","stoicVirtueCourage","stoicVirtueJustice","stoicVirtueTemperance","stoicDisciplineDesire","stoicDisciplineAction","stoicDisciplineAssent","governanceSphereBiological","governanceSphereStructural","governanceSphereSocial","governanceSphereMental","aiPromptNotesSectionHeader","aiStreakLabel","aiSuccessRateLabelMonthly","aiSuccessRateLabelQuarterly","aiSuccessRateLabelHistorical","aiHistoryChange","aiHistoryChangeFrequency","aiHistoryChangeGoal","aiHistoryChangeTimes"].forEach(c=>a[c]=u(c)),nt.forEach(c=>a[c.nameKey]=u(c.nameKey));let n=R.serializeLogsForCloud(),{prompt:i,systemInstruction:o}=await He("build-ai-prompt",{analysisType:e,habits:s.habits,dailyData:s.dailyData,archives:s.archives,monthlyLogsSerialized:n,languageName:Rt(),translations:a,todayISO:I()});if(t!==s.aiReqId)return;let l=await ze("/api/analyze",{method:"POST",body:JSON.stringify({prompt:i,systemInstruction:o})});t===s.aiReqId&&(s.lastAIResult=await l.text(),s.aiState="completed",W("An\xE1lise IA conclu\xEDda.","success","\u2728"))}catch(a){t===s.aiReqId&&(s.lastAIError=String(a),s.aiState="error",s.lastAIResult=u("aiErrorGeneric"),W("Erro na an\xE1lise IA.","error","\u274C"))}finally{t===s.aiReqId&&(ee(),ye())}}function Fi(){let e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async t=>{let a=t.target.files?.[0];if(a)try{let n=JSON.parse(await a.text());if(n.habits&&n.version)await Ce(n),await ee(),["render-app","habitsChanged"].forEach(i=>document.dispatchEvent(new CustomEvent(i))),Q(r.manageModal),oe(u("importSuccess"),()=>{},{title:u("privacyLabel"),confirmText:"OK",hideCancel:!0});else throw 0}catch{oe(u("importError"),()=>{},{title:u("importError"),confirmText:"OK",hideCancel:!0,confirmButtonStyle:"danger"})}},e.click()}function zi(e,t,a){if(!s.initialSyncDone)return;let n=R.getStatus(e,a,t),i=A.DONE;n===A.DONE||n===A.DONE_PLUS?i=A.DEFERRED:n===A.DEFERRED&&(i=A.NULL),R.setStatus(e,a,t,i),ee();let o=s.habits.find(l=>l.id===e);i===A.DONE?(o&&Ri(o,a),M("light")):i===A.DEFERRED?M("medium"):M("selection"),document.dispatchEvent(new CustomEvent("card-status-changed",{detail:{habitId:e,time:t,date:a}})),_i(a,[e])}function Ki(e,t){if(Xa||!s.initialSyncDone)return!1;Xa=!0;let a=k(e),n=!1;Wa.length=Ya.length=0;try{s.habits.forEach(i=>{if(!et(i,e,a))return;let o=fe(i,e);if(!o.length)return;let l=t==="completed"?A.DONE:A.DEFERRED;o.forEach(c=>{R.getStatus(i.id,e,c)!==l&&(R.setStatus(i.id,e,c,l),n=!0)}),n&&(Wa.push(i.id),Ya.push(i))}),n&&(xa(e,Wa),t==="completed"&&Ya.forEach(i=>Ri(i,e)),Ve(!1))}finally{Xa=!1}return n}function Ui(e,t,a,n){if(!s.initialSyncDone)return;let i=jt(e);i&&(G.drop={habitId:e,fromTime:t,toTime:a,reorderInfo:n},oe(u("confirmHabitMove",{habitName:de(i,s.selectedDate).name,oldTime:Ue(t),newTime:Ue(a)}),fs,{title:u("modalMoveHabitTitle"),confirmText:u("buttonFromNowOn"),editText:u("buttonJustToday"),onEdit:ms,onCancel:()=>G.reset()}))}function Zt(e){if(!s.initialSyncDone)return;let t=jt(e),a=Ie(s.selectedDate);t&&(G.ending={habitId:e,targetDate:a},oe(u("confirmEndHabit",{habitName:de(t,a).name,date:ue(k(a),{day:"numeric",month:"long",timeZone:"UTC"})}),()=>{Lt(e,a,n=>({...n,endDate:a}),!0),G.reset()},{confirmButtonStyle:"danger",confirmText:u("endButton"),onCancel:()=>G.reset()}))}function qi(e){s.initialSyncDone&&jt(e)&&(G.deletion={habitId:e},oe(u("confirmPermanentDelete",{habitName:de(s.habits.find(t=>t.id===e)).name}),gs,{confirmButtonStyle:"danger",confirmText:u("deleteButton"),onCancel:()=>G.reset()}))}function Gi(e){if(!s.initialSyncDone)return;let t=s.habits.find(a=>a.id===e);t&&(t.graduatedOn=Ie(s.selectedDate),Ve(!0,!0),M("success"))}async function Vi(){s.habits=[],s.dailyData={},s.archives={},s.notificationsShown=[],s.pending21DayHabitIds=[],s.pendingConsolidationHabitIds=[],s.monthlyLogs=new Map,document.dispatchEvent(new CustomEvent("render-app"));try{await Li()}catch(e){console.error(e)}finally{Et(),window.location.reload()}}function $i(){if(!s.editingNoteFor)return;let{habitId:e,date:t,time:a}=s.editingNoteFor,n=r.notesTextarea.value.trim(),i=Ea(t,e,a);(i.note||"")!==n&&(i.note=n||void 0,s.uiDirtyState.habitListStructure=!0,ee(),document.dispatchEvent(new CustomEvent("render-app"))),Q(r.notesModal)}function ja(e,t,a,n){if(s.initialSyncDone)try{let i=s.habits.find(l=>l.id===e);if(!i)return;Ea(t,e,a).goalOverride=n;let o=R.getStatus(e,t,a);if(o===A.DONE||o===A.DONE_PLUS){let l=_e(i,t);l?.goal?.total&&n>l.goal.total?o!==A.DONE_PLUS&&R.setStatus(e,t,a,A.DONE_PLUS):o!==A.DONE&&R.setStatus(e,t,a,A.DONE)}ee(),document.dispatchEvent(new CustomEvent("card-goal-changed",{detail:{habitId:e,time:a,date:t}})),_i(t,[e])}catch(i){console.error(i)}}function Wi(e,t){if(!s.initialSyncDone)return;let a=jt(e),n=Ie(s.selectedDate);a&&(G.removal={habitId:e,time:t,targetDate:n},oe(u("confirmRemoveTimePermanent",{habitName:de(a,n).name,time:Ue(t)}),()=>{Qe(n,e).dailySchedule=void 0,Lt(e,n,i=>({...i,times:i.times.filter(o=>o!==t)}),!0),G.reset()},{title:u("modalRemoveTimeTitle"),confirmText:u("deleteButton"),confirmButtonStyle:"danger",onCancel:()=>G.reset()}))}function Yi(){let e=le(),t=R.serializeLogsForCloud();t.length>0&&(e.monthlyLogsSerialized=t);let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=`askesis-backup-${I()}.json`,i.click(),URL.revokeObjectURL(n)}function Xi(){let e=I();pt(),s.uiDirtyState.calendarVisuals=s.uiDirtyState.habitListStructure=s.uiDirtyState.chartData=!0,s.calendarDates=[],s.selectedDate!==e&&(s.selectedDate=e),document.dispatchEvent(new CustomEvent("render-app"))}function Oi(e,t,a){if(e.length===0)return"";let n=e.map(o=>s.habits.find(l=>l.id===o)).filter(Boolean).map(o=>de(o).name),i=Dn(n);return e.forEach(o=>{let l=`${o}-${a}`;s.notificationsShown.includes(l)||s.notificationsShown.push(l)}),u(t,{count:e.length,habitNames:i})}function ji(){let e=Oi(s.pending21DayHabitIds,"aiCelebration21Day",ut),a=[Oi(s.pendingConsolidationHabitIds,"aiCelebration66Day",Ke),e].filter(Boolean).join(`

`);return a&&(s.pending21DayHabitIds=[],s.pendingConsolidationHabitIds=[],ee()),a}function Qi({viewportEl:e,reelEl:t,prevBtn:a,nextBtn:n,optionsCount:i,getInitialIndex:o,onIndexChange:l,render:c}){let d=o(),p=0,f=95,b=typeof window<"u"&&!!(t.attributeStyleMap&&window.CSSTranslate&&window.CSS&&CSS.px),E=(P,V)=>{let Te=-(P*f)|0;p=Te,V?t.style.transition="":t.style.transition="none",b&&t.attributeStyleMap?t.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(Te),CSS.px(0))):t.style.transform=`translateX(${Te}px)`},S=async P=>{let V;P==="next"?V=(d+1)%i:V=(d-1+i)%i,await l(V),d=o(),c(),E(d,!0)};a.addEventListener("click",()=>S("prev")),n.addEventListener("click",()=>S("next")),e.addEventListener("keydown",P=>{P.key==="ArrowRight"?S("next"):P.key==="ArrowLeft"&&S("prev")});let L=0,O=!1,B=0,_=0;new ResizeObserver(P=>{_&&cancelAnimationFrame(_),_=requestAnimationFrame(()=>{for(let V of P){let Te=V.target.firstElementChild;Te&&(f=Te.clientWidth,E(d,!1))}})}).observe(t);let re=40,j=P=>{if(!O)return;P.preventDefault();let V=P.clientX-L|0,Te=B+V|0,sn=-((i-1)*f),ve=Math.max(sn,Math.min(0,Te));p=ve,b&&t.attributeStyleMap?t.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(ve),CSS.px(0))):t.style.transform=`translateX(${ve}px)`},ae=P=>{if(window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",he),window.removeEventListener("pointercancel",ae),!!O){O=!1,e.classList.remove("is-interacting"),document.body.classList.remove("is-interaction-active");try{e.hasPointerCapture(P.pointerId)&&e.releasePointerCapture(P.pointerId)}catch{}requestAnimationFrame(()=>{t.style.transition=""}),d=o(),c(),E(d,!0)}},he=async P=>{if(!O)return;window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",he);let V=P.clientX-L;document.body.classList.remove("is-interaction-active"),Math.abs(V)>re&&(V<0?await l((d+1)%i):await l((d-1+i)%i)),ae(P)};e.addEventListener("pointerdown",P=>{P.button===0&&(L=P.clientX,O=!0,d=o(),e.setPointerCapture(P.pointerId),e.classList.add("is-interacting"),document.body.classList.add("is-interaction-active"),B=p,t.style.transition="none",window.addEventListener("pointermove",j,{passive:!1}),window.addEventListener("pointerup",he),window.addEventListener("pointercancel",ae))}),E(d,!1)}var Qa=50;function Zi(e){s.selectedDate=e,Q(r.fullCalendarModal),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,hn(),$(),requestAnimationFrame(()=>{r.calendarStrip.querySelector(".day-item.selected")?.scrollIntoView({behavior:"auto",block:"nearest",inline:"center"})})}function hs(e){let t=r.editHabitForm.querySelector(".form-notice"),a=r.editHabitForm.elements.namedItem("habit-name"),n=e.trim(),i=null,o=n.length===0;o?i="noticeNameCannotBeEmpty":n.length>16&&(i="noticeNameTooLong");let l=!o;if(!i)t.classList.contains("visible")&&(t.classList.remove("visible"),a.classList.remove("shake"));else{let c=u(i);t.textContent!==c&&(t.textContent=c),t.classList.contains("visible")||(t.classList.add("visible"),o&&requestAnimationFrame(()=>{a.classList.add("shake"),a.addEventListener("animationend",()=>a.classList.remove("shake"),{once:!0})}))}return r.editHabitSaveBtn.disabled=o,l}var ys=()=>{r.manageModal.classList.contains("visible")||(M("light"),qt(),ot(),ie(r.manageModal))},bs=()=>{r.exploreModal.classList.contains("visible")||(M("light"),Vt(),ie(r.exploreModal))},vs=e=>{let a=e.target.closest("button");if(!a)return;let n=a.closest("li.habit-list-item")?.dataset.habitId;n&&(r.confirmModal.classList.contains("visible")||(M("light"),a.classList.contains("end-habit-btn")?Zt(n):a.classList.contains("permanent-delete-habit-btn")?qi(n):a.classList.contains("graduate-habit-btn")&&Gi(n)))},Es=e=>{let t=e.target;t.id==="export-data-btn"?Yi():t.id==="import-data-btn"&&Fi()},xs=()=>{r.confirmModal.classList.contains("visible")||(M("light"),oe(u("confirmResetApp"),Vi,{confirmText:u("modalManageResetButton"),title:u("modalManageReset"),confirmButtonStyle:"danger"}))},Ts=()=>{Se(async e=>{r.notificationToggle.checked?await e.Notifications.requestPermission():await e.User.PushSubscription.optOut(),r.notificationToggle.disabled=!0,v(r.notificationStatusDesc,u("notificationChangePending"))})},Ss=e=>{let t=e.target.closest(".explore-habit-item");if(!t)return;M("light");let a=parseInt(t.dataset.index,10),n=nt[a];n&&(Q(r.exploreModal),Ba(n))},Ls=e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();let t=e.target.closest(".explore-habit-item");t&&t.click()}},ws=()=>{M("light"),Q(r.exploreModal),Ba(null)},Ds=async()=>{if(s.aiState==="loading"||r.aiModal.classList.contains("visible")||r.aiOptionsModal.classList.contains("visible"))return;if(M("light"),!navigator.onLine){try{let{STOIC_QUOTES:a}=await import("./quotes-PA7LB5UR.js"),n=a.filter(f=>f.metadata.tags.includes("control")||f.metadata.tags.includes("acceptance")||f.metadata.tags.includes("perception")),i=n.length>0?n:a,o=i[Math.floor(Math.random()*i.length)],l=s.activeLanguageCode,c=o.original_text[l],d=u(o.author),p=`
                <div class="offline-header">
                    <h3 class="offline-title">${u("aiOfflineTitle")}</h3>
                    <p class="offline-desc">${u("aiOfflineMessage")}</p>
                </div>
                <div class="offline-quote-box">
                    <blockquote class="offline-quote-text">
                        "${c}"
                    </blockquote>
                    <div class="offline-quote-author">
                        \u2014 ${d}
                    </div>
                </div>
            `;r.aiResponse.innerHTML=p,ie(r.aiModal)}catch(a){console.error("Failed to load offline quote",a)}return}let e="",t=ji();t?(e=ya(t),ye()):(s.aiState==="completed"||s.aiState==="error")&&!s.hasSeenAIResult&&s.lastAIResult&&(e=ya(s.lastAIResult)),e?(r.aiResponse.innerHTML=e,ie(r.aiModal,void 0,()=>{s.hasSeenAIResult=!0,ye()})):ie(r.aiOptionsModal)},Ms=e=>{let t=e.target.closest(".ai-option-btn");if(!t)return;M("light");let a=t.dataset.analysisType;Bi(a)},Cs=()=>{M("light");let e=s.confirmAction;try{e?.()}catch(t){console.error("Action execution failed",t)}s.confirmAction=null,s.confirmEditAction=null,Q(r.confirmModal,!0)},As=()=>{M("light");let e=s.confirmEditAction;try{e?.()}catch(t){console.error("Edit Action execution failed",t)}s.confirmAction=null,s.confirmEditAction=null,Q(r.confirmModal,!0)},Hs=()=>{s.fullCalendar.month--,s.fullCalendar.month<0&&(s.fullCalendar.month=11,s.fullCalendar.year--),Re()},Is=()=>{s.fullCalendar.month++,s.fullCalendar.month>11&&(s.fullCalendar.month=0,s.fullCalendar.year++),Re()},ks=e=>{let t=e.target.closest(".full-calendar-day");t&&t.dataset.date&&Zi(t.dataset.date)},Os=e=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(e.key))return;if(e.preventDefault(),e.key==="Enter"||e.key===" "){Zi(s.selectedDate);return}let t=k(s.selectedDate),a;switch(e.key){case"ArrowRight":a=se(t,1);break;case"ArrowLeft":a=se(t,-1);break;case"ArrowUp":a=se(t,-7);break;case"ArrowDown":a=se(t,7);break;default:return}s.selectedDate=K(a),(a.getUTCMonth()!==s.fullCalendar.month||a.getUTCFullYear()!==s.fullCalendar.year)&&(s.fullCalendar.month=a.getUTCMonth(),s.fullCalendar.year=a.getUTCFullYear()),Re(),requestAnimationFrame(()=>{r.fullCalendarGrid.querySelector(`.full-calendar-day[data-date="${s.selectedDate}"]`)?.focus()})},_s=()=>{if(!s.editingHabit)return;let e=r.editHabitForm.elements.namedItem("habit-name"),t=e.value;t.length>Qa&&(t=t.substring(0,Qa),e.value=t),s.editingHabit.formData.nameKey&&(delete s.editingHabit.formData.nameKey,s.editingHabit.formData.subtitleKey="customHabitSubtitle",r.habitSubtitleDisplay&&v(r.habitSubtitleDisplay,u("customHabitSubtitle"))),s.editingHabit.formData.name=t,hs(t)},Rs=()=>{Pa(),ie(r.iconPickerModal)},Ps=e=>{let a=e.target.closest(".icon-picker-item");if(a&&s.editingHabit){M("light");let n=a.dataset.iconSvg;s.editingHabit.formData.icon=n,r.habitIconPickerBtn.innerHTML=n,Q(r.iconPickerModal)}},Ns=e=>{let a=e.target.closest(".color-swatch");if(a&&s.editingHabit){M("light");let n=a.dataset.color;s.editingHabit.formData.color=n;let i=dt(n);r.habitIconPickerBtn.style.backgroundColor=n,r.habitIconPickerBtn.style.color=i,r.colorPickerGrid.querySelector(".selected")?.classList.remove("selected"),a.classList.add("selected"),r.iconPickerGrid.style.setProperty("--current-habit-bg-color",n),r.iconPickerGrid.style.setProperty("--current-habit-fg-color",i),r.iconPickerModal.classList.remove("is-picking-color"),Q(r.colorPickerModal,!0)}},Bs=()=>{di(),r.iconPickerModal.classList.add("is-picking-color"),ie(r.colorPickerModal,void 0,()=>{r.iconPickerModal.classList.remove("is-picking-color"),Pa()})},Fs=e=>{if(!s.editingHabit)return;let t=e.target.closest(".segmented-control-option");if(!t)return;M("light");let a=t.dataset.time;s.editingHabit.formData.times.includes(a)?(s.editingHabit.formData.times=s.editingHabit.formData.times.filter(i=>i!==a),t.classList.remove("selected")):(s.editingHabit.formData.times.push(a),t.classList.add("selected"))},zs=e=>{let t=e.target;if(s.editingHabit){if(t.matches('input[name="frequency-type"]')){switch(t.value){case"daily":s.editingHabit.formData.frequency={type:"daily"};break;case"specific_days_of_week":let i=s.editingHabit.formData.frequency,o=i.type==="specific_days_of_week"?i.days:[];s.editingHabit.formData.frequency={type:"specific_days_of_week",days:o};break;case"interval":let l=pn.find(f=>f.value.type==="interval").value,c=s.editingHabit.formData.frequency,d=c.type==="interval"?c.amount:l.amount,p=c.type==="interval"?c.unit:l.unit;s.editingHabit.formData.frequency={type:"interval",amount:d,unit:p};break}Gt()}else if(t.closest(".weekday-picker input")){let a=Array.from(r.frequencyOptionsContainer.querySelectorAll(".weekday-picker input:checked")).map(n=>parseInt(n.dataset.day,10));s.editingHabit.formData.frequency={type:"specific_days_of_week",days:a}}}},Ks=e=>{let a=e.target.closest(".stepper-btn, .unit-toggle-btn");if(!a||!s.editingHabit||s.editingHabit.formData.frequency.type!=="interval")return;let n=a.dataset.action,i=s.editingHabit.formData.frequency,{amount:o,unit:l}=i;n==="interval-decrement"&&(o=Math.max(1,o-1)),n==="interval-increment"&&(o=Math.min(99,o+1)),n==="interval-unit-toggle"&&(l=l==="days"?"weeks":"days"),s.editingHabit.formData.frequency={type:"interval",amount:o,unit:l},Gt()};function Ji(){r.manageHabitsBtn.addEventListener("click",ys),r.fabAddHabit.addEventListener("click",bs),r.habitList.addEventListener("click",vs),r.manageModal.addEventListener("click",Es),r.resetAppBtn.addEventListener("click",xs),r.notificationToggle.addEventListener("change",Ts),Qi({viewportEl:r.languageViewport,reelEl:r.languageReel,prevBtn:r.languagePrevBtn,nextBtn:r.languageNextBtn,optionsCount:pe.length,getInitialIndex:()=>pe.findIndex(t=>t.code===s.activeLanguageCode),onIndexChange:async t=>{let a=pe[t].code;a!==s.activeLanguageCode&&await Pt(a)},render:$t}),r.exploreHabitList.addEventListener("click",Ss),r.exploreHabitList.addEventListener("keydown",Ls),r.createCustomHabitBtn.addEventListener("click",ws),r.aiEvalBtn.addEventListener("click",Ds),r.aiOptionsModal.addEventListener("click",Ms),r.confirmModalConfirmBtn.addEventListener("click",Cs),r.confirmModalEditBtn.addEventListener("click",As),r.saveNoteBtn.addEventListener("click",()=>{M("light"),$i()}),r.fullCalendarPrevBtn.addEventListener("click",Hs),r.fullCalendarNextBtn.addEventListener("click",Is),r.fullCalendarGrid.addEventListener("click",ks),r.fullCalendarGrid.addEventListener("keydown",Os),r.editHabitSaveBtn.addEventListener("click",()=>{M("light"),Ni()});let e=r.editHabitForm.elements.namedItem("habit-name");e.maxLength=Qa,e.addEventListener("input",_s),r.habitIconPickerBtn.addEventListener("click",Rs),r.iconPickerGrid.addEventListener("click",Ps),r.colorPickerGrid.addEventListener("click",Ns),r.changeColorFromPickerBtn.addEventListener("click",Bs),r.habitTimeContainer.addEventListener("click",Fs),r.frequencyOptionsContainer.addEventListener("change",zs),r.frequencyOptionsContainer.addEventListener("click",Ks)}var eo=5,Jt=9999,Us=`${F.HABIT_CONTENT_WRAPPER}, ${F.GOAL_CONTROL_BTN}, ${F.GOAL_VALUE_WRAPPER}, ${F.SWIPE_DELETE_BTN}, ${F.SWIPE_NOTE_BTN}, ${F.EMPTY_GROUP_PLACEHOLDER}`,qs=(e,t)=>{let a=document.createElement("span");a.className="ripple";let n=t.getBoundingClientRect(),i=Math.max(n.width,n.height),o=e.clientX-n.left-i/2,l=e.clientY-n.top-i/2;a.style.width=a.style.height=`${i}px`,a.style.left=`${o}px`,a.style.top=`${l}px`,t.appendChild(a),a.addEventListener("animationend",()=>a.remove(),{once:!0})},Gs=(e,t,a)=>{if(e.querySelector("input"))return;let n=s.habits.find(d=>d.id===t);if(!n)return;let i=Je(n,s.selectedDate,a),o=e.innerHTML;e.innerHTML="";let l=document.createElement("input");l.type="number",l.value=String(i),l.className="goal-input-inline",l.min="1",l.max=String(Jt),l.addEventListener("click",d=>d.stopPropagation());let c=()=>{let d=parseInt(l.value,10);(isNaN(d)||d<1)&&(d=1),d>Jt&&(d=Jt),d!==i?(ja(t,s.selectedDate,a,d),M("medium")):e.innerHTML=o};l.addEventListener("blur",c),l.addEventListener("keydown",d=>{d.key==="Enter"&&l.blur()}),e.appendChild(l),l.focus()},Vs=e=>{let t=e.target.closest(Us);if(!t)return;if(t.classList.contains(y.EMPTY_GROUP_PLACEHOLDER)){M("light"),Vt(),ie(r.exploreModal);return}let a=t.closest(F.HABIT_CARD),{habitId:n,time:i}=a?.dataset||{};if(!n||!i)return;let o=i;if(t.classList.contains(y.SWIPE_DELETE_BTN)){M("light");let l=s.habits.find(c=>c.id===n);l&&fe(l,s.selectedDate).length<=1?Zt(n):Wi(n,o);return}if(t.classList.contains(y.SWIPE_NOTE_BTN)){M("light"),ci(n,s.selectedDate,o);return}if(t.classList.contains(y.GOAL_VALUE_WRAPPER)){e.stopPropagation(),Gs(t,n,o);return}if(t.classList.contains(y.GOAL_CONTROL_BTN)){e.stopPropagation();let l=s.habits.find(b=>b.id===n);if(!l)return;let c=t.dataset.action,d=Je(l,s.selectedDate,o),p=c==="increment"?Math.min(Jt,d+eo):Math.max(1,d-eo),f=t.parentElement?.querySelector(`.${y.GOAL_VALUE_WRAPPER}`);f&&(f.classList.remove("increase","decrease"),f.offsetWidth,f.classList.add(p>d?"increase":"decrease"),setTimeout(()=>f.classList.remove("increase","decrease"),700)),ja(n,s.selectedDate,o,p),M("light");return}if(t.classList.contains(y.HABIT_CONTENT_WRAPPER)){if(a.classList.contains(y.IS_OPEN_LEFT)||a.classList.contains(y.IS_OPEN_RIGHT)){a.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT);return}let l=t.querySelector(".ripple-container");l&&qs(e,l),M("light"),zi(n,o,s.selectedDate)}};function to(){r.habitContainer.addEventListener("click",Vs)}var Za=0,ea=1,$s=2,ao=5,wt=10,no=15,x={isActive:0,startX:0,startY:0,currentX:0,direction:Za,wasOpenLeft:0,wasOpenRight:0,actionWidth:60,pointerId:-1,rafId:0,hasHaptics:0,card:null,content:null,hasTypedOM:!1},io=()=>x.isActive===1;function Ws(){let e=getComputedStyle(document.documentElement);x.actionWidth=parseInt(e.getPropertyValue("--swipe-action-width"))||60,x.hasTypedOM=typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px)}function Ys(e){let{card:t,wasOpenLeft:a,wasOpenRight:n}=x;t&&(a?e<-wt&&t.classList.remove(y.IS_OPEN_LEFT):n?e>wt&&t.classList.remove(y.IS_OPEN_RIGHT):e>wt?t.classList.add(y.IS_OPEN_LEFT):e<-wt&&t.classList.add(y.IS_OPEN_RIGHT))}function Xs(e){if((e<0?-e:e)<=wt)return;let t=a=>{let n=a.target;!n.closest(F.SWIPE_DELETE_BTN)&&!n.closest(F.SWIPE_NOTE_BTN)&&(a.stopPropagation(),a.preventDefault()),window.removeEventListener("click",t,!0)};window.addEventListener("click",t,!0),setTimeout(()=>window.removeEventListener("click",t,!0),150)}var js=()=>{if(!x.card||!x.content||x.direction!==ea){x.rafId=0;return}let e=x.currentX-x.startX|0;x.wasOpenLeft&&(e+=x.actionWidth),x.wasOpenRight&&(e-=x.actionWidth),x.hasTypedOM&&x.content.attributeStyleMap?x.content.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(e),CSS.px(0))):x.content.style.transform=`translateX(${e}px)`;let t=e<0?-e:e;!x.hasHaptics&&t>no?(M("light"),x.hasHaptics=1):x.hasHaptics&&t<no&&(x.hasHaptics=0),x.rafId=0},ta=()=>{x.rafId&&cancelAnimationFrame(x.rafId);let{card:e,content:t,pointerId:a}=x;if(e){if(a!==-1)try{e.releasePointerCapture(a)}catch{}e.classList.remove(y.IS_SWIPING),t&&(x.hasTypedOM&&t.attributeStyleMap?t.attributeStyleMap.clear():t.style.transform="",t.draggable=!0)}document.body.classList.remove("is-interaction-active"),s.uiDirtyState.habitListStructure&&requestAnimationFrame(()=>$()),window.removeEventListener("pointermove",oo),window.removeEventListener("pointerup",ro),window.removeEventListener("pointercancel",ta),x.card=x.content=null,x.isActive=0,x.direction=Za,x.pointerId=-1},oo=e=>{if(x.card){if(x.currentX=e.clientX|0,x.direction===Za){let t=Math.abs(x.currentX-x.startX),a=Math.abs((e.clientY|0)-x.startY);if(t>ao||a>ao)if(t>a){x.direction=ea,x.isActive=1,document.body.classList.add("is-interaction-active"),x.card.classList.add(y.IS_SWIPING),x.content&&(x.content.draggable=!1);try{x.card.setPointerCapture(e.pointerId),x.pointerId=e.pointerId}catch{}}else{x.direction=$s,ta();return}}x.direction===ea&&(e.preventDefault(),x.rafId||(x.rafId=requestAnimationFrame(js)))}},ro=()=>{if(x.card&&x.direction===ea){let e=x.currentX-x.startX|0;Ys(e),Xs(e)}ta()};function so(e){Ws(),e.addEventListener("pointerdown",t=>{if(x.card||t.button!==0)return;let a=t.target.closest(F.HABIT_CONTENT_WRAPPER),n=a?.closest(F.HABIT_CARD);if(!n||!a)return;let i=e.querySelector(`.${y.IS_OPEN_LEFT}, .${y.IS_OPEN_RIGHT}`);i&&i!==n&&i.classList.remove(y.IS_OPEN_LEFT,y.IS_OPEN_RIGHT),x.card=n,x.content=a,x.startX=x.currentX=t.clientX|0,x.startY=t.clientY|0,x.wasOpenLeft=n.classList.contains(y.IS_OPEN_LEFT)?1:0,x.wasOpenRight=n.classList.contains(y.IS_OPEN_RIGHT)?1:0,x.hasHaptics=0,window.addEventListener("pointermove",oo,{passive:!1}),window.addEventListener("pointerup",ro),window.addEventListener("pointercancel",ta)})}var aa=80,lo=15,na=4,Qs=typeof window<"u"&&!!(window.CSS&&window.CSSTranslate&&CSS.px),Zs=`${F.HABIT_CARD}:not(.${y.DRAGGING})`,g={isActive:!1,container:null,containerRect:null,sourceEl:null,sourceId:null,sourceTime:null,cachedSchedule:null,targetZone:null,targetCard:null,insertPos:null,indicator:null,renderedZone:null,isValidDrop:!1,scrollSpeed:0,rafId:0};function Js(e,t){let a=e.querySelectorAll(Zs),n=null,i=Number.NEGATIVE_INFINITY;for(let o of a){let l=o.getBoundingClientRect(),c=t-l.top-l.height/2;c<0&&c>i&&(i=c,n=o)}return n}function co(){if(g.isActive){if(g.scrollSpeed!==0&&g.container&&g.container.scrollBy(0,g.scrollSpeed),g.renderedZone!==g.targetZone&&(g.renderedZone&&(g.renderedZone.classList.remove(y.DRAG_OVER,y.INVALID_DROP),g.indicator&&g.indicator.parentElement===g.renderedZone&&g.indicator.remove()),g.renderedZone=g.targetZone),g.targetZone&&g.indicator){let e=g.targetZone.dataset.time===g.sourceTime,t=g.isValidDrop&&!e,a=!g.isValidDrop;if(g.targetZone.classList.contains(y.DRAG_OVER)!==t&&g.targetZone.classList.toggle(y.DRAG_OVER,t),g.targetZone.classList.contains(y.INVALID_DROP)!==a&&g.targetZone.classList.toggle(y.INVALID_DROP,a),g.indicator.parentElement!==g.targetZone&&g.targetZone.appendChild(g.indicator),g.isValidDrop){g.indicator.classList.add("visible");let n=0;if(g.targetCard)g.insertPos==="before"?n=g.targetCard.offsetTop-na:n=g.targetCard.offsetTop+g.targetCard.offsetHeight+na;else if(g.targetZone.children.length===0)n=na;else{let i=g.targetZone.lastElementChild;i&&i!==g.indicator&&(n=i.offsetTop+i.offsetHeight+na)}Qs&&g.indicator.attributeStyleMap?g.indicator.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(0),CSS.px(n),CSS.px(0))):g.indicator.style.transform=`translate3d(0, ${n}px, 0)`}else g.indicator.classList.remove("visible")}g.rafId=requestAnimationFrame(co)}}var uo=e=>{if(e.preventDefault(),!g.isActive||!g.container)return;let t=e.clientY,a=g.containerRect;if(a){let{top:d,height:p}=a,f=d+p,b=d+aa,E=f-aa;if(t<b){let S=(b-t)/aa;g.scrollSpeed=-Math.max(2,S*lo)}else if(t>E){let S=(t-E)/aa;g.scrollSpeed=Math.max(2,S*lo)}else g.scrollSpeed=0}let n=e.target,i=n.closest(F.DROP_ZONE);if(!i){let d=n.closest(".habit-group-wrapper");d&&(i=d.querySelector(F.DROP_ZONE))}if(!i){g.targetZone=null,g.isValidDrop=!1;return}let o=i.dataset.time,l=o===g.sourceTime,c=!0;if(!l&&g.cachedSchedule?.includes(o)&&(c=!1),g.targetZone=i,g.isValidDrop=c,c){let d=Js(i,t);if(d)g.targetCard=d,g.insertPos="before";else{let p=i.querySelector(`${F.HABIT_CARD}:not(.${y.DRAGGING}):last-child`);p?(g.targetCard=p,g.insertPos="after"):(g.targetCard=null,g.insertPos=null)}}else g.targetCard=null;e.dataTransfer.dropEffect=c?"move":"none"},po=e=>{if(e.preventDefault(),!g.isActive||!g.isValidDrop||!g.sourceId||!g.sourceTime)return;let t=g.targetZone.dataset.time,a=g.sourceTime===t,n;g.targetCard&&g.targetCard.dataset.habitId&&(n={id:g.targetCard.dataset.habitId,pos:g.insertPos||"after"}),a?n&&(M("medium"),Qt(g.sourceId,n.id,n.pos)):(M("medium"),Ui(g.sourceId,g.sourceTime,t,n)),Ja()},Ja=()=>{g.rafId&&cancelAnimationFrame(g.rafId),document.body.classList.remove("is-dragging-active"),(s.uiDirtyState.habitListStructure||s.uiDirtyState.calendarVisuals)&&requestAnimationFrame(()=>$()),g.sourceEl?.classList.remove(y.DRAGGING),g.container&&g.container.classList.remove("is-dragging"),g.renderedZone&&g.renderedZone.classList.remove(y.DRAG_OVER,y.INVALID_DROP),g.indicator?.remove(),document.removeEventListener("dragover",uo),document.removeEventListener("drop",po),document.removeEventListener("dragend",Ja),g.isActive=!1,g.sourceEl=null,g.targetZone=null,g.targetCard=null,g.renderedZone=null,g.scrollSpeed=0,g.containerRect=null},el=e=>{if(io()){e.preventDefault();return}let a=e.target.closest(F.HABIT_CARD);if(!a||!a.dataset.habitId||!a.dataset.time)return;g.isActive=!0,g.sourceEl=a,g.sourceId=a.dataset.habitId,g.sourceTime=a.dataset.time,g.container&&(g.containerRect=g.container.getBoundingClientRect());let n=s.habits.find(o=>o.id===g.sourceId);n&&(g.cachedSchedule=fe(n,s.selectedDate)),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",g.sourceId);let i=a.querySelector(F.HABIT_CONTENT_WRAPPER);if(i){let o=i.cloneNode(!0);o.classList.add(y.DRAG_IMAGE_GHOST);let l=i.getBoundingClientRect();o.style.width=`${l.width}px`,o.style.height=`${l.height}px`;let c=window.getComputedStyle(i);o.style.backgroundColor=c.backgroundColor,o.style.backgroundImage=c.backgroundImage,o.style.backgroundSize=c.backgroundSize,o.style.color=c.color,o.style.borderRadius=c.borderRadius,o.style.position="absolute",o.style.left=`${l.left+window.scrollX}px`,o.style.top=`${l.top+window.scrollY}px`,o.style.zIndex="10000",o.style.margin="0",o.style.pointerEvents="none",o.style.transform="scale(1.05)",o.style.boxShadow="0 15px 30px rgba(0,0,0,0.3)",o.style.transformOrigin="center center",document.body.appendChild(o);let d=Math.max(0,e.clientX-l.left),p=Math.max(0,e.clientY-l.top);e.dataTransfer.setDragImage(o,d,p),setTimeout(()=>o.remove(),0)}g.indicator=document.createElement("div"),g.indicator.className="drop-indicator",document.addEventListener("dragover",uo),document.addEventListener("drop",po),document.addEventListener("dragend",Ja),M("light"),requestAnimationFrame(()=>{a.classList.add(y.DRAGGING),document.body.classList.add("is-dragging-active"),g.container&&g.container.classList.add("is-dragging"),co()})};function mo(e){g.container=e,e.addEventListener("dragstart",el)}var fo=350,tl=15,al=30,nl=1500,go=200,te={isScrolling:!1,scrollRafId:0,pressTimerId:0,isLongPress:!1,activeDateISO:null,lastFetchTime:0},il=()=>{te.isScrolling||(te.isScrolling=!0,te.scrollRafId=requestAnimationFrame(()=>{let e=r.calendarStrip;if(!e){te.isScrolling=!1,te.scrollRafId=0;return}let t=e.scrollLeft,a=e.scrollWidth,n=e.clientWidth,i=a-n,o=Date.now(),c=o-te.lastFetchTime<nl?al:tl;if(t<fo){te.lastFetchTime=o;let d=e.firstElementChild;if(d&&d.dataset.date){let p=d.dataset.date,f=document.createDocumentFragment();for(let S=0;S<c;S++)p=Vn(p,f);let b=e.scrollWidth;e.insertBefore(f,e.firstElementChild);let E=e.scrollWidth;if(e.scrollLeft+=E-b,e.children.length>go)for(let S=0;S<c;S++)e.lastElementChild?.remove()}}else if(i-t<fo){te.lastFetchTime=o;let d=e.lastElementChild;if(d&&d.dataset.date){let p=d.dataset.date,f=document.createDocumentFragment();for(let b=0;b<c;b++)p=Gn(p,f);if(e.appendChild(f),e.children.length>go){let b=c,E=e.scrollWidth;for(let L=0;L<b;L++)e.firstElementChild?.remove();let S=e.scrollWidth;e.scrollLeft-=E-S}}}te.isScrolling=!1,te.scrollRafId=0}))},ol=e=>{if(e.button!==0)return;let t=e.target.closest(F.DAY_ITEM);if(!t||!t.dataset.date)return;te.isLongPress=!1,te.activeDateISO=t.dataset.date,t.classList.add("is-pressing"),te.pressTimerId=window.setTimeout(()=>{te.isLongPress=!0,M("medium"),t.classList.remove("is-pressing"),sl(t)},500);let a=()=>{clearTimeout(te.pressTimerId),t.classList.remove("is-pressing"),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)};window.addEventListener("pointerup",a,{once:!0}),window.addEventListener("pointercancel",a,{once:!0})},rl=e=>{if(te.isLongPress){e.preventDefault(),e.stopPropagation();return}let t=e.target.closest(F.DAY_ITEM);if(t&&t.dataset.date){let a=t.dataset.date;if(s.selectedDate!==a){M("selection"),s.selectedDate=a;let n=r.calendarStrip.querySelector(`.${y.SELECTED}`);n&&(n.classList.remove(y.SELECTED),n.setAttribute("aria-current","false"),n.setAttribute("tabindex","-1")),t.classList.add(y.SELECTED),t.setAttribute("aria-current","date"),t.setAttribute("tabindex","0"),s.uiDirtyState.habitListStructure=!0,s.uiDirtyState.chartData=!0,document.dispatchEvent(new CustomEvent("render-app"))}}},sl=e=>{if(!e.dataset.date)return;let a=e.getBoundingClientRect(),n=r.calendarQuickActions,i=n.querySelector(".quick-actions-content");if(!i)return;let o=a.bottom+8,l=a.left+a.width/2;n.style.setProperty("--actions-top",`${o}px`),n.style.setProperty("--actions-left",`${l}px`),i.style.setProperty("--translate-x","-50%"),ie(n)},en=()=>{M("light");let e=I();r.calendarStrip.querySelector(`.${y.TODAY}`)&&s.selectedDate===e?Bt(!0):(s.selectedDate=e,s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,$())},ll=e=>{let t=e.target.closest(".full-calendar-day");if(t&&t.dataset.date&&!t.classList.contains("other-month")){let a=t.dataset.date;M("selection"),s.selectedDate=a,Q(r.fullCalendarModal),s.uiDirtyState.calendarVisuals=!0,s.uiDirtyState.habitListStructure=!0,$(),requestAnimationFrame(()=>Bt(!1))}},cl=()=>{if(!s.fullCalendar)return;let{month:e,year:t}=s.fullCalendar;e--,e<0&&(e=11,t--),s.fullCalendar={month:e,year:t},Re(),M("light")},dl=()=>{if(!s.fullCalendar)return;let{month:e,year:t}=s.fullCalendar;e++,e>11&&(e=0,t++),s.fullCalendar={month:e,year:t},Re(),M("light")};function ho(){r.calendarStrip.addEventListener("pointerdown",ol),r.calendarStrip.addEventListener("click",rl),r.calendarStrip.addEventListener("scroll",il,{passive:!0}),r.headerTitle.addEventListener("click",en),r.navArrowPast.addEventListener("click",en),r.navArrowFuture.addEventListener("click",en);let e=t=>{let a=te.activeDateISO;if(Q(r.calendarQuickActions),t==="almanac"){if(M("light"),a){let n=k(a);s.fullCalendar={year:n.getUTCFullYear(),month:n.getUTCMonth()}}Re(),ie(r.fullCalendarModal);return}a&&(M(t==="completed"?"success":"medium"),Ki(a,t))};r.quickActionDone.addEventListener("click",()=>e("completed")),r.quickActionSnooze.addEventListener("click",()=>e("snoozed")),r.quickActionAlmanac.addEventListener("click",()=>e("almanac")),r.fullCalendarPrevBtn.addEventListener("click",cl),r.fullCalendarNextBtn.addEventListener("click",dl),r.fullCalendarGrid.addEventListener("click",ll)}var ul={weekday:"long",day:"numeric",month:"long",timeZone:"UTC"},ct=null,yo=0,ia=null;function pl(){ct=null;let{wrapper:e,tooltip:t,indicator:a,tooltipDate:n,tooltipScoreLabel:i,tooltipScoreValue:o,tooltipHabits:l}=r.chart,{lastChartData:c,chartMinVal:d,chartValueRange:p,hasTypedOM:f}=U;if(!e||!t||!a||!n||!i||!o||!l||c.length===0||!e.isConnected)return;U.cachedChartRect||(U.cachedChartRect=e.getBoundingClientRect());let b=U.cachedChartRect.width;if(b===0)return;let E=xe.left,S=b-E-xe.right,L=c.length,_=(yo-U.cachedChartRect.left-E)/S*(L-1)+.5|0,X=_<0?0:_>=L?L-1:_;if(X!==U.lastRenderedPointIndex){U.lastRenderedPointIndex=X;let re=c[X],j=bt-xe.top-xe.bottom,ae=E+X/(L-1)*S,he=xe.top+j-(re.value-d)/p*j;f&&a.attributeStyleMap?(a.style.opacity="1",a.attributeStyleMap.set("transform",new window.CSSTranslate(CSS.px(ae),CSS.px(0)))):(a.style.opacity="1",a.style.transform=`translateX(${ae}px)`),ia||(ia=a.querySelector(".chart-indicator-dot")),ia&&(ia.style.top=`${he}px`);let P=ue(re.timestamp,ul);v(n,P),v(i,u("chartTooltipScore")+": "),v(o,Ln(re.value)),v(l,u("chartTooltipCompleted",{completed:re.completedCount,total:re.scheduledCount})),t.classList.contains("visible")||t.classList.add("visible");let V="-50%";ae<50?V="0%":ae>b-50&&(V="-100%"),t.style.transform=`translate3d(calc(${ae}px + ${V}), calc(${bt/2}px - 50%), 0)`}}function bo(){let{wrapper:e,tooltip:t,indicator:a}=r.chart;if(!e||!t||!a)return;let n=o=>{yo=o.clientX,ct||(ct=requestAnimationFrame(pl))},i=()=>{ct&&(cancelAnimationFrame(ct),ct=null),t.classList.remove("visible"),a.style.opacity="0",U.lastRenderedPointIndex=-1};e.addEventListener("pointermove",n),e.addEventListener("pointerleave",i),e.addEventListener("pointercancel",i)}var oa=new Map;async function vo(e){if(s.dailyDiagnoses[e]||oa.has(e))return oa.get(e);let a=(async()=>{let n="",i=ce(e);if(Object.keys(i).forEach(o=>Object.keys(i[o].instances).forEach(l=>{let c=i[o].instances[l]?.note;c&&(n+=`- ${c}
`)})),!(!n.trim()||!navigator.onLine))try{let o={notes:n,themeList:u("aiThemeList"),languageName:Rt(),translations:{aiPromptQuote:u("aiPromptQuote"),aiSystemInstructionQuote:u("aiSystemInstructionQuote")}},{prompt:l,systemInstruction:c}=await He("build-quote-analysis-prompt",o),f=(await(await ze("/api/analyze",{method:"POST",body:JSON.stringify({prompt:l,systemInstruction:c})})).text()).replace(/```json|```/g,"").trim(),b=JSON.parse(f);b?.analysis&&(s.dailyDiagnoses[e]={level:b.analysis.determined_level,themes:b.relevant_themes,timestamp:Date.now()},ee())}catch(o){console.error("Context analysis failed",o)}finally{oa.delete(e)}})();return oa.set(e,a),a}var ml=500,fl=500,gl=50,Eo=!1,tn,ra=null,hl=()=>{window.setTimeout(ot,fl)},yl=e=>{e.Notifications.addEventListener("permissionChange",hl),ot()},an=()=>{tn&&clearTimeout(tn),tn=window.setTimeout(()=>{let e=navigator.onLine,t=document.body.classList.contains("is-offline");document.body.classList.toggle("is-offline",!e),t===e&&ye(),e&&(console.log("[Network] Online stable. Flushing pending sync."),be(le()))},ml)},bl=()=>{if(document.visibilityState==="visible"){an();let e=I();fa();let t=I();e!==t?(s.selectedDate===e&&(s.selectedDate=t),document.dispatchEvent(new CustomEvent("dayChanged"))):(ra&&cancelAnimationFrame(ra),ra=requestAnimationFrame(()=>{$(),ra=null}))}},vl=e=>{e.data&&e.data.type==="REQUEST_SYNC"&&(console.log("[SW Message] Sincroniza\xE7\xE3o solicitada pelo Service Worker."),be(le(),!0))},xo=e=>{let{habitId:t,time:a}=e.detail,n=s.habits.find(o=>o.id===t),i=Jn(t,a);if(i||(i=document.querySelector(`.habit-card[data-habit-id="${t}"][data-time="${a}"]`)),n&&i){let o=e.type==="card-status-changed";zt(i,n,a,void 0,{animate:o})}};function To(){if(Eo)return;Eo=!0,li(),Ji(),to(),ho(),Se(yl),document.addEventListener("render-app",$),document.addEventListener("request-analysis",t=>{let a=t;a.detail?.date&&vo(a.detail.date)}),document.addEventListener("card-status-changed",xo),document.addEventListener("card-goal-changed",xo),window.addEventListener("online",an),window.addEventListener("offline",an),document.addEventListener("visibilitychange",bl),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",vl),document.body.classList.toggle("is-offline",!navigator.onLine);let e=()=>{try{let t=r.habitContainer;mo(t),so(t),bo()}catch{}};"scheduler"in window&&window.scheduler?window.scheduler.postTask(e,{priority:"user-visible"}):setTimeout(e,gl)}function $e(e){switch(r.syncInactiveView.style.display="none",r.syncEnterKeyView.style.display="none",r.syncDisplayKeyView.style.display="none",r.syncActiveView.style.display="none",r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),e){case"inactive":r.syncInactiveView.style.display="flex";break;case"enterKey":r.syncEnterKeyView.style.display="flex";break;case"displayKey":r.syncDisplayKeyView.style.display="flex";let t=r.syncDisplayKeyView.dataset.context;r.keySavedBtn.textContent=t==="view"?u("closeButton"):u("syncKeySaved");break;case"active":r.syncActiveView.style.display="flex";break}}function So(e,t){for(let a=0;a<e.length;a++)e[a].disabled=t}async function Lo(e){let t=[r.submitKeyBtn,r.cancelEnterKeyBtn];So(t,!0),r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden");let a=r.submitKeyBtn.textContent;r.submitKeyBtn.textContent=u("syncVerifying");let n=Ae();try{$a(),Xt(e);let i=await Ii();if(i&&i.habits&&i.habits.length>0){W("Dados encontrados na nuvem. Mesclando...","info","\u{1F9EC}");let o=le(),l=await xt(o,i);await Ce(l),pt(),at(),s.uiDirtyState.habitListStructure=s.uiDirtyState.calendarVisuals=s.uiDirtyState.chartData=!0,await ee(!0),$(),Y("syncSynced"),be(l,!0)}else W("Cofre nuvem vazio. Inicializando com dados locais.","info","\u2B06\uFE0F"),Y("syncSynced"),be(le(),!0);nn()}catch(i){if(n?Xt(n):Et(),r.syncErrorMsg){let o=i.message||"Erro desconhecido";(o.includes("401")||o.includes("Auth"))&&(o="Chave Inv\xE1lida ou N\xE3o Encontrada"),r.syncErrorMsg.textContent=o,r.syncErrorMsg.classList.remove("hidden")}Y("syncError"),W(`Falha na ativa\xE7\xE3o: ${i.message}`,"error","\u274C")}finally{r.submitKeyBtn.textContent=a,So(t,!1)}}var El=()=>{try{r.enableSyncBtn.disabled=!0,r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden");let e=Xe();$a(),Xt(e),Y("syncSynced"),r.syncKeyText.textContent=e,r.syncDisplayKeyView.dataset.context="setup",$e("displayKey"),be(le(),!0),setTimeout(()=>r.enableSyncBtn.disabled=!1,500)}catch(e){r.enableSyncBtn.disabled=!1,r.syncErrorMsg&&(r.syncErrorMsg.textContent=e.message||"Erro ao gerar chave",r.syncErrorMsg.classList.remove("hidden"))}},xl=()=>{$e("enterKey"),setTimeout(()=>r.syncKeyInput.focus(),100)},Tl=()=>{r.syncKeyInput.value="",r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),nn()},Sl=()=>{let e=r.syncKeyInput.value.trim();e&&(r.syncErrorMsg&&r.syncErrorMsg.classList.add("hidden"),Di(e)?Lo(e):oe(u("confirmInvalidKeyBody"),()=>Lo(e),{title:u("confirmInvalidKeyTitle"),confirmText:u("confirmButton"),cancelText:u("cancelButton")}))},Ll=()=>$e("active"),wl=()=>{let e=r.syncKeyText.textContent;e&&navigator.clipboard.writeText(e).then(()=>{let t=r.copyKeyBtn.innerHTML;r.copyKeyBtn.innerHTML="\u2713",setTimeout(()=>{r.copyKeyBtn.innerHTML=t},1500)}).catch(()=>alert("Copie manualmente: "+e))},Dl=()=>{let e=Ae();e&&(r.syncKeyText.textContent=e,r.syncDisplayKeyView.dataset.context="view",$e("displayKey"))},Ml=()=>{oe(u("confirmSyncDisable"),()=>{Et(),Y("syncInitial"),$e("inactive")},{title:u("syncDisableTitle"),confirmText:u("syncDisableConfirm"),confirmButtonStyle:"danger"})},Cl=e=>{fi()};function nn(){Fe()?($e("active"),s.syncState==="syncInitial"&&Y("syncSynced")):($e("inactive"),Y("syncInitial"))}function wo(){r.enableSyncBtn&&r.enableSyncBtn.addEventListener("click",El),r.enterKeyViewBtn&&r.enterKeyViewBtn.addEventListener("click",xl),r.cancelEnterKeyBtn&&r.cancelEnterKeyBtn.addEventListener("click",Tl),r.submitKeyBtn&&r.submitKeyBtn.addEventListener("click",Sl),r.keySavedBtn&&r.keySavedBtn.addEventListener("click",Ll),r.copyKeyBtn&&r.copyKeyBtn.addEventListener("click",wl),r.viewKeyBtn&&r.viewKeyBtn.addEventListener("click",Dl),r.disableSyncBtn&&r.disableSyncBtn.addEventListener("click",Ml),r.syncStatus&&r.syncStatus.addEventListener("pointerdown",Cl),nn()}async function on(){if("setAppBadge"in navigator&&"clearAppBadge"in navigator)try{let{pending:e}=J(I()),t=navigator;e>0?await t.setAppBadge(e):await t.clearAppBadge()}catch(e){console.error("Failed to set app badge:",e)}}var sa="askesis_boot_attempts",Al=3;function Hl(){let e=parseInt(sessionStorage.getItem(sa)||"0",10);return e>=Al?(console.warn("\u{1F6A8} Detected boot loop. Initiating Auto-Healing..."),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(t=>{for(let a of t)a.unregister()}),"caches"in window&&caches.keys().then(t=>{for(let a of t)caches.delete(a)}),sessionStorage.removeItem(sa),setTimeout(()=>window.location.reload(),500),!1):(sessionStorage.setItem(sa,(e+1).toString()),!0)}var Dt=!1,rn=!1,Il=()=>{if("serviceWorker"in navigator&&!window.location.protocol.startsWith("file")){let e=()=>navigator.serviceWorker.register("/sw.js").catch(console.warn);document.readyState==="complete"?e():window.addEventListener("load",e)}};async function kl(){if(await Ce(),Fe()){document.body.classList.add("is-booting");let e=ki(),t=new Promise(a=>setTimeout(()=>{s.initialSyncDone||(console.warn("Boot sync timeout. Unlocking UI."),s.initialSyncDone=!0,a())},5e3));Promise.race([e,t]).finally(()=>{document.body.classList.remove("is-booting")})}else s.initialSyncDone=!0}function Ol(){s.hasOnboarded||(s.hasOnboarded=!0,ee())}function _l(){To(),wo(),document.addEventListener("habitsChanged",on),ga(),document.addEventListener("dayChanged",Xi),Si(be)}function Rl(e){if(sessionStorage.removeItem(sa),e){e.classList.add("hidden");let a=()=>{e.remove(),document.getElementById("initial-loader-container")?.remove()},n=setTimeout(a,400);e.addEventListener("transitionend",()=>{clearTimeout(n),a()},{once:!0})}let t=()=>{Pi(),import("./analytics-5IQ5LGBN.js").then(({initAnalytics:a})=>a()).catch(()=>{})};window.scheduler?.postTask?window.scheduler.postTask(t,{priority:"background"}):(window.requestIdleCallback||(a=>setTimeout(a,1e3)))(t)}async function Pl(e){Dt||rn||(Dt=!0,window.bootWatchdog&&(clearTimeout(window.bootWatchdog),delete window.bootWatchdog),await Mi(),await Promise.all([yi(),Fa()]),await kl(),_l(),Ol(),$(),on(),Rl(e),rn=!0,Dt=!1)}var Do=()=>{if(!Hl()||(Il(),Dt||rn))return;let e=document.getElementById("initial-loader");Pl(e).catch(t=>{console.error("Boot failed:",t),Dt=!1,window.showFatalError?window.showFatalError("Erro na inicializa\xE7\xE3o: "+(t.message||t)):e&&e.isConnected&&(e.innerHTML='<div style="color:#ff6b6b;padding:2rem;text-align:center;"><h3>Falha Cr\xEDtica</h3><button onclick="location.reload()">Tentar Novamente</button></div>')})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Do):Do();
/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/
/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */
